<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
<!--[if lte IE 8]><meta http-equiv="refresh" content="0;url=/ie.html"><![endif]-->
<!-- <title>Centos-7-配置-supervisor-遇到的坑 | 任志帆的个人博客</title> -->
<title>Centos-7-配置-supervisor-遇到的坑</title>
<meta name="title" content="Centos-7-配置-supervisor-遇到的坑">

  <meta name="author" content="Zhifan Ren">

<meta name="keywords" content="supervisor">


<link rel="shortcut icon" href="/assets/image/favicon.ico" />
<link rel="icon" href="/assets/image/favicon.ico" type="image/x-icon">

<script src="/assets/js/jquery-1.7.1.min.js" type="text/javascript"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-48260695-1', 'renzhifan.github.io');
  ga('send', 'pageview');

</script>
<link rel="stylesheet" type="text/css" href="/assets/css/style.css">
<link rel="stylesheet" type="text/css" href="/assets/css/bootstrap.custom.css">
<link rel="stylesheet" type="text/css" href="/assets/css/highlight.css">


<link href="/pages/rss.xml" rel="alternate" title="任志帆的个人博客" type="application/atom+xml">

  </head>
  <body>
    <button id="js-fullscreen"><span id="icon-arrow" class="fontello"></span></button>
    <button id="scroll-top"><span id="icon-arrow-up" class="fontello"></span></button>

    <aside id="sidebar">
  <nav id="tags">
    <a href="/index.html" id="avatar" style="background-image:url(/assets/image/avatar.png)"></a>

    <ul id="tags__ul">
      <li id="pl__all" class="tags__li tags-btn active">所有文章</li>
      
        <li id="Tool" class="tags__li tags-btn">Tool</li>
      
        <li id="nginx" class="tags__li tags-btn">nginx</li>
      
        <li id="mysql" class="tags__li tags-btn">mysql</li>
      
        <li id="laravel" class="tags__li tags-btn">laravel</li>
      
        <li id="Jekyll" class="tags__li tags-btn">Jekyll</li>
      
        <li id="swoole" class="tags__li tags-btn">swoole</li>
      
        <li id="git" class="tags__li tags-btn">git</li>
      
        <li id="lnmp" class="tags__li tags-btn">lnmp</li>
      
    </ul>

    <div id="tags__bottom">
      <a href="https://github.com/renzhifan" id="icon-github" class="tags-btn fontello" target="_blank"></a>
      <a href="/pages/rss.xml" id="icon-feed" class="tags-btn fontello" target="_blank"></a>
      <a href="mailto:zhifan1005@163.com" id="icon-email" class="tags-btn fontello"></a>
    </div>
  </nav> <!-- end #tags -->

  <div id="posts-list">
    <form action="" id="search-form">
      <a href="/index.html" id="mobile-avatar" style="background-image:url(/assets/image/avatar.png)"></a>
      <!-- NOTE: input field is disabled by default -->
      <input id="search-input" type="text" placeholder="站内搜索..." >
    </form>

    <nav id="pl__container">
    
      <!-- <a class="laravel pl__all" href="/2020-03-28-laravel7.0%E5%B9%BF%E6%92%AD%E6%9C%BA%E5%88%B6(Redis-+-socket.io).html"><span class="pl__circle"></span><span class="pl__title">laravel7.0广播机制(Redis + socket.io)-学习实例</span><span class="pl__date">2020-03-28</span></a> -->
      <a class="laravel pl__all" href="/2020-03-28-laravel7.0%E5%B9%BF%E6%92%AD%E6%9C%BA%E5%88%B6(Redis-+-socket.io).html"><span class="pl__circle"></span><span class="pl__title">laravel7.0广播机制(Redis + socket.io)-学习实例</span></a>
    
      <!-- <a class="Tool pl__all" href="/2020-01-02-%E7%BD%91%E9%A1%B5%E8%B0%83%E7%94%A8%E5%BE%AE%E4%BF%A1Jssdk%E5%AE%9E%E7%8E%B0%E6%89%AB%E4%B8%80%E6%89%AB%E5%8A%9F%E8%83%BD.html"><span class="pl__circle"></span><span class="pl__title">网页调用微信Jssdk实现扫一扫功能</span><span class="pl__date">2020-01-02</span></a> -->
      <a class="Tool pl__all" href="/2020-01-02-%E7%BD%91%E9%A1%B5%E8%B0%83%E7%94%A8%E5%BE%AE%E4%BF%A1Jssdk%E5%AE%9E%E7%8E%B0%E6%89%AB%E4%B8%80%E6%89%AB%E5%8A%9F%E8%83%BD.html"><span class="pl__circle"></span><span class="pl__title">网页调用微信Jssdk实现扫一扫功能</span></a>
    
      <!-- <a class="Tool pl__all" href="/2019-12-27-ubuntu-%E5%AE%89%E8%A3%85-elasticsearch%E5%92%8Cik-analyzer%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D.html"><span class="pl__circle"></span><span class="pl__title">ubuntu 安装 elasticsearch和ik-analyzer中文分词</span><span class="pl__date">2019-12-27</span></a> -->
      <a class="Tool pl__all" href="/2019-12-27-ubuntu-%E5%AE%89%E8%A3%85-elasticsearch%E5%92%8Cik-analyzer%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D.html"><span class="pl__circle"></span><span class="pl__title">ubuntu 安装 elasticsearch和ik-analyzer中文分词</span></a>
    
      <!-- <a class="Tool pl__all" href="/2019-12-26-%E6%94%B6%E8%97%8F%E7%9A%84%E5%A5%BD%E6%96%87%E9%93%BE%E6%8E%A5(%E9%95%BF%E6%9C%9F%E6%9B%B4%E6%96%B0).html"><span class="pl__circle"></span><span class="pl__title">收集的好文链接(长期更新)</span><span class="pl__date">2019-12-26</span></a> -->
      <a class="Tool pl__all" href="/2019-12-26-%E6%94%B6%E8%97%8F%E7%9A%84%E5%A5%BD%E6%96%87%E9%93%BE%E6%8E%A5(%E9%95%BF%E6%9C%9F%E6%9B%B4%E6%96%B0).html"><span class="pl__circle"></span><span class="pl__title">收集的好文链接(长期更新)</span></a>
    
      <!-- <a class="lnmp pl__all" href="/2019-12-26-Ubuntu18.04-%E6%90%AD%E5%BB%BA-PHP-%E7%8E%AF%E5%A2%83.html"><span class="pl__circle"></span><span class="pl__title">Ubuntu18.04 搭建 PHP 环境</span><span class="pl__date">2019-12-26</span></a> -->
      <a class="lnmp pl__all" href="/2019-12-26-Ubuntu18.04-%E6%90%AD%E5%BB%BA-PHP-%E7%8E%AF%E5%A2%83.html"><span class="pl__circle"></span><span class="pl__title">Ubuntu18.04 搭建 PHP 环境</span></a>
    
      <!-- <a class="git pl__all" href="/2019-12-25-%E4%BB%A5%E5%8A%A8%E7%94%BB%E7%9A%84%E6%96%B9%E5%BC%8F-%E5%BF%AB%E9%80%9F%E7%9B%B4%E8%A7%82%E5%9C%B0%E6%9F%A5%E7%9C%8B-Git-%E6%96%87%E4%BB%B6%E5%8F%98%E5%8A%A8%E5%8E%86%E5%8F%B2.html"><span class="pl__circle"></span><span class="pl__title">以动画的方式，快速直观地查看 Git 文件变动历史</span><span class="pl__date">2019-12-25</span></a> -->
      <a class="git pl__all" href="/2019-12-25-%E4%BB%A5%E5%8A%A8%E7%94%BB%E7%9A%84%E6%96%B9%E5%BC%8F-%E5%BF%AB%E9%80%9F%E7%9B%B4%E8%A7%82%E5%9C%B0%E6%9F%A5%E7%9C%8B-Git-%E6%96%87%E4%BB%B6%E5%8F%98%E5%8A%A8%E5%8E%86%E5%8F%B2.html"><span class="pl__circle"></span><span class="pl__title">以动画的方式，快速直观地查看 Git 文件变动历史</span></a>
    
      <!-- <a class="mysql pl__all" href="/2019-12-17-%E5%9F%BA%E4%BA%8E-SMProxy-%E9%80%9A%E8%BF%87%E5%8D%8F%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%AE%9E%E7%8E%B0-MySQL-%E8%BF%9E%E6%8E%A5%E6%B1%A0.html"><span class="pl__circle"></span><span class="pl__title">基于 MySQL 协议，Swoole 开发的MySQL数据库连接池使用教程。</span><span class="pl__date">2019-12-17</span></a> -->
      <a class="mysql pl__all" href="/2019-12-17-%E5%9F%BA%E4%BA%8E-SMProxy-%E9%80%9A%E8%BF%87%E5%8D%8F%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%AE%9E%E7%8E%B0-MySQL-%E8%BF%9E%E6%8E%A5%E6%B1%A0.html"><span class="pl__circle"></span><span class="pl__title">基于 MySQL 协议，Swoole 开发的MySQL数据库连接池使用教程。</span></a>
    
      <!-- <a class="swoole pl__all" href="/2019-12-12-%E5%9F%BA%E4%BA%8E-Swoole-%E5%9C%A8-Laravel-%E4%B8%AD%E5%AE%9E%E7%8E%B0%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1%E9%98%9F%E5%88%97.html"><span class="pl__circle"></span><span class="pl__title">基于 Swoole 在 Laravel 中实现异步任务队列</span><span class="pl__date">2019-12-12</span></a> -->
      <a class="swoole pl__all" href="/2019-12-12-%E5%9F%BA%E4%BA%8E-Swoole-%E5%9C%A8-Laravel-%E4%B8%AD%E5%AE%9E%E7%8E%B0%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1%E9%98%9F%E5%88%97.html"><span class="pl__circle"></span><span class="pl__title">基于 Swoole 在 Laravel 中实现异步任务队列</span></a>
    
      <!-- <a class="swoole pl__all" href="/2019-12-10-%E5%9C%A8-Laravel-%E4%B8%AD%E9%9B%86%E6%88%90-Swoole-%E5%AE%9E%E7%8E%B0-WebSocket-%E6%9C%8D%E5%8A%A1%E5%99%A8.html"><span class="pl__circle"></span><span class="pl__title">在 Laravel 中集成 Swoole 实现 WebSocket 服务器</span><span class="pl__date">2019-12-10</span></a> -->
      <a class="swoole pl__all" href="/2019-12-10-%E5%9C%A8-Laravel-%E4%B8%AD%E9%9B%86%E6%88%90-Swoole-%E5%AE%9E%E7%8E%B0-WebSocket-%E6%9C%8D%E5%8A%A1%E5%99%A8.html"><span class="pl__circle"></span><span class="pl__title">在 Laravel 中集成 Swoole 实现 WebSocket 服务器</span></a>
    
      <!-- <a class="swoole pl__all" href="/2019-12-09-%E5%9F%BA%E4%BA%8Eswoole%E5%AE%9E%E7%8E%B0%E9%AB%98%E6%80%A7%E8%83%BDHTTP%E6%9C%8D%E5%8A%A1%E5%99%A8.html"><span class="pl__circle"></span><span class="pl__title">基于swoole实现HTTP高性能服务器</span><span class="pl__date">2019-12-09</span></a> -->
      <a class="swoole pl__all" href="/2019-12-09-%E5%9F%BA%E4%BA%8Eswoole%E5%AE%9E%E7%8E%B0%E9%AB%98%E6%80%A7%E8%83%BDHTTP%E6%9C%8D%E5%8A%A1%E5%99%A8.html"><span class="pl__circle"></span><span class="pl__title">基于swoole实现HTTP高性能服务器</span></a>
    
      <!-- <a class="laravel pl__all" href="/2019-12-06-%E8%AE%A9Laravel%E5%BC%80%E5%8F%91Api%E6%9B%B4%E5%BE%97%E5%BF%83%E5%BA%94%E6%89%8B.html"><span class="pl__circle"></span><span class="pl__title">让Laravel开发Api更得心应手</span><span class="pl__date">2019-12-06</span></a> -->
      <a class="laravel pl__all" href="/2019-12-06-%E8%AE%A9Laravel%E5%BC%80%E5%8F%91Api%E6%9B%B4%E5%BE%97%E5%BF%83%E5%BA%94%E6%89%8B.html"><span class="pl__circle"></span><span class="pl__title">让Laravel开发Api更得心应手</span></a>
    
      <!-- <a class="Jekyll pl__all" href="/2019-11-29-Jekyll%E6%90%AD%E5%BB%BA%E9%9D%99%E6%80%81%E9%A1%B5%E9%9D%A2.html"><span class="pl__circle"></span><span class="pl__title">Jekyll常用操作</span><span class="pl__date">2019-11-29</span></a> -->
      <a class="Jekyll pl__all" href="/2019-11-29-Jekyll%E6%90%AD%E5%BB%BA%E9%9D%99%E6%80%81%E9%A1%B5%E9%9D%A2.html"><span class="pl__circle"></span><span class="pl__title">Jekyll常用操作</span></a>
    
      <!-- <a class="laravel pl__all" href="/2019-10-28-laravel%E9%9B%86%E6%88%90%E5%BE%AE%E4%BF%A1%E7%AC%AC%E4%B8%89%E6%96%B9%E7%99%BB%E5%BD%95.html"><span class="pl__circle"></span><span class="pl__title">laravel集成微信第三方登录</span><span class="pl__date">2019-10-28</span></a> -->
      <a class="laravel pl__all" href="/2019-10-28-laravel%E9%9B%86%E6%88%90%E5%BE%AE%E4%BF%A1%E7%AC%AC%E4%B8%89%E6%96%B9%E7%99%BB%E5%BD%95.html"><span class="pl__circle"></span><span class="pl__title">laravel集成微信第三方登录</span></a>
    
      <!-- <a class="laravel pl__all" href="/2019-10-28-laravel5-5-%E5%8A%A8%E6%80%81%E5%88%87%E6%8D%A2%E5%A4%9A%E8%AF%AD%E8%A8%80%E6%93%8D%E4%BD%9C.html"><span class="pl__circle"></span><span class="pl__title">laravel5.5 动态切换多语言操作</span><span class="pl__date">2019-10-28</span></a> -->
      <a class="laravel pl__all" href="/2019-10-28-laravel5-5-%E5%8A%A8%E6%80%81%E5%88%87%E6%8D%A2%E5%A4%9A%E8%AF%AD%E8%A8%80%E6%93%8D%E4%BD%9C.html"><span class="pl__circle"></span><span class="pl__title">laravel5.5 动态切换多语言操作</span></a>
    
      <!-- <a class="mysql pl__all" href="/2019-10-28-MYSQL%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html"><span class="pl__circle"></span><span class="pl__title">MYSQL 主从复制</span><span class="pl__date">2019-10-28</span></a> -->
      <a class="mysql pl__all" href="/2019-10-28-MYSQL%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html"><span class="pl__circle"></span><span class="pl__title">MYSQL 主从复制</span></a>
    
      <!-- <a class="nginx pl__all" href="/2019-10-28-Let's-Encrypt-%E5%AE%9E%E7%8E%B0nginx%E7%AB%99%E7%82%B9-SSL.html"><span class="pl__circle"></span><span class="pl__title">Let's Encrypt 实现nginx站点 SSL</span><span class="pl__date">2019-10-28</span></a> -->
      <a class="nginx pl__all" href="/2019-10-28-Let's-Encrypt-%E5%AE%9E%E7%8E%B0nginx%E7%AB%99%E7%82%B9-SSL.html"><span class="pl__circle"></span><span class="pl__title">Let's Encrypt 实现nginx站点 SSL</span></a>
    
      <!-- <a class="Tool pl__all" href="/2019-10-28-Centos-7-%E9%85%8D%E7%BD%AE-supervisor-%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91.html"><span class="pl__circle"></span><span class="pl__title">Centos-7-配置-supervisor-遇到的坑</span><span class="pl__date">2019-10-28</span></a> -->
      <a class="Tool pl__all" href="/2019-10-28-Centos-7-%E9%85%8D%E7%BD%AE-supervisor-%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91.html"><span class="pl__circle"></span><span class="pl__title">Centos-7-配置-supervisor-遇到的坑</span></a>
    
    </nav>
  </div> <!-- end #posts-list -->
</aside> <!-- end #sidebar -->

    <div id="post">
      <div id="pjax">
        <article id="post__content">
    <h1 id="post__title" data-identifier="20191028">Centos-7-配置-supervisor-遇到的坑</h1>
    <div id="post__date">2019-10-28</div>
    <declare id="declare" class="declare">
      <hr/> 本博客所有文章采用的授权方式为
        <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh">
          <b>自由转载-非商用-非衍生-保持署名</b>
        </a>
      ，转载请务必注明出处，谢谢。<br /><br />
      声明：<br />本博客欢迎转发，但请保留原作者信息!<br />博客地址：<a href="https://renzhifan.github.io">任志帆的博客</a>;<br />内容系本人学习、研究和总结，如有雷同，实属荣幸！
      <hr/>
    </declare>
    <ul id="markdown-toc">
  <li><a href="#1安装supervisor" id="markdown-toc-1安装supervisor">1、安装supervisor</a></li>
  <li><a href="#2配置" id="markdown-toc-2配置">2、配置</a>    <ul>
      <li><a href="#1先要确认是否已经启动过了ps--ef--grep-supervisord" id="markdown-toc-1先要确认是否已经启动过了ps--ef--grep-supervisord">1、先要确认是否已经启动过了：ps -ef | grep supervisord</a></li>
      <li><a href="#2如果有的话先kill掉" id="markdown-toc-2如果有的话先kill掉">2、如果有的话先kill掉</a></li>
      <li><a href="#3运行下面命令" id="markdown-toc-3运行下面命令">3、运行下面命令：</a></li>
      <li><a href="#4再执行如下命令" id="markdown-toc-4再执行如下命令">4、再执行如下命令</a></li>
    </ul>
  </li>
  <li><a href="#3启动" id="markdown-toc-3启动">3、启动</a></li>
  <li><a href="#4总结" id="markdown-toc-4总结">4、总结</a></li>
  <li><a href="#参考文章" id="markdown-toc-参考文章">参考文章</a></li>
</ul>

<hr />
<p>环境 centos7.5</p>
<h2 id="1安装supervisor">1、安装supervisor</h2>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum <span class="nb">install </span>supervisor
执行完之后 在/etc 目录中会生成 supervisord.conf
</code></pre></div></div>
<h2 id="2配置">2、配置</h2>
<p><img src="/static/img/supervisor.png" alt="supervisor" /></p>

<blockquote>
  <p>如上图所示   这里需要在 /etc/supervisord.d/  目录中创建你需要的配置文件</p>
</blockquote>

<blockquote>
  <p>我创建如下</p>
</blockquote>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>program:laravel-worker]
<span class="nv">process_name</span><span class="o">=</span>%<span class="o">(</span>program_name<span class="o">)</span>s_%<span class="o">(</span>process_num<span class="o">)</span>02d
<span class="nb">command</span><span class="o">=</span>php /data/wwwroot/default/coin/artisan queue:work  <span class="nt">--sleep</span><span class="o">=</span>3 <span class="nt">--tries</span><span class="o">=</span>3
<span class="nv">autostart</span><span class="o">=</span><span class="nb">true
</span><span class="nv">autorestart</span><span class="o">=</span><span class="nb">true
</span><span class="nv">user</span><span class="o">=</span>root
<span class="nv">numprocs</span><span class="o">=</span>8
<span class="nv">redirect_stderr</span><span class="o">=</span><span class="nb">true
</span><span class="nv">stdout_logfile</span><span class="o">=</span>/data/wwwroot/default/coin/storage/logs/worker.log
</code></pre></div></div>

<blockquote>
  <p>配置文件创建完成后
执行</p>
</blockquote>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">[</span>root@VM_0_7_centos etc]# supervisorctl reload
error: &lt;class <span class="s1">'socket.error'</span><span class="o">&gt;</span>, <span class="o">[</span>Errno 111] Connection refused: file: /usr/lib64/python2.7/socket.py line: 224
</code></pre></div></div>
<blockquote>
  <p>解决办法： 
这个可能有多种原因，可能是已经启动过了也可能是没权限，解决步骤如下：</p>
</blockquote>

<h3 id="1先要确认是否已经启动过了ps--ef--grep-supervisord">1、先要确认是否已经启动过了：ps -ef | grep supervisord</h3>
<h3 id="2如果有的话先kill掉">2、如果有的话先kill掉</h3>
<h3 id="3运行下面命令">3、运行下面命令：</h3>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">touch</span> /var/run/supervisor.sock 
<span class="nb">chmod </span>777 /var/run/supervisor.sock 
</code></pre></div></div>

<h3 id="4再执行如下命令">4、再执行如下命令</h3>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@VM_0_7_centos etc]# supervisord <span class="nt">-c</span> supervisord.conf 
Unlinking stale socket /var/run/supervisor/supervisor.sock
<span class="o">[</span>root@VM_0_7_centos etc]# <span class="nb">unlink</span> /var/run/supervisor/supervisor.sock
<span class="o">[</span>root@VM_0_7_centos etc]# ps <span class="nt">-ef</span> | <span class="nb">grep </span>supervisor
root     13704     1  1 14:08 ?        00:00:03 /usr/bin/python /usr/bin/supervisord <span class="nt">-c</span> supervisord.conf
root     25913 32596  0 14:14 pts/0    00:00:00 <span class="nb">grep</span> <span class="nt">--color</span> supervisor
root     32227     1  0 11:54 ?        00:00:01 /usr/bin/python /usr/bin/supervisord

</code></pre></div></div>
<h2 id="3启动">3、启动</h2>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>supervisord <span class="nt">-c</span> supervisord.conf
</code></pre></div></div>

<blockquote>
  <p>我这启动时报错如下</p>
</blockquote>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Error: Another program is already listening on a port that one of our HTTP servers is configured to use.  Shut this program down first before starting supervisord.
For <span class="nb">help</span>, use /usr/bin/supervisord <span class="nt">-h</span>
</code></pre></div></div>

<blockquote>
  <p>解决办法:</p>
</blockquote>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@VM_0_7_centos etc]# supervisord <span class="nt">-c</span> supervisord.conf 
Error: Another program is already listening on a port that one of our HTTP servers is configured to use.  Shut this program down first before starting supervisord.
For <span class="nb">help</span>, use /usr/bin/supervisord <span class="nt">-h</span>
<span class="o">[</span>root@VM_0_7_centos etc]# ps <span class="nt">-ef</span> | <span class="nb">grep </span>supervisor
root     10276 32596  0 13:46 pts/0    00:00:00 <span class="nb">grep</span> <span class="nt">--color</span> supervisor
root     32227     1  0 11:54 ?        00:00:00 /usr/bin/python /usr/bin/supervisord
<span class="o">[</span>root@VM_0_7_centos etc]# find / <span class="nt">-name</span> supervisor.sock
/run/supervisor/supervisor.sock
<span class="o">[</span>root@VM_0_7_centos etc]# <span class="nb">unlink</span> /name/supervisor.sock
<span class="nb">unlink</span>: cannot <span class="nb">unlink</span> ‘/name/supervisor.sock’: No such file or directory
<span class="o">[</span>root@VM_0_7_centos etc]# <span class="nb">unlink</span> /run/supervisor/supervisor.sock
<span class="o">[</span>root@VM_0_7_centos etc]# supervisord <span class="nt">-c</span> supervisord.conf 
<span class="o">[</span>root@VM_0_7_centos etc]# ps <span class="nt">-ef</span> | <span class="nb">grep </span>supervisor
root     10609     1  1 13:49 ?        00:00:00 /usr/bin/python /usr/bin/supervisord <span class="nt">-c</span> supervisord.conf
root     12309 32596  0 13:49 pts/0    00:00:00 <span class="nb">grep</span> <span class="nt">--color</span> supervisor
root     32227     1  0 11:54 ?        00:00:00 /usr/bin/python /usr/bin/supervisord

</code></pre></div></div>
<h2 id="4总结">4、总结</h2>

<blockquote>
  <p>常用命令</p>
</blockquote>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#启动守护进程：</span>
supervisord <span class="nt">-c</span> /etc/supervisor/supervisord.conf
<span class="c">#重载配置：</span>
supervisorctl reload

<span class="nb">sudo </span>supervisorctl reread
<span class="nb">sudo </span>supervisorctl update
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>报错信息： 
Error: .ini file does not include supervisorctl section
解决办法： 
一个权限问题，步骤： 
1. 先确保supervisord.conf中有[supervisord]，[supervisorctl]有这两个基本模块，还有[program:XXX]自己程序的配置（可以在supervisord.conf也可以在/etc/supervisor/*.ini中） 
2. 最关键的两个命令：chmod +x /usr/bin/supervisord 
chmod +x /usr/bin/supervisorctl 
chmod +x /etc/supervisord.conf主要是把把相关文件都授权了 
3. 把supervisord杀掉后再次启动supervisord
</code></pre></div></div>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Exited too quickly (process log may have details)

解决办法： 
1. 先确认[program:XXX]中自己的程序的command=&lt;启动命令&gt;和 directory=&lt;运行命令的路径&gt;没有问题，python是不是用的自己要的环境的python（比如虚拟环境的），log文件的文件夹是不是已经创建（没创建的话supervisor没权限生成log文件），以及改log文件是不是授权给所有用户了（可参考前面的解决办法chmod +x aaaaa.log） 
2. 确保用上面的配置中的command在指定路径可以直接运行不会报错，这时候一般就不会有什么问题了。这时候tail你自己的log文件一般就能看到log信息，启动失败报错的信息也会在你的log文件中，照着解决后supervisorctl reload就好了。 
3. 如果上面的命令确保可以跑，但还是没法正常运行，也看不到自己程序的报错（不然你就能根据报错解决问题了），那么恭喜，你遇到了跟我一样的情况。我的解决办法很诡异，尝试把[program:XXX]中的名字换成了一个跟启动命令不一样的另一个名字（不要太短），reload之后居然就可以跑了
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>还有一个比较坑的  如果你是直接把laravel官方文档中的supervisor配置拿过来的话 一定记得改驱动如下图所示
</code></pre></div></div>
<p><img src="/static/img/supervisor2.png" alt="supervisor" /></p>

<blockquote>
  <p>我就是直接复制过来的 没改驱动  结果日志一直报错 如下</p>
</blockquote>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="mi">2018</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">13</span> <span class="mi">14</span><span class="o">:</span><span class="mi">11</span><span class="o">:</span><span class="mo">06</span><span class="p">]</span> <span class="nx">local</span><span class="o">.</span><span class="nx">ERROR</span><span class="o">:</span> <span class="nx">Class</span> <span class="s1">'Aws\Sqs\SqsClient'</span> <span class="k">not</span> <span class="nx">found</span> <span class="p">{</span><span class="s2">"exception"</span><span class="o">:</span><span class="s2">"[object] (Symfony</span><span class="se">\\</span><span class="s2">Component</span><span class="se">\\</span><span class="s2">Debug</span><span class="se">\\</span><span class="s2">Exception</span><span class="se">\\</span><span class="s2">FatalThrowableError(code: 0): Class 'Aws</span><span class="se">\\</span><span class="s2">Sqs</span><span class="se">\\</span><span class="s2">SqsClient' not found at /data/wwwroot/default/coin/vendor/laravel/framework/src/Illuminate/Queue/Connectors/SqsConnector.php:26)
[stacktrace]
#0 /data/wwwroot/default/coin/vendor/laravel/framework/src/Illuminate/Queue/QueueManager.php(157): Illuminate</span><span class="se">\\</span><span class="s2">Queue</span><span class="se">\\</span><span class="s2">Connectors</span><span class="se">\\</span><span class="s2">SqsConnector-&gt;connect(Array)
#1 /data/wwwroot/default/coin/vendor/laravel/framework/src/Illuminate/Queue/QueueManager.php(138): Illuminate</span><span class="se">\\</span><span class="s2">Queue</span><span class="se">\\</span><span class="s2">QueueManager-&gt;resolve('sqs')
#2 /data/wwwroot/default/coin/vendor/laravel/framework/src/Illuminate/Queue/Worker.php(105): Illuminate</span><span class="se">\\</span><span class="s2">Queue</span><span class="se">\\</span><span class="s2">QueueManager-&gt;connection('sqs')
#3 /data/wwwroot/default/coin/vendor/laravel/framework/src/Illuminate/Queue/Console/WorkCommand.php(101): Illuminate</span><span class="se">\\</span><span class="s2">Queue</span><span class="se">\\</span><span class="s2">Worker-&gt;daemon('sqs', 'your-queue-name', Object(Illuminate</span><span class="se">\\</span><span class="s2">Queue</span><span class="se">\\</span><span class="s2">WorkerOptions))
#4 /data/wwwroot/default/coin/vendor/laravel/framework/src/Illuminate/Queue/Console/WorkCommand.php(85): Illuminate</span><span class="se">\\</span><span class="s2">Queue</span><span class="se">\\</span><span class="s2">Console</span><span class="se">\\</span><span class="s2">WorkCommand-&gt;runWorker('sqs', 'your-queue-name')
#5 [internal function]: Illuminate</span><span class="se">\\</span><span class="s2">Queue</span><span class="se">\\</span><span class="s2">Console</span><span class="se">\\</span><span class="s2">WorkCommand-&gt;handle()
#6 /data/wwwroot/default/coin/vendor/laravel/framework/src/Illuminate/Container/BoundMethod.php(29): call_user_func_array(Array, Array)
#7 /data/wwwroot/default/coin/vendor/laravel/framework/src/Illuminate/Container/BoundMethod.php(87): Illuminate</span><span class="se">\\</span><span class="s2">Container</span><span class="se">\\</span><span class="s2">BoundMethod::Illuminate</span><span class="se">\\</span><span class="s2">Container</span><span class="se">\\</span><span class="si">{</span><span class="nv">closure</span><span class="si">}</span><span class="s2">()
#8 /data/wwwroot/default/coin/vendor/laravel/framework/src/Illuminate/Container/BoundMethod.php(31): Illuminate</span><span class="se">\\</span><span class="s2">Container</span><span class="se">\\</span><span class="s2">BoundMethod::callBoundMethod(Object(Illuminate</span><span class="se">\\</span><span class="s2">Foundation</span><span class="se">\\</span><span class="s2">Application), Array, Object(Closure))
#9 /data/wwwroot/default/coin/vendor/laravel/framework/src/Illuminate/Container/Container.php(549): Illuminate</span><span class="se">\\</span><span class="s2">Container</span><span class="se">\\</span><span class="s2">BoundMethod::call(Object(Illuminate</span><span class="se">\\</span><span class="s2">Foundation</span><span class="se">\\</span><span class="s2">Application), Array, Array, NULL)
#10 /data/wwwroot/default/coin/vendor/laravel/framework/src/Illuminate/Console/Command.php(183): Illuminate</span><span class="se">\\</span><span class="s2">Container</span><span class="se">\\</span><span class="s2">Container-&gt;call(Array)
#11 /data/wwwroot/default/coin/vendor/symfony/console/Command/Command.php(255): Illuminate</span><span class="se">\\</span><span class="s2">Console</span><span class="se">\\</span><span class="s2">Command-&gt;execute(Object(Symfony</span><span class="se">\\</span><span class="s2">Component</span><span class="se">\\</span><span class="s2">Console</span><span class="se">\\</span><span class="s2">Input</span><span class="se">\\</span><span class="s2">ArgvInput), Object(Illuminate</span><span class="se">\\</span><span class="s2">Console</span><span class="se">\\</span><span class="s2">OutputStyle))
#12 /data/wwwroot/default/coin/vendor/laravel/framework/src/Illuminate/Console/Command.php(170): Symfony</span><span class="se">\\</span><span class="s2">Component</span><span class="se">\\</span><span class="s2">Console</span><span class="se">\\</span><span class="s2">Command</span><span class="se">\\</span><span class="s2">Command-&gt;run(Object(Symfony</span><span class="se">\\</span><span class="s2">Component</span><span class="se">\\</span><span class="s2">Console</span><span class="se">\\</span><span class="s2">Input</span><span class="se">\\</span><span class="s2">ArgvInput), Object(Illuminate</span><span class="se">\\</span><span class="s2">Console</span><span class="se">\\</span><span class="s2">OutputStyle))
#13 /data/wwwroot/default/coin/vendor/symfony/console/Application.php(953): Illuminate</span><span class="se">\\</span><span class="s2">Console</span><span class="se">\\</span><span class="s2">Command-&gt;run(Object(Symfony</span><span class="se">\\</span><span class="s2">Component</span><span class="se">\\</span><span class="s2">Console</span><span class="se">\\</span><span class="s2">Input</span><span class="se">\\</span><span class="s2">ArgvInput), Object(Symfony</span><span class="se">\\</span><span class="s2">Component</span><span class="se">\\</span><span class="s2">Console</span><span class="se">\\</span><span class="s2">Output</span><span class="se">\\</span><span class="s2">ConsoleOutput))
#14 /data/wwwroot/default/coin/vendor/symfony/console/Application.php(248): Symfony</span><span class="se">\\</span><span class="s2">Component</span><span class="se">\\</span><span class="s2">Console</span><span class="se">\\</span><span class="s2">Application-&gt;doRunCommand(Object(Illuminate</span><span class="se">\\</span><span class="s2">Queue</span><span class="se">\\</span><span class="s2">Console</span><span class="se">\\</span><span class="s2">WorkCommand), Object(Symfony</span><span class="se">\\</span><span class="s2">Component</span><span class="se">\\</span><span class="s2">Console</span><span class="se">\\</span><span class="s2">Input</span><span class="se">\\</span><span class="s2">ArgvInput), Object(Symfony</span><span class="se">\\</span><span class="s2">Component</span><span class="se">\\</span><span class="s2">Console</span><span class="se">\\</span><span class="s2">Output</span><span class="se">\\</span><span class="s2">ConsoleOutput))
#15 /data/wwwroot/default/coin/vendor/symfony/console/Application.php(148): Symfony</span><span class="se">\\</span><span class="s2">Component</span><span class="se">\\</span><span class="s2">Console</span><span class="se">\\</span><span class="s2">Application-&gt;doRun(Object(Symfony</span><span class="se">\\</span><span class="s2">Component</span><span class="se">\\</span><span class="s2">Console</span><span class="se">\\</span><span class="s2">Input</span><span class="se">\\</span><span class="s2">ArgvInput), Object(Symfony</span><span class="se">\\</span><span class="s2">Component</span><span class="se">\\</span><span class="s2">Console</span><span class="se">\\</span><span class="s2">Output</span><span class="se">\\</span><span class="s2">ConsoleOutput))
#16 /data/wwwroot/default/coin/vendor/laravel/framework/src/Illuminate/Console/Application.php(88): Symfony</span><span class="se">\\</span><span class="s2">Component</span><span class="se">\\</span><span class="s2">Console</span><span class="se">\\</span><span class="s2">Application-&gt;run(Object(Symfony</span><span class="se">\\</span><span class="s2">Component</span><span class="se">\\</span><span class="s2">Console</span><span class="se">\\</span><span class="s2">Input</span><span class="se">\\</span><span class="s2">ArgvInput), Object(Symfony</span><span class="se">\\</span><span class="s2">Component</span><span class="se">\\</span><span class="s2">Console</span><span class="se">\\</span><span class="s2">Output</span><span class="se">\\</span><span class="s2">ConsoleOutput))
#17 /data/wwwroot/default/coin/vendor/laravel/framework/src/Illuminate/Foundation/Console/Kernel.php(121): Illuminate</span><span class="se">\\</span><span class="s2">Console</span><span class="se">\\</span><span class="s2">Application-&gt;run(Object(Symfony</span><span class="se">\\</span><span class="s2">Component</span><span class="se">\\</span><span class="s2">Console</span><span class="se">\\</span><span class="s2">Input</span><span class="se">\\</span><span class="s2">ArgvInput), Object(Symfony</span><span class="se">\\</span><span class="s2">Component</span><span class="se">\\</span><span class="s2">Console</span><span class="se">\\</span><span class="s2">Output</span><span class="se">\\</span><span class="s2">ConsoleOutput))
#18 /data/wwwroot/default/coin/artisan(37): Illuminate</span><span class="se">\\</span><span class="s2">Foundation</span><span class="se">\\</span><span class="s2">Console</span><span class="se">\\</span><span class="s2">Kernel-&gt;handle(Object(Symfony</span><span class="se">\\</span><span class="s2">Component</span><span class="se">\\</span><span class="s2">Console</span><span class="se">\\</span><span class="s2">Input</span><span class="se">\\</span><span class="s2">ArgvInput), Object(Symfony</span><span class="se">\\</span><span class="s2">Component</span><span class="se">\\</span><span class="s2">Console</span><span class="se">\\</span><span class="s2">Output</span><span class="se">\\</span><span class="s2">ConsoleOutput))
#19 </span><span class="si">{</span><span class="nv">main</span><span class="si">}</span><span class="s2">

</span></code></pre></div></div>

<h2 id="参考文章">参考文章</h2>
<p><a href="https://blog.csdn.net/kkevinyang/article/details/80539940">supervisor常见报错</a></p>

<hr />

</article>


        </br>
        <hr align="center" width="100%" color="#F1F1F1" size="3"></hr>
        <p id="copyright">
  Powered by <a href="http://jekyllrb.com">Jekyll</a> & <a href="https://github.com/P233/3-Jekyll">3-Jekyll</a> & <a href="http://pages.github.com">GitHub</a>
  </br>
  Copyright © 2019 - 2020 <a href="/index.html">ZhifanRen</a> All Rights Reserved.
  &nbsp;
</p>

      </div> <!-- end #pjax -->

      <div id="post__toc-trigger">
        <div id="post__toc">
          <span id="post__toc-title">章节列表</span>
          <ul id="post__toc-ul"></ul>
        </div>
      </div>
    </div> <!-- end #post -->
    <script src="/assets/js/jquery.js"></script>
<script src="/assets/js/jquery.pjax.js"></script>
<script src="/assets/js/nprogress.js"></script>
<script src="/assets/js/searchbox.js"></script>
<script src="/assets/js/script.js"></script>


   </body>
 </html>

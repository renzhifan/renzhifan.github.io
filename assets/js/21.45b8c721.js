(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{440:function(s,a,t){"use strict";t.r(a);var e=t(33),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"_1-初始化系统"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-初始化系统"}},[s._v("#")]),s._v(" 1.初始化系统")]),s._v(" "),t("h2",{attrs:{id:"实验环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实验环境"}},[s._v("#")]),s._v(" 实验环境")]),s._v(" "),t("blockquote",[t("p",[s._v("我们基于一台全新的 Ubuntu  18.04 LTS 服务器")])]),s._v(" "),t("h2",{attrs:{id:"更新软件源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#更新软件源"}},[s._v("#")]),s._v(" 更新软件源")]),s._v(" "),t("p",[s._v("登录到服务器，我们首先要做的就是更新软件源：")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" update\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("blockquote",[t("p",[s._v("注意：这里所说的「更新软件源」并非升级软件，在中文内更加准确的描述应当是 "),t("strong",[s._v("刷新软件源")]),s._v("。在这个过程中，包管理器（也就是 APT，可以理解为「软件管家」之类）将会从 "),t("strong",[s._v("软件源")]),s._v(" 服务器上获取一份最新的包列表并建立本地缓存，包括软件名称、描述、最新版本、下载地址等等。")])]),s._v(" "),t("p",[s._v("你将会看到类似这样的输出：")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("root@JD:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# apt update")]),s._v("\nHit:1 http://mirrors.jdcloudcs.com/ubuntu bionic InRelease\nHit:2 http://mirrors.jdcloudcs.com/ubuntu bionic-updates InRelease\nHit:3 http://mirrors.jdcloudcs.com/ubuntu bionic-backports InRelease\nHit:4 http://mirrors.jdcloudcs.com/ubuntu bionic-security InRelease\nReading package lists"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". Done\nBuilding dependency tree       \nReading state information"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". Done\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("112")]),s._v(" packages can be upgraded. Run "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'apt list --upgradable'")]),s._v(" to see them.\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("最后一行有这样的提示：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("112 packages can be upgraded. Run 'apt list --upgradable' to see them.\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("意为有 112 个软件包可升级，执行 "),t("code",[s._v("apt list --upgradable")]),s._v(" 命令来查看它们。")]),s._v(" "),t("p",[s._v("我们暂且忽略，直接升级：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("$ apt upgrade\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("blockquote",[t("p",[s._v("注意：生产环境下，更新任何软件包前都需要仔细检查，确保更新日志内没有影响现有环境的改动。另外，你也可以先不升级，对后续部署基本没有影响。")])]),s._v(" "),t("p",[s._v("你将会看到一大坨（是的，一坨）输出，它们是将被升级的软件列表；注意关注最后几行：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("112 upgraded, 5 newly installed, 0 to remove and 0 not upgraded.\nNeed to get 196 MB of archives.\nAfter this operation, 348 MB of additional disk space will be used.\nDo you want to continue? [Y/n] \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("意为此操作将占用 348 MB 磁盘空间。此时输入 "),t("code",[s._v("Y")]),s._v("（注意关闭中文输入法），或直接回车即可开始升级。主流云服务厂商均有缓存软件源，数据流量是通过内网传输，所以该过程不会太慢。")]),s._v(" "),t("h2",{attrs:{id:"本地化配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#本地化配置"}},[s._v("#")]),s._v(" 本地化配置")]),s._v(" "),t("p",[s._v("所谓「本地化配置」，可理解为系统时区、单位、地址、语言等配置的统称。使其能够符合某一地区的习惯。虽然我们的母语是中文，但还是建议将服务器配置为英语，尽可能避免奇葩乱码等问题带来的影响。")]),s._v(" "),t("p",[s._v("首先，执行以下命令生成美国本地化数据：")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ locale-gen en_US.UTF-8\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("随后将本地化配置修改为 "),t("code",[s._v("en_US.UTF-8")]),s._v(" 即可：")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ update-locale "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("LC_ALL")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("en_US.UTF-8\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("如果服务器在国外，则服务商可能不会将其配置为东八区；我们还需手动修改时区为 "),t("code",[s._v("Asia/Shanghai")]),s._v("：")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("timedatectl set-timezone Asia/Shanghai\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("若你是在国内云服务商租用的服务器，那么极有可能时区已经配置好了。")]),s._v(" "),t("p",[s._v("至此，系统初始化阶段完成。")]),s._v(" "),t("h1",{attrs:{id:"_2-安装-nginx"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-安装-nginx"}},[s._v("#")]),s._v(" 2.安装 Nginx")]),s._v(" "),t("p",[s._v("上节我们刚刚完成一些基础的初始化工作；接下来，可以开始安装软件包了。在本课程内，我将使用大名鼎鼎的 Nginx 作为 Web 服务。")]),s._v(" "),t("h2",{attrs:{id:"通过apt安装-nginx"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#通过apt安装-nginx"}},[s._v("#")]),s._v(" 通过apt安装 Nginx")]),s._v(" "),t("p",[s._v("由于我们执行 "),t("code",[s._v("apt update")]),s._v(" 更新软件源不久，所以直接安装 Nginx 即可：")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" nginx\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("再次收到确认提示：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("0 upgraded, 18 newly installed, 0 to remove and 0 not upgraded.\nNeed to get 2,461 kB of archives.\nAfter this operation, 8,210 kB of additional disk space will be used.\nDo you want to continue? [Y/n] \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("上节为大家介绍过输入 "),t("code",[s._v("Y")]),s._v(" 或直接回车均可继续，也就是说此处的询问默认结果为 "),t("code",[s._v("Y")]),s._v("。有个普遍共识是，在提供选项供用户选择时，以大写项为默认值。例如此处的 "),t("code",[s._v("[Y/n]")]),s._v(" 那么 "),t("code",[s._v("Y")]),s._v(" 即为默认值；同理，若是 "),t("code",[s._v("[a/b/c/D/e]")]),s._v("，那么 "),t("code",[s._v("D")]),s._v(" 即为默认值。")]),s._v(" "),t("p",[s._v("另外，上节介绍了更新软件源即为包管理器从软件源服务器拉取软件包列表并建立本地缓存。其实，当我们执行 "),t("code",[s._v("apt install")]),s._v(" 操作时，包管理器便会从本地缓存中找到该软件包的指定版本，并进行下载、安装。")]),s._v(" "),t("p",[s._v("稍等几秒钟即可安装成功：")]),s._v(" "),t("h2",{attrs:{id:"管理-nginx-服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#管理-nginx-服务"}},[s._v("#")]),s._v(" 管理 Nginx 服务")]),s._v(" "),t("p",[s._v("我们可使用 "),t("code",[s._v("service")]),s._v(" 命令管理服务状态，常用操作如下：")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" nginx start "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动 Nginx")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" nginx stop "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停止 Nginx")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" nginx restart "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启 Nginx")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("同时，可使用 "),t("code",[s._v("systemctl")]),s._v(" 命令开关服务的开机自启：")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" nginx "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启用 Nginx 开机启动")]),s._v("\n$ systemctl disable nginx "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 禁用 Nginx 开机启动")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("blockquote",[t("p",[s._v("注意：通常情况下，在 APT 安装后已默认启用 Nginx 开机启动。")])]),s._v(" "),t("h2",{attrs:{id:"确认-nginx-正常运行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#确认-nginx-正常运行"}},[s._v("#")]),s._v(" 确认 Nginx 正常运行")]),s._v(" "),t("p",[s._v("在浏览器内输入服务器公网 IP（或域名）并打开，出现默认欢迎页面说明 Nginx 已经正常运行：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/renzhifan/image/master/img/lnmp_nginx.png",alt:""}})]),s._v(" "),t("p",[s._v("恭喜，Nginx 安装成功。")]),s._v(" "),t("h1",{attrs:{id:"_3-安装-php-fpm"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-安装-php-fpm"}},[s._v("#")]),s._v(" 3.安装 PHP-FPM")]),s._v(" "),t("p",[s._v("安装 PHP 7.3。")]),s._v(" "),t("h2",{attrs:{id:"配置第三方软件源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置第三方软件源"}},[s._v("#")]),s._v(" 配置第三方软件源")]),s._v(" "),t("p",[s._v("由于 Ubuntu 的官方软件源通常不包含最新版本的 PHP，因此需要添加一个包含最新 PHP 的第三方软件源。")]),s._v(" "),t("p",[s._v("在添加之前，我们首先安装名为 "),t("code",[s._v("software-properties-common")]),s._v(" 的软件包，它提供了快速管理软件源的实用脚本：")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y software-properties-common\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("相比之前执行的 "),t("code",[s._v("apt install")]),s._v(" 命令，这次我添加了 "),t("code",[s._v("-y")]),s._v(" 选项，表示当 APT 遇到询问时默认确认，避免再次输入 "),t("code",[s._v("Y")]),s._v(" 并回车。")]),s._v(" "),t("p",[s._v("随后，执行以下脚本添加第三方 PHP 软件源：")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ add-apt-repository -y ppa:ondrej/php\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("成功后别忘记刷新：")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"安装-php"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装-php"}},[s._v("#")]),s._v(" 安装 PHP")]),s._v(" "),t("p",[s._v("PHP 的安装实际上分为三个软件包：")]),s._v(" "),t("ul",[t("li",[s._v("PHP - PHP 自身。")]),s._v(" "),t("li",[s._v("PHP-CLI - PHP 的命令行接口，通俗地说，在命令行内执行 "),t("code",[s._v("php")]),s._v(" 便依赖于此包。")]),s._v(" "),t("li",[s._v("PHP-FPM - 全称为 "),t("code",[s._v("PHP FastCGI Process Manager")]),s._v("，用于管理 PHP 进程，并提供 FastCGI 接口与 Nginx 交互；浏览网页时的请求便是由 Nginx 交由 PHP-FPM 处理的。")])]),s._v(" "),t("p",[t("code",[s._v("apt install")]),s._v(" 支持多参数，所以我们不必执行多次安装，只需在单条命令内写明多个软件包即可：")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y php7.3 php7.3-cli php7.3-fpm php7.3-dev\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("按照 "),t("a",{attrs:{href:"https://laravel.com/docs/6.x/installation#installation",target:"_blank",rel:"noopener noreferrer"}},[s._v("Laravel安装文档"),t("OutboundLink")],1),s._v(" 的说明，接着安装几个必备的 PHP 扩展：")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y php7.3-mbstring php7.3-xml php7.3-bcmath\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("blockquote",[t("p",[s._v("注意：由于 PDO 等扩展已经内置在 PHP 中，故无需额外安装。")])]),s._v(" "),t("p",[s._v("对于不同项目的不同依赖，可能有必要安装以下扩展，根据实际情况选择即可：")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" php7.3-curl php7.3-gd php7.3-mysql php7.3-opcache php7.3-zip php7.3-sqlite3\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("有个小技巧是，你可以通过 "),t("code",[s._v("apt-cache")]),s._v(" 命令来搜索当前软件源内的包：")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-cache")]),s._v(" search php7.3\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("例如以上命令，将会得到所有名称、描述等信息内包含 "),t("code",[s._v("php7.3")]),s._v(" 字样的软件包：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("php-amqp - AMQP extension for PHP\nphp-apcu - APC User Cache for PHP\nphp-geoip - GeoIP module for PHP\n...\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h2",{attrs:{id:"管理-php-fpm-服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#管理-php-fpm-服务"}},[s._v("#")]),s._v(" 管理 PHP-FPM 服务")]),s._v(" "),t("p",[s._v("与管理 Nginx 服务类似，你同样可以通过 "),t("code",[s._v("service")]),s._v(" 和 "),t("code",[s._v("systemctl")]),s._v(" 命令管理 PHP-FPM 服务：")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" php7.3-fpm restart "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启 PHP-FPM")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" php7.3-fpm start "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动 PHP-FPM")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" php7.3-fpm stop "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停止 PHP-FPM")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" php7.3-fpm "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启用 PHP-FPM 开机启动")]),s._v("\n$ systemctl disable php7.3-fpm "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 禁用 PHP-FPM 开机启动")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("blockquote",[t("p",[s._v("注意：不同版本的 PHP-FPM 服务名是不一致的。例如 7.2 为 "),t("code",[s._v("php7.2-fpm")]),s._v("，7.3 为 "),t("code",[s._v("php7.3-fpm")]),s._v("，以此类推……")])]),s._v(" "),t("h2",{attrs:{id:"确认-php-fpm-正常运行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#确认-php-fpm-正常运行"}},[s._v("#")]),s._v(" 确认 PHP-FPM 正常运行")]),s._v(" "),t("p",[s._v("通过以下命令可确认 PHP-FPM 进程正在运行：")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" aux "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" php\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("其中：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("ps aux")]),s._v(" 用于列出系统当前正在运行的所有进程的所有信息。")]),s._v(" "),t("li",[t("code",[s._v("|")]),s._v(" 名为管道操作符，将前一条命令的标准输出连接到下一条命令的标准输入。")]),s._v(" "),t("li",[t("code",[s._v("grep")]),s._v(" 是一款文本搜索工具，常用来过滤命令行输出；"),t("code",[s._v("php")]),s._v(" 是搜索的关键词。")])]),s._v(" "),t("p",[t("code",[s._v("ps")]),s._v(" 将进程信息输出到 "),t("code",[s._v("grep")]),s._v(" 进行过滤，后者筛选出包含 "),t("code",[s._v("php")]),s._v(" 字样的行，再将它们输出。于是，它们相结合，产生的效果便是这样：")]),s._v(" "),t("div",{staticClass:"language-base line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("root@JD:~# ps aux | grep php\nroot     24292  0.0  0.2 314952 20508 ?        Ss   11:35   0:00 php-fpm: master process (/etc/php/7.3/fpm/php-fpm.conf)\nwww-data 24318  0.0  0.1 317252  8652 ?        S    11:35   0:00 php-fpm: pool www\nwww-data 24319  0.0  0.1 317252  8652 ?        S    11:35   0:00 php-fpm: pool www\nroot     24391  0.0  0.0  13136  1048 pts/0    S+   11:36   0:00 grep --color=auto php\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("忽略最后一行（这是我们正在执行的 "),t("code",[s._v("grep")]),s._v(" 命令），可观察到有 "),t("code",[s._v("php-fpm")]),s._v(" 进程正在运行中。")]),s._v(" "),t("p",[s._v("若 PHP-FPM 进程不存在，那么输出将只有孤零零的 "),t("code",[s._v("grep")]),s._v("：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("root     24391  0.0  0.0  13136  1048 pts/0    S+   11:36   0:00 grep --color=auto php\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("blockquote",[t("p",[s._v("提示：你可以结合上文提到的 "),t("code",[s._v("service")]),s._v(" 命令，将服务进程手动停止试试看；测试完毕不要忘记再次启动。")])]),s._v(" "),t("h1",{attrs:{id:"_4-composer"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-composer"}},[s._v("#")]),s._v(" 4.Composer")]),s._v(" "),t("p",[s._v("Composer 是部署 PHP 项目时必不可少的工具")]),s._v(" "),t("h2",{attrs:{id:"安装-composer"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装-composer"}},[s._v("#")]),s._v(" 安装 Composer")]),s._v(" "),t("p",[s._v("Composer 比较特殊，不能通过 APT 安装。虽然网络上流传着一大堆从第三方服务器直接下载 "),t("code",[s._v("composer.phar")]),s._v(" 文件的安装方式，但根据 Composer 的官方文档，正确的安装姿势应当为：")]),s._v(" "),t("h3",{attrs:{id:"第一种方式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第一种方式"}},[s._v("#")]),s._v(" 第一种方式")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://getcomposer.org/download/",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考链接"),t("OutboundLink")],1)]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("php -r "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"copy('https://getcomposer.org/installer', 'composer-setup.php');\"")]),s._v("\nphp -r "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"if (hash_file('sha384', 'composer-setup.php') === 'baf1608c33254d00611ac1705c1d9958c817a1a33bce370c0595974b342601bd80b92a3f46067da89e3b06bff421f182') { echo 'Installer verified'; } else { echo 'Installer corrupt'; unlink('composer-setup.php'); } echo PHP_EOL;\"")]),s._v("\nphp composer-setup.php\nphp -r "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"unlink('composer-setup.php');\"")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"第二种方式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第二种方式"}},[s._v("#")]),s._v(" 第二种方式")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://docs.phpcomposer.com/00-intro.html#Globally",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考链接"),t("OutboundLink")],1)]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -sS https://getcomposer.org/installer "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" php\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" composer.phar /usr/local/bin/composer\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"第三种方式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第三种方式"}},[s._v("#")]),s._v(" 第三种方式")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://getcomposer.org/doc/faqs/how-to-install-composer-programmatically.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考链接"),t("OutboundLink")],1)]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://raw.githubusercontent.com/composer/getcomposer.org/master/web/installer -O - -q "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" php -- --filename"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("composer --install-dir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/bin\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("blockquote",[t("p",[s._v("注意：通过第三方服务器、直接下载 "),t("code",[s._v("composer.phar")]),s._v(" 不进行任何检查，均无法保证 Composer 正常运行，且存在安全风险！请务必遵循官方文档内的说明。")])]),s._v(" "),t("p",[s._v("稍等片刻，将会出现以下输出：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("All settings correct for using Composer\nDownloading...\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("blockquote",[t("p",[s._v("这里最好按照第二种方式  执行 mv composer.phar /usr/local/bin/composer\n然后可以在任何地方执行composer了")])]),s._v(" "),t("p",[s._v("提示当前环境检查通过，可正常使用 Composer；随后开始下载。")]),s._v(" "),t("p",[s._v("鉴于众所周知的原因，大陆访问国际网络速度奇慢无比，请耐心等待。当出现以下提示时，表示已经安装成功：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("Composer (version 1.9.1) successfully installed to: /root/composer.phar\nUse it: php composer.phar\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("按照提示，我们可以使用 "),t("code",[s._v("/usr/local/bin/composer")]),s._v(" 运行 Composer，当然，还有个更简单的方法：")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" composer.phar /usr/local/bin/composer\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("composer")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("你可能会收到这样一条警告：")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("Do not run Composer as root/super user"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" See https://getcomposer.org/root "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" details\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("意为请勿使用根用户运行 Composer；暂时不必关心它，我将在后续课程中详细说明。")]),s._v(" "),t("h2",{attrs:{id:"配置-packagist-中国镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置-packagist-中国镜像"}},[s._v("#")]),s._v(" 配置 Packagist 中国镜像")]),s._v(" "),t("p",[s._v("这一步是可选的。如果你的服务器位于大陆，强烈建议使用可信赖的代理，或是国内 Packagist 镜像。")]),s._v(" "),t("p",[s._v("推荐使用阿里云提供的 "),t("a",{attrs:{href:"https://developer.aliyun.com/composer",target:"_blank",rel:"noopener noreferrer"}},[s._v("Packagist 中国镜像"),t("OutboundLink")],1),s._v("，执行以下命令即可切换服务器内 Composer 的默认 Packagist 源：")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("composer")]),s._v(" config -g repo.packagist "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("composer")]),s._v(" https://mirrors.aliyun.com/composer/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h1",{attrs:{id:"_5-部署应用代码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-部署应用代码"}},[s._v("#")]),s._v(" 5.部署应用代码")]),s._v(" "),t("blockquote",[t("p",[s._v("这里以laravel项目为例")])]),s._v(" "),t("h2",{attrs:{id:"创建一个新项目"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建一个新项目"}},[s._v("#")]),s._v(" 创建一个新项目")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://laravel.com/docs/6.x/installation#installation",target:"_blank",rel:"noopener noreferrer"}},[s._v("laravel官网"),t("OutboundLink")],1)]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /var/www/\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("composer")]),s._v(" create-project --prefer-dist laravel/laravel blog\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("若提示是没有zip扩展  那么请首先安装扩展")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" php7.3-zip -y\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"配置文件所有者"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置文件所有者"}},[s._v("#")]),s._v(" 配置文件所有者")]),s._v(" "),t("p",[s._v("最后，别忘记修改文件所有者：")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R www-data:www-data "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("由于目前所在的工作目录为 "),t("code",[s._v("/var/www/blog")]),s._v("，所以可用表示当前工作目录的 "),t("code",[s._v(".")]),s._v(" 代替之前的 "),t("code",[s._v("/var/www/blog")]),s._v("，它们是等效的。")]),s._v(" "),t("p",[s._v("至此，本小节目标完成。你可以通过 "),t("code",[s._v("ll")]),s._v(" 命令来列出当前目录：")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("root@JD:/var/www/blog"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll")]),s._v("\ntotal "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")]),s._v("\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" www-data www-data   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Dec "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":03 ./\ndrwxr-xr-x  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" root     root       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Dec "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":02 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h1",{attrs:{id:"_6-配置-nginx-站点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-配置-nginx-站点"}},[s._v("#")]),s._v(" 6.配置 Nginx 站点")]),s._v(" "),t("h2",{attrs:{id:"nginx-站点配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx-站点配置"}},[s._v("#")]),s._v(" Nginx 站点配置")]),s._v(" "),t("p",[s._v("根据 "),t("a",{attrs:{href:"https://laravel.com/docs/6.x/deployment",target:"_blank",rel:"noopener noreferrer"}},[s._v("Laravel部署文档"),t("OutboundLink")],1),s._v(" 的说明，我们可直接拿到一份现成的 Nginx 配置文件，稍作调整即可：")]),s._v(" "),t("blockquote",[t("p",[s._v("我这里做了下解释说明 "),t("a",{attrs:{href:"https://wi1dcard.dev/posts/laravel-recommended-nginx-conf-analysis/",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考文章"),t("OutboundLink")],1)])]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#监听 HTTP 协议默认的 [80] 端口。")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#绑定主机名 [example.com]。")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" example.com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#服务器站点根目录 [/example.com/public]。")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" /example.com/public")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加几条有关安全的响应头")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" X-Frame-Options "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SAMEORIGIN"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" X-XSS-Protection "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1; mode=block"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" X-Content-Type-Options "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nosniff"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 站点默认页面；可指定多个，将顺序查找。")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 例如，访问 http://example.com/ Nginx 将首先尝试「站点根目录/index.html」是否存在，不存在则继续尝试「站点根目录/index.htm」，以此类推...")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" index.html index.htm index.php")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定字符集为 UTF-8")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("charset")]),s._v(" utf-8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Laravel 默认重写规则；删除将导致 Laravel 路由失效且 Nginx 响应 404。")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try_files")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v("/ /index.php?"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$query_string")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭 [/favicon.ico] 和 [/robots.txt] 的访问日志。")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 并且即使它们不存在，也不写入错误日志。")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" = /favicon.ico")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("access_log")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("off")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("log_not_found")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("off")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" = /robots.txt")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("access_log")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("off")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("log_not_found")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("off")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将 [404] 错误交给 [/index.php] 处理，表示由 Laravel 渲染美观的错误页面。")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("error_page")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("404")]),s._v(" /index.php")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# URI 符合正则表达式 [\\.php$] 的请求将进入此段配置")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ~ \\.php$")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置 FastCGI 服务地址，可以为 IP:端口，也可以为 Unix socket。")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fastcgi_pass")]),s._v(" unix:/var/run/php/php7.2-fpm.sock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置 FastCGI 的主页为 index.php。")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fastcgi_index")]),s._v(" index.php")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置 FastCGI 参数 SCRIPT_FILENAME 为 $realpath_root$fastcgi_script_name。")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fastcgi_param")]),s._v(" SCRIPT_FILENAME "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$realpath_root")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$fastcgi_script_name")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 引用更多默认的 FastCGI 参数。")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),s._v(" fastcgi_params")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通俗地说，以上配置将所有 URI 以 .php 结尾的请求，全部交给 PHP-FPM 处理。")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 除符合正则表达式 [/\\.(?!well-known).*] 之外的 URI，全部拒绝访问")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 也就是说，拒绝公开以 [.] 开头的目录，[.well-known] 除外")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ~ /\\.(?!well-known).*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("deny")]),s._v(" all")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br")])]),t("p",[s._v("通常我们仅需修改 "),t("code",[s._v("server_name")]),s._v("、"),t("code",[s._v("root")]),s._v(" 和 "),t("code",[s._v("fastcgi_pass")]),s._v("；请注意阅读 "),t("code",[s._v("#")]),s._v(" 后的注释。")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /etc/nginx/sites-available\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v("  blog.cn "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#填入你对应的配置信息")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#建立软连接")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s /etc/nginx/sites-available/acme.cn /etc/nginx/sites-enabled/\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#检测nginx配置是否正确")]),s._v("\nnginx -t\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置正常返回如下结果")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#nginx: the configuration file /etc/nginx/nginx.conf syntax is ok")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#nginx: configuration file /etc/nginx/nginx.conf test is successful")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重启nginx")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" nginx restart\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重启fpm 这里一定要重启")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" php7.3-fpm restart\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("h2",{attrs:{id:"fastcgi-服务地址为-ip-端口时的配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#fastcgi-服务地址为-ip-端口时的配置"}},[s._v("#")]),s._v(" FastCGI 服务地址为 IP:端口时的配置")]),s._v(" "),t("h3",{attrs:{id:"首先修改php的配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#首先修改php的配置文件"}},[s._v("#")]),s._v(" 首先修改php的配置文件")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/php/7.3/fpm/pool.d/www.conf\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("blockquote",[t("p",[s._v("在37行加入如下代码")])]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v(" listen "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:9000\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("blockquote",[t("p",[s._v("另外需要注意下如果配置文件内有 listen =/run/php/php7.3-fpm.sock 最好注释 以免冲突")])]),s._v(" "),t("h3",{attrs:{id:"配置一"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置一"}},[s._v("#")]),s._v(" 配置一")]),s._v(" "),t("p",[s._v("若fpm配置文件中配置如下：")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v(" listen "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:9000\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("则对应的nginx.conf中的配置应为：")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v(" fastcgi_pass   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:9000"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("blockquote",[t("p",[s._v("此时开启9000端口监听，不会生成sock文件")])]),s._v(" "),t("h3",{attrs:{id:"配置二"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置二"}},[s._v("#")]),s._v(" 配置二")]),s._v(" "),t("p",[s._v("若fpm中的配置为使用Unix套接字，如下：")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v(" listen "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /run/php/php7.3-fpm.sock\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("则对应nginx.conf中的配置应为：")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v(" fastcgi_pass   unix:/run/php/php7.3-fpm.sock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("blockquote",[t("p",[s._v("此时9000端口未开启，在/run/php/下生成php7.2-fpm.sock文件：")])]),s._v(" "),t("h3",{attrs:{id:"注意"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#注意"}},[s._v("#")]),s._v(" 注意")]),s._v(" "),t("blockquote",[t("p",[s._v("若两者不匹配则nginx启动失败。")])]),s._v(" "),t("blockquote",[t("p",[s._v("若fpm为sock，nginx为127.0.0.1:9000，则会出现以下错误：")])]),s._v(" "),t("blockquote",[t("p",[s._v("connect() failed (111: Connection refused) while connecting to upstream")])]),s._v(" "),t("blockquote",[t("p",[s._v("若fpm未127.0.0.1:9000,nginx为sock，则会出现以下错误：")])]),s._v(" "),t("blockquote",[t("p",[s._v("connect() to unix:/run/php/php7.2-fpm.sock failed (2: No such file or directory) while connecting to upstream")])]),s._v(" "),t("h2",{attrs:{id:"重载-nginx"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#重载-nginx"}},[s._v("#")]),s._v(" 重载 Nginx")]),s._v(" "),t("p",[s._v("配置完成后，请务必重启（Restart）或重载（Reload）Nginx。")]),s._v(" "),t("p",[s._v("什么是 "),t("strong",[s._v("重载")]),s._v("？实际上，直接重启 Nginx 是不安全的。原因有二：")]),s._v(" "),t("ul",[t("li",[s._v("在 Nginx 进程结束再重新运行的过程中，将造成极短时间的闪断。虽然这一时间通常很短（一般来说在秒级别），但倘若面对大量并发，还是极易造成一部分请求无法访问，即服务中断。")]),s._v(" "),t("li",[s._v("在重启的过程中，若此时 Nginx 恰好正在处理请求，与客户端的 TCP 连接将会断开，客户端无法收到正确响应，造成前后端信息不一致。")])]),s._v(" "),t("p",[s._v("在之前的小节中，已经提到重启 Nginx 的方法；")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" nginx restart\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("同样地，亦可使用 "),t("code",[s._v("service")]),s._v(" 命令重载 Nginx：")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" nginx reload\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("另一种等效的方法是：")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ nginx -s reload\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"最终效果"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#最终效果"}},[s._v("#")]),s._v(" 最终效果")]),s._v(" "),t("p",[s._v("在浏览器内输入服务器公网 IP 或域名并访问，你将会看到 Laravel 应用的默认主页：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/renzhifan/image/master/img/laravel_hellow.png",alt:""}}),s._v("\n恭喜你，部署成功。")]),s._v(" "),t("h1",{attrs:{id:"_7-安装mysql"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-安装mysql"}},[s._v("#")]),s._v(" 7.安装MYSQL")]),s._v(" "),t("h2",{attrs:{id:"通过apt安装mysql"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#通过apt安装mysql"}},[s._v("#")]),s._v(" 通过apt安装mysql")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" mysql-server mysql-client -y\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"管理-mysql-服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#管理-mysql-服务"}},[s._v("#")]),s._v(" 管理 Mysql 服务")]),s._v(" "),t("p",[s._v("我们可使用 "),t("code",[s._v("service")]),s._v(" 命令管理服务状态，常用操作如下：")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" mysql start "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动 Mysql")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" mysql stop "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停止 Mysql")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" mysql restart "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启 Mysql")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("同时，可使用 "),t("code",[s._v("systemctl")]),s._v(" 命令开关服务的开机自启：")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" mysql "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启用 Mysql 开机启动")]),s._v("\n$ systemctl disable mysql "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 禁用 Mysql 开机启动")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("通过以上配置，可使 Nginx 匹配请求 URI，若以 "),t("code",[s._v("js")]),s._v(" 或 "),t("code",[s._v("css")]),s._v(" 结尾，则将响应头 "),t("code",[s._v("Expires")]),s._v(" 的值设置为 "),t("code",[s._v("24h")]),s._v(" 返回。客户端浏览器将根据该值建立资源缓存，并在指定时间后过期，因此可节省部分服务器静态资源流量。"),t("code",[s._v("24h")]),s._v(" 可根据需要调整，若使用 CDN 服务分发静态资源，则不必配置此项。")]),s._v(" "),t("h2",{attrs:{id:"测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[s._v("#")]),s._v(" 测试")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("root@JD:/var/run/php"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql -u root -p")]),s._v("\nEnter password: \nWelcome to the MySQL monitor.  Commands end with "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" or "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("g.\nYour MySQL connection "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" is "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\nServer version: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.7")]),s._v(".28-0ubuntu0.18.04.4 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Ubuntu"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nCopyright "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v(", Oracle and/or its affiliates. All rights reserved.\n\nOracle is a registered trademark of Oracle Corporation and/or its\naffiliates. Other names may be trademarks of their respective\nowners.\n\nType "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'help;'")]),s._v(" or "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\h'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" help. Type "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\c'")]),s._v(" to "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("clear")]),s._v(" the current input statement.\n\nmysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("p",[s._v("出现以上结果说明mysql安装成功")]),s._v(" "),t("p",[s._v("进入数据库后输入命令 设置新的密码")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("use mysql"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nupdate mysql.user "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("authentication_string")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("PASSWORD"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'新密码'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("plugin")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mysql_native_password'")]),s._v(" where "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("user")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'root'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#执行成功显示如下")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Query OK, 1 row affected, 1 warning (0.00 sec)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Rows matched: 1  Changed: 1  Warnings: 1")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#刷新权限")]),s._v("\nflush privileges"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Query OK, 0 rows affected (0.00 sec)")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[s._v("重启MySQL服务，再次进入数据库吗，输入新设置的密码 重启mysql服务")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" mysql restart\n\nmysql -u root -p\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h2",{attrs:{id:"mysql-创建新用户"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysql-创建新用户"}},[s._v("#")]),s._v(" mysql 创建新用户")]),s._v(" "),t("h3",{attrs:{id:"创建一个所有权用户"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建一个所有权用户"}},[s._v("#")]),s._v(" 创建一个所有权用户")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("mysql -u root -p\nmysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("create user db_user@"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%'")]),s._v(" identified by "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'db_password'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建用户")]),s._v("\nmysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" grant all privileges on *.* to db_user@"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%'")]),s._v(" with grant option"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#授权")]),s._v("\nflush privileges"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"创建一个条件限制用户"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建一个条件限制用户"}},[s._v("#")]),s._v(" 创建一个条件限制用户")]),s._v(" "),t("blockquote",[t("p",[s._v("添加一个用户名为db_user，密码为db_pass，授权为% （%表示所有IP能连接）对db_name数据库所有权限，命令如下：")])]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#MySQL8.0版本")]),s._v("\nmysql -u root -p\nmysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("create user db_user@"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%'")]),s._v(" identified by "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'db_pass'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建用户")]),s._v("\nmysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" grant all privileges on db_name.* to db_user@"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%'")]),s._v(" with grant option"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#授权")]),s._v("\nflush privileges"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#其余MySQL版本")]),s._v("\nmysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" grant all privileges on db_name.* to db_user@"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%'")]),s._v(" identified by "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'db_pass'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#授权语句，特别注意有分号")]),s._v("\nflush privileges"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h3",{attrs:{id:"注意-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#注意-2"}},[s._v("#")]),s._v(" 注意")]),s._v(" "),t("blockquote",[t("p",[s._v("最后记得重启  service mysql restart 还有 如果是云服务器 记得设置安全组允许端口访问")])]),s._v(" "),t("h3",{attrs:{id:"设置允许外网访问"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#设置允许外网访问"}},[s._v("#")]),s._v(" 设置允许外网访问")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/mysql/mysql.conf.d/mysqld.cnf\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注释掉 #bind-address = 127.0.0.1")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#再重启启动mysql 生效")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" mysql restart\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h2",{attrs:{id:"测试-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#测试-2"}},[s._v("#")]),s._v(" 测试")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/renzhifan/image/master/img/20201010114437.png",alt:""}})]),s._v(" "),t("h1",{attrs:{id:"_8-生产环境的必要优化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-生产环境的必要优化"}},[s._v("#")]),s._v(" 8.生产环境的必要优化")]),s._v(" "),t("p",[s._v("本篇内容部分摘选自 "),t("a",{attrs:{href:"https://laravel.com/docs/6.x/deployment",target:"_blank",rel:"noopener noreferrer"}},[s._v("Laravel部署文档"),t("OutboundLink")],1),s._v("，你可以阅读该文档获取更多信息。")]),s._v(" "),t("h2",{attrs:{id:"nginx-配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx-配置"}},[s._v("#")]),s._v(" Nginx 配置")]),s._v(" "),t("p",[s._v("对于 Laravel 应用来说，优化 Nginx 配置所带来的性能提升可谓微不足道。因此不建议在中小型项目中花费较多精力调优 Nginx。")]),s._v(" "),t("p",[s._v("不过，有一点值得注意：")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("server "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ...")]),s._v("\n    location ~* "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("js"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("css"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$ "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        expires 24h"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#...")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("通过以上配置，可使 Nginx 匹配请求 URI，若以 "),t("code",[s._v("js")]),s._v(" 或 "),t("code",[s._v("css")]),s._v(" 结尾，则将响应头 "),t("code",[s._v("Expires")]),s._v(" 的值设置为 "),t("code",[s._v("24h")]),s._v(" 返回。客户端浏览器将根据该值建立资源缓存，并在指定时间后过期，因此可节省部分服务器静态资源流量。"),t("code",[s._v("24h")]),s._v(" 可根据需要调整，若使用 CDN 服务分发静态资源，则不必配置此项。")]),s._v(" "),t("h2",{attrs:{id:"laravel-的配置缓存与路由缓存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#laravel-的配置缓存与路由缓存"}},[s._v("#")]),s._v(" Laravel 的配置缓存与路由缓存")]),s._v(" "),t("p",[s._v("开启 "),t("strong",[s._v("配置缓存")]),s._v(" 和 "),t("strong",[s._v("路由缓存")]),s._v(" 能够在一定程度上提升 Laravel 的性能。")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ php artisan config:cache "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生成配置缓存")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("blockquote",[t("p",[s._v("注意：当开启配置缓存后，"),t("code",[s._v("env()")]),s._v(" 函数将会失效；它将会永远返回 "),t("code",[s._v("null")]),s._v("；因此务必确保在非配置文件内，未直接调用该函数。")])]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ php artisan route:cache "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生成路由缓存")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("blockquote",[t("p",[s._v("注意：路由缓存仅支持控制器风格；若路由注册时存在闭包（Closures），则无法使用该功能。")])]),s._v(" "),t("blockquote",[t("p",[s._v("注意：生成缓存后，对配置和路由的修改将不会生效，需再次执行缓存命令，或使用 "),t("code",[s._v("php artisan cache:clear")]),s._v(" 命令清除它们。")])]),s._v(" "),t("h2",{attrs:{id:"composer"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#composer"}},[s._v("#")]),s._v(" Composer")]),s._v(" "),t("p",[s._v("在安装依赖时，建议使用以下命令：")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("composer")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --optimize-autoloader --no-dev\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("其中，"),t("code",[s._v("--optimize-autoloader")]),s._v(" 表示生成优化后的自动加载器，虽然生成过程可能较慢，但换来的是提高运行时的效率。"),t("code",[s._v("--no-dev")]),s._v(" 表示不安装 composer.json 中 "),t("code",[s._v("require-dev")]),s._v(" 声明的扩展包，在生产环境中我们不需要这些开发依赖。")]),s._v(" "),t("h2",{attrs:{id:"再谈文件权限"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#再谈文件权限"}},[s._v("#")]),s._v(" 再谈文件权限")]),s._v(" "),t("p",[s._v("文件权限直接关系到服务器安全与否。通常情况下，我们应当遵循「最小权限原则」，即权限越小越好。对于 Laravel 来说，我个人比较倾向的权限配置为：")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /var/www/blog\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" -R "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("750")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" -R "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("770")]),s._v(" storage bootstrap/cache\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("你可以通过在线工具 "),t("a",{attrs:{href:"https://chmod-calculator.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Chmod Calculator"),t("OutboundLink")],1),s._v(" 来计算八进制权限数字：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/renzhifan/image/master/img/per.png",alt:""}}),s._v("\n上图是 "),t("code",[s._v("750")]),s._v(" 所代表的权限，即文件所有者可 "),t("strong",[s._v("读、写、执行（进入）")]),s._v("，文件所有组可 "),t("strong",[s._v("读、执行（进入）")]),s._v("，其余用户 "),t("strong",[s._v("均不可")]),s._v("。")]),s._v(" "),t("blockquote",[t("p",[s._v("注意：对于文件来说，"),t("code",[s._v("Execute")]),s._v(" 权限表示可执行；对于目录来说，表示可进入（即 "),t("code",[s._v("cd")]),s._v("）。为方便描述，以下统称为「执行」权限。")])]),s._v(" "),t("p",[s._v("也就是说，运行 Nginx 和 PHP-FPM 的 "),t("code",[s._v("www-data")]),s._v(" 用户，可读、写、执行；"),t("code",[s._v("www-data")]),s._v(" 用户组内的用户可读、执行。")]),s._v(" "),t("p",[s._v("而 "),t("code",[s._v("770")]),s._v(" 则更加宽松 —— 对于 Laravel 运行时需要写入的目录，赋予文件所有组可 "),t("strong",[s._v("读、写、执行")]),s._v(" 权限；也就是说 "),t("code",[s._v("www-data")]),s._v(" 用户组内的用户可写 "),t("code",[s._v("storage")]),s._v("、"),t("code",[s._v("bootstrap/cache")]),s._v(" 目录。")]),s._v(" "),t("h2",{attrs:{id:"杂项"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#杂项"}},[s._v("#")]),s._v(" 杂项")]),s._v(" "),t("p",[s._v("根据应用本身的逻辑不同，涉及的 Laravel 功能也不一样。针对部分项目，你有可能还需要执行以下 Artisan 命令：")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ php artisan storage:link "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 软链接 app/storage 到 public 目录，以便公开访问")]),s._v("\n$ php artisan migrate "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行迁移")]),s._v("\n$ php artisan db:seed "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行数据填充")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])])])}),[],!1,null,null,null);a.default=n.exports}}]);
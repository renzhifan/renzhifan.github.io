(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{434:function(s,t,e){"use strict";e.r(t);var a=e(33),n=Object(a.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"_1-安装-certbot"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装-certbot"}},[s._v("#")]),s._v(" 1.安装 Certbot")]),s._v(" "),e("blockquote",[e("p",[s._v("Certbot 其实就是维护 Let's Encrypt 的 Package，在 Ubuntu上，我们可以这样安装：")])]),s._v(" "),e("blockquote",[e("p",[s._v("首先安装 Nginx：")])]),s._v(" "),e("div",{staticClass:"language-shell script script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" nginx\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("blockquote",[e("p",[s._v("以上过程，等待安装完毕就好。")])]),s._v(" "),e("blockquote",[e("p",[s._v("然后添加 package repository")])]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" add-apt-repository ppa:certbot/certbot\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("blockquote",[e("p",[s._v("如果出现如下报错")])]),s._v(" "),e("p",[e("em",[e("strong",[s._v("add-apt-repository: command not found")])])]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#解决方式")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" software-properties-common\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("blockquote",[e("p",[s._v("这个过程中，等待验证完毕，按下 ENTER 就好。然后更新 apt 源数据：")])]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("blockquote",[e("p",[s._v("最后，安装 Certbot 的 Nginx package：")])]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" python-certbot-nginx\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"_2-配置-nginx"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置-nginx"}},[s._v("#")]),s._v(" 2.配置 Nginx")]),s._v(" "),e("blockquote",[e("p",[s._v("安装完 Nginx 和 Certbot 之后，需要简单配置 Nginx 以便于 Let's Encrypt 能起作用：")])]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/nginx/sites-available/default\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("blockquote",[e("p",[s._v("使用 vi 编辑器打开 /etc/nginx/sites-available/default，可以直接删除里面的所有内容，然后再添加下面的配置：")])]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("server "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    listen "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    listen "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("::"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":80"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    server_name your-domain.com www.your-domain.com"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("***注意这里的 your-domain.com 换成你自己的域名。***\n\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("保存退出之后，执行以下命令来检测 Nginx 的配置文件是否有错：\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" nginx -t\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("blockquote",[e("p",[s._v("如果出现类似 syntax ok 这样的语句，就说明 Nginx 的配置文件没有问题。之后就是重新加载 Nginx 的配置文件了")])]),s._v(" "),e("h2",{attrs:{id:"_3-签发-ssl-证书"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-签发-ssl-证书"}},[s._v("#")]),s._v(" 3.签发 SSL 证书")]),s._v(" "),e("blockquote",[e("p",[s._v("前面的两大步配置完成，就可以使用 Let's Encrypt 签发 SSL 证书了")])]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" certbot --nginx -d your-domian.com -d www.your-domain.com\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("em",[e("strong",[s._v("注意这里的 your-domain.com 换成你自己的域名。")])])]),s._v(" "),e("blockquote",[e("p",[s._v("如果你第一次运行 certbot 命令的话，你需要在弹出的窗口输入你的邮箱地址还有需要接受 Let's Encrypt 的协议，这样之后，你大概会看到下面的文字：")])]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("Please choose whether or not to redirect HTTP traffic to HTTPS, removing HTTP access.\n-------------------------------------------------------------------------------\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(": No redirect - Make no further changes to the webserver configuration.\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(": Redirect - Make all requests redirect to secure HTTPS access. Choose this "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v("\nnew sites, or "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" you"),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'re confident your site works on HTTPS. You can undo this\nchange by editing your web server'")]),s._v("s configuration.\n-------------------------------------------------------------------------------\nSelect the appropriate number "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("-2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("enter"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("press "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'c'")]),s._v(" to cancel"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("blockquote",[e("p",[s._v("在上面这里选择 1 或者 2，我推荐大家直接选择 2，因为这个会直接将你的 nginx 文件配置好并且是会将 http 跳转到 https 的。")])]),s._v(" "),e("blockquote",[e("p",[s._v("选择完毕之后，等待 SSL 生成完毕，就会有类似这样的输出：")])]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("IMPORTANT NOTES:\n - Congratulations"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" Your certificate and chain have been saved at\n   /etc/letsencrypt/live/your-domain.com/fullchain.pem. Your cert will\n   expire on "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),s._v("-12-29. To obtain a new or tweaked version of this\n   certificate "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the future, simply run certbot again with the\n   "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"certonly"')]),s._v(" option. To non-interactively renew *all* of your\n   certificates, run "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"certbot renew"')]),s._v("\n - Your account credentials have been saved "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" your Certbot\n   configuration directory at /etc/letsencrypt. You should "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" a\n   secure backup of this folder now. This configuration directory will\n   also contain certificates and private keys obtained by Certbot so\n   making regular backups of this folder is ideal.\n - If you like Certbot, please consider supporting our work by:\n   Donating to ISRG / Let's Encrypt:   https://letsencrypt.org/donate\n   Donating to EFF:                    https://eff.org/donate-le\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br")])]),e("hr"),s._v(" "),e("p",[e("em",[e("strong",[s._v("然后在上面的文字中，这个 /etc/letsencrypt/live/your-domain.com/fullchain.pem 路径很重要，就是你的 SSL 证书路径。")])])]),s._v(" "),e("hr"),s._v(" "),e("p",[e("em",[e("strong",[s._v("其实到这里，访问 your-domain.com 应该就可以看到 https 的效果了。")])])]),s._v(" "),e("hr"),s._v(" "),e("h2",{attrs:{id:"_4-自动更新证书"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-自动更新证书"}},[s._v("#")]),s._v(" 4.自动更新证书")]),s._v(" "),e("blockquote",[e("p",[s._v("因为 Let's Encrypt 签发的 SSL 证书有效期只有 90 天，所有在过期之前，我们需要自动更新 SSL 证书，而如果你使用最新的 certbot 的话，Let's Encrypt 会帮你添加自动更新的脚本到 /etc/cron.d 里，你只需要去检测一下这个命令是否生效就OK！")])]),s._v(" "),e("hr"),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" certbot renew --dry-run\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("blockquote",[e("p",[s._v("如果这个命令你没看到什么 error 的话，那就是没什么问题了")])]),s._v(" "),e("hr")])}),[],!1,null,null,null);t.default=n.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[160],{573:function(s,e,a){"use strict";a.r(e);var t=a(33),r=Object(t.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("blockquote",[a("p",[s._v("以下是广泛使用的30个SQL查询语句优化方法：")])]),s._v(" "),a("h2",{attrs:{id:"_1-应尽量避免在-where-子句中使用-或-操作符-否则将引擎放弃使用索引而进行全表扫描。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-应尽量避免在-where-子句中使用-或-操作符-否则将引擎放弃使用索引而进行全表扫描。"}},[s._v("#")]),s._v(" 1.应尽量避免在 where 子句中使用"),a("code",[s._v("!=")]),s._v("或"),a("code",[s._v("<>")]),s._v("操作符，否则将引擎放弃使用索引而"),a("strong",[s._v("进行全表扫描")]),s._v("。")]),s._v(" "),a("h2",{attrs:{id:"_2-对查询进行优化-首先应考虑在-where-及-order-by-涉及的列上建立索引-避免全表扫描。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-对查询进行优化-首先应考虑在-where-及-order-by-涉及的列上建立索引-避免全表扫描。"}},[s._v("#")]),s._v(" 2.对查询进行优化，首先应考虑在 "),a("code",[s._v("where")]),s._v(" 及 "),a("code",[s._v("order by")]),s._v(" 涉及的列上建立索引，"),a("strong",[s._v("避免全表扫描")]),s._v("。")]),s._v(" "),a("h2",{attrs:{id:"_3-应尽量避免在-where-子句中对字段进行null-值判断-否则将导致引擎放弃使用索引-而进行全表扫描-如"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-应尽量避免在-where-子句中对字段进行null-值判断-否则将导致引擎放弃使用索引-而进行全表扫描-如"}},[s._v("#")]),s._v(" 3.应尽量避免在 "),a("code",[s._v("where")]),s._v(" 子句中对字段进行"),a("code",[s._v("null")]),s._v(" 值判断，否则将导致引擎放弃使用索引，而进行全表扫描，如：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" from t where num is null\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("可以在num上设置默认值"),a("code",[s._v("0")]),s._v("，确保表中num列没有"),a("code",[s._v("null")]),s._v("值，然后这样查询：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" from t where "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("num")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"_4-尽量避免在-where-子句中使用-or-来连接条件-否则将导致引擎放弃使用索引-而进行全表扫描-如"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-尽量避免在-where-子句中使用-or-来连接条件-否则将导致引擎放弃使用索引-而进行全表扫描-如"}},[s._v("#")]),s._v(" 4.尽量避免在 "),a("code",[s._v("where")]),s._v(" 子句中使用 "),a("code",[s._v("or")]),s._v(" 来连接条件，否则将导致引擎放弃使用索引，而进行全表扫描，如：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" from t where "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("num")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" or "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("num")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("可以用"),a("code",[s._v("union")]),s._v("来查询：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" from t where "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("num")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\nunion all\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" from t where "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("num")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h2",{attrs:{id:"_5-前置百分号的查询也将导致全表扫描"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-前置百分号的查询也将导致全表扫描"}},[s._v("#")]),s._v(" 5.前置百分号的查询也将导致全表扫描：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" from t where name like "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%abc%'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("若要提高效率，可以考虑全文检索。")]),s._v(" "),a("h2",{attrs:{id:"_6-in-和-not-in-也要慎用-否则会导致全表扫描-如"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-in-和-not-in-也要慎用-否则会导致全表扫描-如"}},[s._v("#")]),s._v(" 6."),a("code",[s._v("in")]),s._v(" 和 "),a("code",[s._v("not in")]),s._v(" 也要慎用，否则会导致全表扫描，如：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" from t where num in"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1,2")]),s._v(",3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("对于连续的数值，"),a("strong",[s._v("能用 between 就不要用 in 了")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" from t where num between "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" and "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"_7-如果在-where-子句中使用参数-也会导致全表扫描。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-如果在-where-子句中使用参数-也会导致全表扫描。"}},[s._v("#")]),s._v(" 7.如果在 where 子句中使用参数，也会导致全表扫描。")]),s._v(" "),a("p",[s._v("因为SQL只有在运行时才会解析局部变量，但优化程序不能将访问计划的选择推迟到运行时。")]),s._v(" "),a("p",[s._v("它必须在编译时进行选择")]),s._v(" "),a("p",[s._v("然而，如果在编译时建立访问计划，变量的值还是未知的，因而无法作为索引选择的输入项。")]),s._v(" "),a("p",[s._v("如下面语句将进行全表扫描：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" from t where "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("num")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("@num\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("可以改为强制查询使用索引：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" from t with"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("索引名"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(" where "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("num")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("@num\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"_8-应尽量避免在-where-子句中对字段进行表达式操作。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-应尽量避免在-where-子句中对字段进行表达式操作。"}},[s._v("#")]),s._v(" 8.应尽量避免在 where 子句中对字段进行表达式操作。")]),s._v(" "),a("p",[s._v("这将导致引擎放弃使用索引而进行全表扫描。如：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" from t where num/2"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("应改为:")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" from t where "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("num")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("*2\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"_9-应尽量避免在where子句中对字段进行函数操作。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-应尽量避免在where子句中对字段进行函数操作。"}},[s._v("#")]),s._v(" 9.应尽量避免在where子句中对字段进行函数操作。")]),s._v(" "),a("p",[s._v("这将导致"),a("code",[s._v("引擎放弃使用索引而进行全表扫描")]),s._v("。如：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" from t where substring"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name,1,3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'abc'")]),s._v("–name                            -- 以abc开头的id\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" from t where datediff"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("day, createdate, "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2005-11-30'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("–"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2005-11-30'")]),s._v("    -- 生成的id\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("应改为:")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" from t where name like "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'abc%'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" from t where createdate"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2005-11-30'")]),s._v(" and createdate"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2005-12-1'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"_10-不要在-where-子句中的等式判断-左边进行函数、算术运算或其他表达式运算-否则系统将可能无法正确使用索引。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-不要在-where-子句中的等式判断-左边进行函数、算术运算或其他表达式运算-否则系统将可能无法正确使用索引。"}},[s._v("#")]),s._v(" 10.不要在 "),a("strong",[s._v("where")]),s._v(" 子句中的等式判断 "),a("strong",[s._v("=")]),s._v(" 左边进行函数、算术运算或其他表达式运算，否则系统将可能无法正确使用索引。")]),s._v(" "),a("h2",{attrs:{id:"_11-在复合索引中-在使用索引字段作为条件时-必须使用到该索引中的第一个字段作为条件时-才能保证系统使用该索引-否则该索引将不会被使-用-并且应尽可能的让字段顺序与索引顺序相一致。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-在复合索引中-在使用索引字段作为条件时-必须使用到该索引中的第一个字段作为条件时-才能保证系统使用该索引-否则该索引将不会被使-用-并且应尽可能的让字段顺序与索引顺序相一致。"}},[s._v("#")]),s._v(" 11.在复合索引中，在使用索引字段作为条件时，必须使用到该索引中的"),a("code",[s._v("第一个字段作")]),s._v("为条件时，才能保证系统使用该索引，否则该索引将不会被使 用，并且应尽可能的让字段顺序与索引顺序相一致。")]),s._v(" "),a("h2",{attrs:{id:"_12-不要写一些没有意义的查询-如需要生成一个空表结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_12-不要写一些没有意义的查询-如需要生成一个空表结构"}},[s._v("#")]),s._v(" 12.不要写一些没有意义的查询，如需要生成一个空表结构：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" col1,col2 into "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#t from t where 1=0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("这类代码不会返回任何结果集，但是会消耗系统资源的，应改成这样：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("create table "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#t(…)")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"_13-很多时候用-exists-代替-in-是一个好的选择"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_13-很多时候用-exists-代替-in-是一个好的选择"}},[s._v("#")]),s._v(" 13.很多时候用 exists 代替 in 是一个好的选择：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" num from a where num in"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("select num from b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("用下面的语句替换：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" num from a where exists"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("select "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" from b where "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("num")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("a.num"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"_14-并不是所有索引对查询都有效。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_14-并不是所有索引对查询都有效。"}},[s._v("#")]),s._v(" 14.并不是所有索引对查询都有效。")]),s._v(" "),a("p",[s._v("SQL是根据表中数据来进行查询优化的，当"),a("code",[s._v("索引列有大量数据重复时，SQL查询可能不会去利用索引")]),s._v("。")]),s._v(" "),a("p",[s._v("如一表中有字段 "),a("code",[s._v("sex")]),s._v("、"),a("code",[s._v("male")]),s._v("、"),a("code",[s._v("female")]),s._v("几乎各一半，那么即使在"),a("code",[s._v("sex")]),s._v("上建了索引也对查询效率起不了作用。")]),s._v(" "),a("h2",{attrs:{id:"_15-索引并不是越多越好。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_15-索引并不是越多越好。"}},[s._v("#")]),s._v(" 15.索引并不是越多越好。")]),s._v(" "),a("p",[s._v("索引固然可以提高相应的 "),a("strong",[s._v("select")]),s._v(" 的效率，但同时也降低了"),a("strong",[s._v("insert")]),s._v(" 及 "),a("strong",[s._v("update")]),s._v(" 的效率。")]),s._v(" "),a("p",[s._v("因为 "),a("strong",[s._v("insert")]),s._v(" 或 "),a("strong",[s._v("update")]),s._v(" 时有可能会重建索引，")]),s._v(" "),a("p",[s._v("所以怎样建索引需要慎重考虑，视具体情况而定。")]),s._v(" "),a("p",[s._v("一个表的索引数最好不要超过"),a("strong",[s._v("6个")]),s._v("。")]),s._v(" "),a("p",[s._v("若太多，则应考虑一些不常使用到的列上建的索引是否有 必要。")]),s._v(" "),a("h2",{attrs:{id:"_16-应尽可能的避免更新-clustered-索引数据列。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_16-应尽可能的避免更新-clustered-索引数据列。"}},[s._v("#")]),s._v(" 16.应尽可能的避免更新 clustered 索引数据列。")]),s._v(" "),a("p",[s._v("因为 **clustered **索引数据列的顺序就是表记录的物理存储顺序。")]),s._v(" "),a("p",[s._v("一旦该列值改变，将导致整个表记录的顺序的调整，会耗费相当大的资源。")]),s._v(" "),a("p",[s._v("若应用系统需要频繁更新 clustered 索引数据列，那么需要考虑是否应将该索引建为 clustered 索引。")]),s._v(" "),a("h2",{attrs:{id:"_17-尽量使用数字型字段。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_17-尽量使用数字型字段。"}},[s._v("#")]),s._v(" 17.尽量使用数字型字段。")]),s._v(" "),a("p",[s._v("若只含数值信息的字段，尽量不要设计为字符型。")]),s._v(" "),a("p",[s._v("否则会降低查询和连接的性能，并会增加存储开销。")]),s._v(" "),a("p",[s._v("这是因为，引擎在处理查询和连接时，会逐个比较字符串中每一个字符。")]),s._v(" "),a("p",[s._v("而对于数字型而言只需要比较一次就够了。")]),s._v(" "),a("p",[s._v("例如，PHP可以使用**ip2long()"),a("strong",[s._v("和")]),s._v("long2ip()**函数把IP地址转成整型后，再存放进数据库。")]),s._v(" "),a("h2",{attrs:{id:"_18-尽可能的使用-varchar-nvarchar-代替-char-nchar-。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_18-尽可能的使用-varchar-nvarchar-代替-char-nchar-。"}},[s._v("#")]),s._v(" 18.尽可能的使用 varchar/nvarchar 代替 char/nchar 。")]),s._v(" "),a("p",[s._v("首先，变长字段存储空间小，可以节省存储空间。")]),s._v(" "),a("p",[s._v("其次，对于查询来说，在一个相对较小的字段内搜索效率显然要高些")]),s._v(" "),a("h2",{attrs:{id:"_19-任何地方都不要使用select-from-t-用具体的字段列表代替-不要返回用不到的任何字段。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_19-任何地方都不要使用select-from-t-用具体的字段列表代替-不要返回用不到的任何字段。"}},[s._v("#")]),s._v(" 19.任何地方都不要使用"),a("strong",[s._v("select * from t")]),s._v(" ，用具体的字段列表代替“*”，不要返回用不到的任何字段。")]),s._v(" "),a("h2",{attrs:{id:"_20-尽量使用表变量来代替临时表。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_20-尽量使用表变量来代替临时表。"}},[s._v("#")]),s._v(" 20.尽量使用表变量来代替临时表。")]),s._v(" "),a("p",[s._v("如果表变量包含大量数据，请注意索引非常有限（只有主键索引）。")]),s._v(" "),a("h2",{attrs:{id:"_21-避免频繁创建和删除临时表-以减少系统表资源的消耗。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_21-避免频繁创建和删除临时表-以减少系统表资源的消耗。"}},[s._v("#")]),s._v(" 21."),a("strong",[s._v("避免频繁创建和删除临时表")]),s._v("，以减少系统表资源的消耗。")]),s._v(" "),a("h2",{attrs:{id:"_22-临时表并不是不可使用-适当地使用它们可以使某些例程更有效。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_22-临时表并不是不可使用-适当地使用它们可以使某些例程更有效。"}},[s._v("#")]),s._v(" 22.临时表并不是不可使用，适当地使用它们可以使某些例程更有效。")]),s._v(" "),a("p",[s._v("例如，当需要重复引用大型表或常用表中的某个数据集时。")]),s._v(" "),a("p",[s._v("但是，对于一次性事件，最好使用导出表。")]),s._v(" "),a("h2",{attrs:{id:"_23-在新建临时表时-如果一次性插入数据量很大-那么可以使用select-into-代替-create-table。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_23-在新建临时表时-如果一次性插入数据量很大-那么可以使用select-into-代替-create-table。"}},[s._v("#")]),s._v(" 23.在新建临时表时，如果一次性插入数据量很大，那么可以使用"),a("strong",[s._v("select into")]),s._v(" 代替 "),a("strong",[s._v("create table")]),s._v("。")]),s._v(" "),a("p",[s._v("这样可以避免造成大量 log ，提高速度。")]),s._v(" "),a("p",[s._v("如果数据量不大，为了缓和系统表的资源，应先create table，然后insert。")]),s._v(" "),a("h2",{attrs:{id:"_24-如果使用到了临时表-在存储过程的最后-务必将所有的临时表显式删除。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_24-如果使用到了临时表-在存储过程的最后-务必将所有的临时表显式删除。"}},[s._v("#")]),s._v(" 24.如果使用到了临时表，在存储过程的最后，务必将所有的临时表显式删除。")]),s._v(" "),a("p",[s._v("先 "),a("strong",[s._v("truncate table")]),s._v(" ，然后 "),a("strong",[s._v("drop table")]),s._v(" 。")]),s._v(" "),a("p",[s._v("这样可以避免系统表的较长时间锁定。")]),s._v(" "),a("h2",{attrs:{id:"_25-尽量避免使用游标。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_25-尽量避免使用游标。"}},[s._v("#")]),s._v(" 25.尽量避免使用游标。")]),s._v(" "),a("p",[s._v("因为游标的效率较差，如果游标操作的数据超过1万行，那么就应该考虑改写。")]),s._v(" "),a("h2",{attrs:{id:"_26-基于集的方法通常更有效。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_26-基于集的方法通常更有效。"}},[s._v("#")]),s._v(" 26.基于集的方法通常更有效。")]),s._v(" "),a("p",[s._v("使用基于游标的方法或临时表方法之前，应先寻找基于集的解决方案来解决问题。")]),s._v(" "),a("h2",{attrs:{id:"_27-与临时表一样-游标并不是不可使用。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_27-与临时表一样-游标并不是不可使用。"}},[s._v("#")]),s._v(" 27.与临时表一样，游标并不是不可使用。")]),s._v(" "),a("p",[s._v("对小型数据集使用 FAST_FORWARD 游标，通常要优于其他逐行处理方法。")]),s._v(" "),a("p",[s._v("尤其是在必须引用几个表才能获得所需的数据时。")]),s._v(" "),a("p",[s._v("在结果集中包括“合计”的例程，通常要比使用游标执行的速度快。")]),s._v(" "),a("p",[s._v("如果开发时间允许，基于游标的方法和基于集的方法都可以尝试一下，看哪一种方法的效果更好。")]),s._v(" "),a("h2",{attrs:{id:"_28-在所有的存储过程和触发器的开始处设置-set-nocount-on-在结束时设置-set-nocount-off-。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_28-在所有的存储过程和触发器的开始处设置-set-nocount-on-在结束时设置-set-nocount-off-。"}},[s._v("#")]),s._v(" 28.在所有的存储过程和触发器的开始处设置** SET NOCOUNT ON **，在结束时设置 "),a("strong",[s._v("SET NOCOUNT OFF")]),s._v(" 。")]),s._v(" "),a("p",[s._v("无需在执行存储过程和触发器的每个语句后向客户端发送 DONE_IN_PROC 消息。")]),s._v(" "),a("h2",{attrs:{id:"_29-尽量避免向客户端返回大数据量。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_29-尽量避免向客户端返回大数据量。"}},[s._v("#")]),s._v(" 29.尽量避免向客户端返回大数据量。")]),s._v(" "),a("p",[s._v("若数据量过大，应该考虑相应需求是否合理。")]),s._v(" "),a("h2",{attrs:{id:"_30-尽量避免大事务操作-提高系统并发能力。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_30-尽量避免大事务操作-提高系统并发能力。"}},[s._v("#")]),s._v(" 30.尽量"),a("strong",[s._v("避免大事务操作")]),s._v("，提高系统并发能力。")])])}),[],!1,null,null,null);e.default=r.exports}}]);
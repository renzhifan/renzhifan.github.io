(window.webpackJsonp=window.webpackJsonp||[]).push([[185],{599:function(s,t,n){"use strict";n.r(t);var a=n(33),e=Object(a.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"说明"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#说明"}},[s._v("#")]),s._v(" 说明")]),s._v(" "),n("p",[s._v("本节主要介绍go语言对Elasticsearch文档的基础操作："),n("code",[s._v("创建、查询、更新、删除。")])]),s._v(" "),n("p",[s._v("为了方便演示文档的CRUD操作，我们先定义索引的"),n("code",[s._v("struct")]),s._v("结构")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("// 定义一个文章索引结构，用来存储文章内容\ntype Article struct {\n\tTitle   string    // 文章标题\n\tContent string    // 文章内容\n\tAuthor  string    // 作者\n\tCreated time.Time // 发布时间\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h2",{attrs:{id:"添加文档"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#添加文档"}},[s._v("#")]),s._v(" 添加文档")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('package main\n\nimport (\n\t"context"\n\t"encoding/json"\n\t"fmt"\n\t"github.com/olivere/elastic/v7"\n\t"log"\n\t"os"\n\t"time"\n)\n\ntype Article struct {\n\tTitle   string    // 文章标题\n\tContent string    // 文章内容\n\tAuthor  string    // 作者\n\tCreated time.Time // 发布时间\n}\n\n\nfunc main() {\n        // 创建client连接ES\n\tclient, err := elastic.NewClient(\n\t\t// elasticsearch 服务地址，多个服务地址使用逗号分隔\n\t\telastic.SetURL("http://127.0.0.1:9200", "http://127.0.0.1:9201"),\n\t\t// 基于http base auth验证机制的账号和密码\n\t\telastic.SetBasicAuth("user", "secret"),\n\t\t// 启用gzip压缩\n\t\telastic.SetGzip(true),\n\t\t// 设置监控检查时间间隔\n\t\telastic.SetHealthcheckInterval(10*time.Second),\n\t\t// 设置请求失败最大重试次数\n\t\telastic.SetMaxRetries(5),\n\t\t// 设置错误日志输出\n\t\telastic.SetErrorLog(log.New(os.Stderr, "ELASTIC ", log.LstdFlags)),\n\t\t// 设置info日志输出\n\t\telastic.SetInfoLog(log.New(os.Stdout, "", log.LstdFlags)))\n\n\tif err != nil {\n\t\t// Handle error\n\t\tfmt.Printf("连接失败: %v\\n", err)\n\t} else {\n\t\tfmt.Println("连接成功")\n\t}\n\n\t// 执行ES请求需要提供一个上下文对象\n\tctx := context.Background()\n\n\t// 定义一篇博客\n\tblog := Article{Title:"golang es教程", Content:"go如何操作ES", Author:"tizi", Created:time.Now()}\n\n\t// 使用client创建一个新的文档\n\tput1, err := client.Index().\n\t\tIndex("blogs"). // 设置索引名称\n\t\tId("1"). // 设置文档id\n\t\tBodyJson(blog). // 指定前面声明struct对象\n\t\tDo(ctx) // 执行请求，需要传入一个上下文对象\n\tif err != nil {\n\t\t// Handle error\n\t\tpanic(err)\n\t}\n\n\tfmt.Printf("文档Id %s, 索引名 %s\\n", put1.Id, put1.Index)\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br")])]),n("h2",{attrs:{id:"查询文档"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查询文档"}},[s._v("#")]),s._v(" 查询文档")]),s._v(" "),n("blockquote",[n("p",[s._v("根据文档ID，查询文档")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('// 根据id查询文档\nget1, err := client.Get().\n\t\tIndex("blogs"). // 指定索引名\n\t\tId("1"). // 设置文档id\n\t\tDo(ctx) // 执行请求\nif err != nil {\n\t// Handle error\n\tpanic(err)\n}\nif get1.Found {\n\tfmt.Printf("文档id=%s 版本号=%d 索引名=%s\\n", get1.Id, get1.Version, get1.Index)\n}\n\n# 手动将文档内容转换成go struct对象\nmsg2 := Article{}\n// 提取文档内容，原始类型是json数据\ndata, _ := get1.Source.MarshalJSON()\n// 将json转成struct结果\njson.Unmarshal(data, &msg2)\n// 打印结果\nfmt.Println(msg2.Title)\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])]),n("h2",{attrs:{id:"批量查询文档"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#批量查询文档"}},[s._v("#")]),s._v(" 批量查询文档")]),s._v(" "),n("p",[s._v("通过多个Id批量查询文档，对应ES的"),n("code",[s._v("multi get")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('// 查询id等于1,2,3的博客内容\n\tresult, err := client.MultiGet().\n\t\tAdd(elastic.NewMultiGetItem(). // 通过NewMultiGetItem配置查询条件\n\t\t\tIndex("blogs"). // 设置索引名\n\t\t\tId("1")). // 设置文档id\n\t\tAdd(elastic.NewMultiGetItem().Index("blogs").Id("2")).\n\t\tAdd(elastic.NewMultiGetItem().Index("blogs").Id("3")).\n\t\tDo(ctx) // 执行请求\n\t\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\n\t// 遍历文档\n\tfor _, doc := range result.Docs {\n\t\t// 转换成struct对象\n\t\tvar content Article\n\t\ttmp, _ := doc.Source.MarshalJSON()\n\t\terr := json.Unmarshal(tmp, &content)\n\t\tif err != nil {\n\t\t\tpanic(err)\n\t\t}\n\n\t\tfmt.Println(content.Title)\n\t}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])]),n("h2",{attrs:{id:"更新文档"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#更新文档"}},[s._v("#")]),s._v(" 更新文档")]),s._v(" "),n("blockquote",[n("p",[s._v("根据id更新文档")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('_, err := client.Update().\n\t\tIndex("blogs"). // 设置索引名\n\t\tId("1"). // 文档id\n\t\tDoc(map[string]interface{}{"Title": "新的文章标题"}). // 更新Title="新的文章标题"，支持传入键值结构\n\t\tDo(ctx) // 执行ES查询\nif err != nil {\n   // Handle error\n   panic(err)\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h2",{attrs:{id:"根据条件更新文档"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#根据条件更新文档"}},[s._v("#")]),s._v(" 根据条件更新文档")]),s._v(" "),n("blockquote",[n("p",[s._v("支持批量更新文档内容")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('_, err = client.UpdateByQuery("blogs").\n                // 设置查询条件，这里设置Author=tizi\n\t\tQuery(elastic.NewTermQuery("Author", "tizi")).\n                // 通过脚本更新内容，将Title字段改为1111111\n\t\tScript(elastic.NewScript( "ctx._source[\'Title\']=\'1111111\'")).\n                // 如果文档版本冲突继续执行\n\t\tProceedOnVersionConflict(). \n\t\tDo(ctx)\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h2",{attrs:{id:"删除文档"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#删除文档"}},[s._v("#")]),s._v(" 删除文档")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('// 根据id删除一条数据\n_, err := client.Delete().\n\t\tIndex("blogs").\n\t\tId("1").  // 文档id\n\t\tDo(ctx)\nif err != nil {\n\t// Handle error\n\tpanic(err)\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h2",{attrs:{id:"根据条件删除文档"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#根据条件删除文档"}},[s._v("#")]),s._v(" 根据条件删除文档")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('_, _ = client.DeleteByQuery("blogs"). // 设置索引名\n\t    // 设置查询条件为: Author = tizi\n\t\tQuery(elastic.NewTermQuery("Author", "tizi")).\n\t\t// 文档冲突也继续删除\n\t\tProceedOnVersionConflict().\n\t\tDo(ctx)\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[147],{562:function(s,a,t){"use strict";t.r(a);var e=t(33),o=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"_1-初始化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-初始化"}},[s._v("#")]),s._v(" 1. 初始化")]),s._v(" "),t("p",[s._v("新项目，我们可以使用 "),t("code",[s._v("go mod init")]),s._v(" 初始化生成 "),t("code",[s._v("go.mod")]),s._v(" 文件")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("go")]),s._v(" mod init\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"_2-go-proxy"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-go-proxy"}},[s._v("#")]),s._v(" 2. Go Proxy")]),s._v(" "),t("p",[s._v("因国内访问外网受限，一般我们都会配合 Go Proxy 使用，以防止使用 "),t("code",[s._v("go get")]),s._v(" 获取源码包时花费时间过长或无法下载")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("go")]),s._v(" env "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("w  GOPROXY"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("goproxy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cn\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("blockquote",[t("p",[t("strong",[s._v("知识点：")]),s._v(" 我们使用 go env -w 来修改 Go 相关的环境变量。")])]),s._v(" "),t("p",[s._v("Go Proxy 设置完成后即可放心使用 "),t("code",[s._v("go get")]),s._v(" 来下载依赖了，作为测试，我们下载 HttpRouter ：")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("go")]),s._v(" get github"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("julienschmidt"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("httprouter\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("使用 Proxy 的情况下一般很快就能下载完成。")]),s._v(" "),t("p",[s._v("安装 package 的原则是先拉最新的 release tag，若无 tag 则拉最新的 commit。")]),s._v(" "),t("h2",{attrs:{id:"_3-go-mod"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-go-mod"}},[s._v("#")]),s._v(" 3. go.mod")]),s._v(" "),t("p",[s._v("每一次的 go get 都会同时修改 "),t("code",[s._v("go.mod")]),s._v(" 和 "),t("code",[s._v("go.sum")]),s._v(" 文件。")]),s._v(" "),t("p",[s._v("这两个文件是下载依赖包的主要依据。"),t("code",[s._v("go.mod")]),s._v(" 类似于 PHP 中的 "),t("code",[s._v("composer.json")]),s._v(" ，而 "),t("code",[s._v("go.sum")]),s._v(" 则是 "),t("code",[s._v("composer.lock")]),s._v("。")]),s._v(" "),t("p",[s._v("打开查看 "),t("code",[s._v("go.mod")]),s._v(" 的源码：")]),s._v(" "),t("p",[t("code",[s._v("go.mod")])]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[s._v("module demo\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("go")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.15")]),s._v("\n\nrequire "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    github"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("gorilla"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mux v1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.4")]),s._v("\n    github"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("julienschmidt"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("httprouter v1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// indirect")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[t("strong",[s._v("几个参数：")])]),s._v(" "),t("ul",[t("li",[s._v("module —— 我们的 goblog 在 Go Module 里也算是一个 Module ；")]),s._v(" "),t("li",[s._v("go —— 指定了版本要求，最低 1.15")]),s._v(" "),t("li",[s._v("require —— 是项目所需依赖")])]),s._v(" "),t("h2",{attrs:{id:"_4-go-sum"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-go-sum"}},[s._v("#")]),s._v(" 4. go.sum")]),s._v(" "),t("p",[t("code",[s._v("go.sum")]),s._v(" 文件保存着依赖包的版本和哈希值：")]),s._v(" "),t("p",[t("code",[s._v("go.sum")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("github.com/gorilla/mux v1.8.0 h1:i40aqfkR1h2SlN9hojwV5ZA91wcXFOvkdNIeFDP5koI=\ngithub.com/gorilla/mux v1.8.0/go.mod h1:DVbg23sWSpFRCP0SfiEN6jmj59UnW/n46BH5rLB71So=\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("blockquote",[t("p",[s._v("需要注意的是，"),t("code",[s._v("go.sum")]),s._v(" 里不止会保存直接依赖包的哈希值，间接依赖包的哈希值也会被保存。")])]),s._v(" "),t("p",[t("em",[t("strong",[s._v("什么是间接依赖包？")])])]),s._v(" "),t("p",[s._v("间接依赖包就是依赖包的依赖，以及他们的依赖… 我们目前下载的两个包 mux 和 httprouter，没有间接依赖，接下来我们拉取知名的 gin 框架来试试：")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("go")]),s._v(" get github"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("gin"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("gonic"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("gin\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("下载成功后打开 "),t("code",[s._v("go.sum")]),s._v(" ，会发现里面的内容远远多于 "),t("code",[s._v("go.mod")]),s._v("。这是因为 "),t("code",[s._v("gin")]),s._v(" 有很多依赖包，而这些依赖包也会有自己的依赖。")]),s._v(" "),t("p",[s._v("接下来我们仔细看下，每个模块路径有如下两种哈希：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("github.com/gorilla/mux v1.8.0 h1:i40aqfkR1h2SlN9hojwV5ZA91wcXFOvkdNIeFDP5koI=\ngithub.com/gorilla/mux v1.8.0/go.mod h1:DVbg23sWSpFRCP0SfiEN6jmj59UnW/n46BH5rLB71So=\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("blockquote",[t("p",[s._v("前者为 Go Modules 打包整个模块包文件 zip 后再进行 hash 值，而后者为针对 go.mod 的 hash 值。")])]),s._v(" "),t("p",[s._v("由此可见，go.sum 是保证所下载源码 100% 正确的重要依据。如果有恶意用户，将某个 Git 项目的 tag 源码做了修改，这些哈希值将会不匹配并报错。")]),s._v(" "),t("p",[s._v("因为 go.sum 有 100% 保证 build 一致的作用，我们建议开发中将其"),t("strong",[s._v("加入到代码版本控制器中")]),s._v("。这里面不止有安全的因素，当同事或者其他人 clone 你的代码，我们也希望代码可以保持一致。")]),s._v(" "),t("h2",{attrs:{id:"_5-indirect"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-indirect"}},[s._v("#")]),s._v(" 5. indirect")]),s._v(" "),t("p",[s._v("回到我们的 go.mod 中，可以看到 require 区块里有 // "),t("code",[s._v("indirect")]),s._v(" 字样：")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[s._v("module blog\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("go")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.15")]),s._v("\n\nrequire "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\tgithub"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("gin"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("gonic"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("gin v1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// indirect")]),s._v("\n\tgithub"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("gorilla"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mux v1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("blockquote",[t("p",[s._v("此标志标明这个依赖包还未被使用，如果你在代码的某个地方 import 到的话，VSCode以及PHPSTORM 的 Go 插件就会自动将这个标志去除。")])]),s._v(" "),t("h2",{attrs:{id:"_6-go-mod-tidy-命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-go-mod-tidy-命令"}},[s._v("#")]),s._v(" 6. go mod tidy 命令")]),s._v(" "),t("p",[s._v("此命令做整理依赖使用，执行时会把未使用的 module 移除掉，我们试试：")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("go")]),s._v(" mod tidy\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("再次查看 "),t("code",[s._v("go.mod")]),s._v(" 和 "),t("code",[s._v("go.sum")]),s._v(" 文件，会发现我们上面测试引入的两个包，因未使用，皆被移除。")]),s._v(" "),t("h2",{attrs:{id:"_7-源码包的存放位置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-源码包的存放位置"}},[s._v("#")]),s._v(" 7. 源码包的存放位置")]),s._v(" "),t("p",[s._v("默认源码包存放于 "),t("code",[s._v("$GOPATH/pkg/mod")]),s._v(" 中，你可以打开看下。我的如下\n"),t("img",{attrs:{src:"https://raw.githubusercontent.com/renzhifan/image/master/img/20210607115535.png",alt:""}})]),s._v(" "),t("h2",{attrs:{id:"_8-清空-go-modules-缓存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-清空-go-modules-缓存"}},[s._v("#")]),s._v(" 8. 清空 Go Modules 缓存")]),s._v(" "),t("p",[s._v("使用以下命令可以清空本地下载的 Go Modules 缓存：")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("go")]),s._v(" clean "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("modcache\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"_9-下载依赖"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-下载依赖"}},[s._v("#")]),s._v(" 9. 下载依赖")]),s._v(" "),t("p",[s._v("默认情况下，当 "),t("code",[s._v("go run")]),s._v(" 和 "),t("code",[s._v("go build")]),s._v(" 命令执行时，Go 会基于自动"),t("code",[s._v("go.mod")]),s._v(" 文件自动拉取依赖。")]),s._v(" "),t("p",[s._v("Go Module 也提供了一个命令用以下载项目所需依赖：")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("go")]),s._v(" mod download\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"_10-所有-go-modules-命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_10-所有-go-modules-命令"}},[s._v("#")]),s._v(" 10. 所有 Go Modules 命令")]),s._v(" "),t("blockquote",[t("p",[s._v("以下是完整的命令列表")])]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("命令")]),s._v(" "),t("th",[s._v("作用")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("go mod init")]),s._v(" "),t("td",[s._v("生成 go.mod 文件")])]),s._v(" "),t("tr",[t("td",[s._v("go mod download")]),s._v(" "),t("td",[s._v("下载 go.mod 文件中指明的所有依赖")])]),s._v(" "),t("tr",[t("td",[s._v("go mod tidy")]),s._v(" "),t("td",[s._v("整理现有的依赖")])]),s._v(" "),t("tr",[t("td",[s._v("go mod graph")]),s._v(" "),t("td",[s._v("查看现有的依赖结构")])]),s._v(" "),t("tr",[t("td",[s._v("go mod edit")]),s._v(" "),t("td",[s._v("编辑 go.mod 文件")])]),s._v(" "),t("tr",[t("td",[s._v("go mod vendor")]),s._v(" "),t("td",[s._v("导出项目所有的依赖到 vendor 目录")])]),s._v(" "),t("tr",[t("td",[s._v("go mod verify")]),s._v(" "),t("td",[s._v("校验一个模块是否被篡改过")])]),s._v(" "),t("tr",[t("td",[s._v("go mod why")]),s._v(" "),t("td",[s._v("查看为什么需要依赖某模块")])])])]),s._v(" "),t("h2",{attrs:{id:"_11-相关环境变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_11-相关环境变量"}},[s._v("#")]),s._v(" 11. 相关环境变量")]),s._v(" "),t("h3",{attrs:{id:"_1-go111module"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-go111module"}},[s._v("#")]),s._v(" 1). GO111MODULE")]),s._v(" "),t("p",[s._v("此变量为 Go modules 的开关，此值有以下几个可能：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("auto")]),s._v("：项目包含了 go.mod 文件的话启用 Go modules，目前在 Go1.11 至 Go1.15 中仍然是默认值。")]),s._v(" "),t("li",[t("code",[s._v("on")]),s._v("：启用 Go modules，推荐设置，将会是未来版本中的默认值。")]),s._v(" "),t("li",[t("code",[s._v("off")]),s._v("：禁用 Go modules，不推荐设置。")])]),s._v(" "),t("p",[s._v("因是在 Go1.11 版本添加，故命名为 "),t("code",[s._v("GO111MODULE")]),s._v("。")]),s._v(" "),t("p",[s._v("未来 GO111MODULE 会先调整为默认值为 "),t("code",[s._v("on")]),s._v("（曾经在 Go1.13 想改为 on，并且已经合并了 PR，但最后因为种种原因改回了 auto），然后再把 GO111MODULE 这个变量去掉，目前猜测会在 Go 2。太早去掉 GO111MODULE 的支持，会存在兼容性问题")]),s._v(" "),t("h3",{attrs:{id:"_2-goproxy"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-goproxy"}},[s._v("#")]),s._v(" 2). GOPROXY")]),s._v(" "),t("p",[s._v("此变量用于设置 Go 模块代理（Go module proxy），其作用是拉取源码时能够脱离传统的 VCS 方式，直接通过镜像站点来快速拉取。")]),s._v(" "),t("p",[s._v("镜像的好处多多，一个是防止某个版本的代码被有意或无意删除。第二是能将源码压为 zip 包，方便传输。最重要的 —— 可以做镜像加速站点，这在例如国内这种不稳定的网络环境下尤为重要。")]),s._v(" "),t("p",[s._v("GOPROXY 的默认值是")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("https://proxy.golang.org,direct\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("然而 "),t("code",[s._v("proxy.golang.org")]),s._v(" 在国内是无法访问的，所以我们使用 Go modules 时，需设置国内的 Go 模块代理：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("go env -w GOPROXY=https://goproxy.cn,direct\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("blockquote",[t("p",[t("strong",[s._v("信息")]),s._v("： "),t("code",[s._v("goproxy.cn")]),s._v(" 是一个由 CDN 提供商七牛云支持的非营利性项目。七牛云也是中国最早在生产环境中使用 Go 的公司之一，项目介绍请见"),t("a",{attrs:{href:"https://github.com/goproxy/goproxy.cn/blob/master/README.zh-CN.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/goproxy/goproxy.cn/blob/master/README.zh-CN.md"),t("OutboundLink")],1)])]),s._v(" "),t("p",[s._v("GOPROXY 的值是一个以英文逗号 , 分割的 Go 模块代理列表，可设置多个模块代理。将其设置为 off ，将会禁止 Go 在后续操作中使用任何 Go 模块代理。")]),s._v(" "),t("p",[t("strong",[s._v("direct 标志")])]),s._v(" "),t("p",[t("code",[s._v("direct")]),s._v(" 标志意味着从源地址抓取（比如 GitHub 等）。")]),s._v(" "),t("p",[s._v("如我们设置 GOPROXY 的值为：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("https://goproxy.cn,direct\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("blockquote",[t("p",[s._v("则告诉 "),t("code",[s._v("go get")]),s._v(" 在获取源码包时先尝试 "),t("code",[s._v("https://goproxy.cn")]),s._v("，如果遇到 404 等错误时，再尝试从源地址抓取。")])]),s._v(" "),t("h3",{attrs:{id:"_3-gosumdb"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-gosumdb"}},[s._v("#")]),s._v(" 3). GOSUMDB")]),s._v(" "),t("p",[s._v("此值是 Go Checksum Database 的缩写，用于在拉取模块版本时（无论是从源站拉取还是通过 Go Module Proxy 拉取）保证拉取到的模块代码包未经过篡改，若发现不一致将会立即中止。")]),s._v(" "),t("p",[s._v("GOSUMDB 的默认值为：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sum.golang.org\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("在国内同样无法访问，所幸 GOSUMDB 可以被 Go Module Proxy 代理。我们所设置的模块代理 "),t("code",[s._v("goproxy.cn")]),s._v(" 支持代理 "),t("code",[s._v("sum.golang.org")]),s._v("。")]),s._v(" "),t("p",[s._v("另外，此变量还可设置为 off，会禁止 Go 在后续操作中校验模块哈希。")]),s._v(" "),t("h3",{attrs:{id:"_4-gonoproxy-gonosumdb-goprivate"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-gonoproxy-gonosumdb-goprivate"}},[s._v("#")]),s._v(" 4). GONOPROXY/GONOSUMDB/GOPRIVATE")]),s._v(" "),t("p",[s._v("这三个环境变量都是用在依赖了私有模块，这些模块 GOPROXY 和 GOSUMDB 都无法读取。")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("GONOPROXY")]),s._v(" —— 设置不走 Go Proxy 的 URL 规则；")]),s._v(" "),t("li",[t("code",[s._v("GONOSUMDB")]),s._v(" —— 设置不检查哈希的 URL 规则；")]),s._v(" "),t("li",[t("code",[s._v("GOPRIVATE")]),s._v(" —— 设置私有模块的 URL 规则，会同时设置以上两个变量。")])]),s._v(" "),t("p",[s._v("因为 "),t("code",[s._v("GOPRIVATE")]),s._v(" 会同时设定以上两个，所以一般私有仓库使用 "),t("code",[s._v("GOPRIVATE")]),s._v(" 即可。")]),s._v(" "),t("p",[s._v("以上三个值，都可使用逗号分隔来设置多个选项。例如：")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("go")]),s._v(" env "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("w GOPRIVATE"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"git.example.com,github.com/name/project"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("设置后当 "),t("code",[s._v("go get")]),s._v(" 时，前缀为 "),t("code",[s._v("git.example.com")]),s._v(" 和 "),t("code",[s._v("github.com/name/project")]),s._v(" 的模块都会被认为是私有模块。")]),s._v(" "),t("p",[s._v("我们也可以利用通配符，例如：")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("go")]),s._v(" env "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("w GOPRIVATE"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*.example.com"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("这样子设置的话，所有模块路径为 "),t("code",[s._v("example.com")]),s._v(" 的子域名（例如："),t("code",[s._v("git.example.com")]),s._v("）都将不经过 "),t("code",[s._v("Go module proxy")]),s._v(" 和 "),t("code",[s._v("Go checksum database")]),s._v("，需要注意的是不包括 "),t("code",[s._v("example.com")]),s._v(" 本身。")])])}),[],!1,null,null,null);a.default=o.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[169],{583:function(t,_,s){"use strict";s.r(_);var a=s(33),r=Object(a.a)({},(function(){var t=this,_=t.$createElement,s=t._self._c||_;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#说明"}},[t._v("#")]),t._v(" 说明")]),t._v(" "),s("p",[t._v("SELECT语句的处理过程")]),t._v(" "),s("p",[t._v("查询操作是关系数据库中使用最为频繁的操作，也是构成其他SQL语句（如DELETE、UPDATE）的基础。")]),t._v(" "),s("p",[t._v("我们知道，SQL 查询的大致语法结构如下：")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("(5)SELECT DISTINCT <select_list>                     \n\n(1)FROM <left_table> <join_type> JOIN <right_table> ON <on_predicate>\n\n(2)WHERE <where_predicate>\n\n(3)GROUP BY <group_by_specification>\n\n(4)HAVING <having_predicate>\n\n(6)ORDER BY <order_by_list>\n\n(7)LIMIT n, m\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br")])]),s("p",[t._v("查询处理的顺序如下:")]),t._v(" "),s("ul",[s("li",[t._v("1、FROM")]),t._v(" "),s("li",[t._v("2、ON")]),t._v(" "),s("li",[t._v("3、JOIN")]),t._v(" "),s("li",[t._v("4、WHERE")]),t._v(" "),s("li",[t._v("5、GROUP BY")]),t._v(" "),s("li",[t._v("6、HAVING")]),t._v(" "),s("li",[t._v("7、SELECT")]),t._v(" "),s("li",[t._v("8、DISTINCT")]),t._v(" "),s("li",[t._v("9、ORDER BY")]),t._v(" "),s("li",[t._v("10、LIMIT")])]),t._v(" "),s("p",[t._v("这些步骤执行时，每个步骤都会产生一个虚拟表，该虚拟表被用作下一个步骤的输入。这些虚拟表对调用者（客户端应用程序或者外部查询）不可用。只是最后一步生成的表才会返回给调用者。如果没有在查询中指定某一子句，将跳过相应的步骤。")]),t._v(" "),s("p",[t._v("SELECT各个阶段分别干了什么：")]),t._v(" "),s("h2",{attrs:{id:"_1-from阶段"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-from阶段"}},[t._v("#")]),t._v(" 1. FROM阶段")]),t._v(" "),s("p",[t._v("FROM阶段标识出查询的来源表，并处理表运算符。在涉及到联接运算的查询中（各种JOIN），主要有以下几个步骤：")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("求笛卡尔积")]),t._v("。不论是什么类型的联接运算，首先都是执行交叉连接（CROSS JOIN），求笛卡儿积（Cartesian product），生成虚拟表VT1-J1。")]),t._v(" "),s("li",[s("strong",[t._v("ON筛选器")]),t._v("。 这个阶段对上个步骤生成的VT1-J1进行筛选，根据ON子句中出现的谓词进行筛选，让谓词取值为true的行通过了考验，插入到VT1-J2。")]),t._v(" "),s("li",[s("strong",[t._v("添加外部行")]),t._v("。如果指定了OUTER JOIN，如LEFT OUTERJOIN、RIGHT OUTER JOIN），还需要将VT1-J2中没有找到匹配的行，作为外部行添加到VT1-J2中，生成VT1-J3。如果FROM子句包含两个以上表，则对上一个连接生成的结果表VT1-J3和下一个表重复依次执行3个步骤，直到处理完所有的表为止")])]),t._v(" "),s("blockquote",[s("p",[t._v("经过以上步骤，FROM阶段就完成了。")])]),t._v(" "),s("h2",{attrs:{id:"_2-where阶段"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-where阶段"}},[t._v("#")]),t._v(" 2. WHERE阶段")]),t._v(" "),s("p",[t._v("WHERE阶段是根据<"),s("code",[t._v("where_predicate")]),t._v(">中条件对VT1中的行进行筛选，让条件成立的行才会插入到VT2中。"),s("strong",[t._v("此时数据还没有分组，所以不能在WHERE中出现对统计的过滤。")])]),t._v(" "),s("h2",{attrs:{id:"_3-group-by阶段"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-group-by阶段"}},[t._v("#")]),t._v(" 3. GROUP BY阶段")]),t._v(" "),s("p",[t._v("GROUP阶段按照指定的列名列表，将VT2中的行进行分组，生成VT3。最后每个分组只有一行。"),s("strong",[t._v("在GROUP BY阶段，数据库认为两个NULL值是相等的，因此会将NULL值分到同一个分组中。")])]),t._v(" "),s("h2",{attrs:{id:"_4-having阶段"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-having阶段"}},[t._v("#")]),t._v(" 4. HAVING阶段")]),t._v(" "),s("p",[t._v("该阶段根据HAVING子句中出现的谓词对VT3的分组进行筛选，并将符合条件的组插入到VT4中。"),s("strong",[t._v("COUNT(expr) 会返回expr不为NULL的行数，count(1)、count(*)会返回包括NULL值在内的所有数量。")])]),t._v(" "),s("h2",{attrs:{id:"_5-select阶段"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-select阶段"}},[t._v("#")]),t._v(" 5. SELECT阶段")]),t._v(" "),s("p",[t._v("这个阶段是投影的过程，处理SELECT子句提到的元素，产生VT5。这个步骤一般按下列顺序进行：")]),t._v(" "),s("ul",[s("li",[t._v("计算SELECT列表中的表达式，生成VT5-1。")]),t._v(" "),s("li",[t._v("若有DISTINCT，则删除VT5-1中的重复行，生成VT5-2。")])]),t._v(" "),s("h2",{attrs:{id:"_6-order-by阶段"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-order-by阶段"}},[t._v("#")]),t._v(" 6. ORDER BY阶段")]),t._v(" "),s("p",[t._v("根据ORDER BY子句中指定的列明列表，对VT5-2中的行，进行排序，生成VT6。"),s("strong",[t._v("如果不指定排序，数据并非总是按照主键顺序进行排序的。NULL被视为最小值。")])]),t._v(" "),s("h2",{attrs:{id:"_7-limit阶段"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-limit阶段"}},[t._v("#")]),t._v(" 7. LIMIT阶段")]),t._v(" "),s("p",[t._v("取出指定行的记录，产生虚拟表VT7，并返回给查询用户。"),s("strong",[t._v("LIMIT n, m的效率是十分低的，一般可以通过在WHERE条件中指定范围来优化 WHERE id > ? limit 10。")])])])}),[],!1,null,null,null);_.default=r.exports}}]);
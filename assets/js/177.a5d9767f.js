(window.webpackJsonp=window.webpackJsonp||[]).push([[177],{591:function(s,a,t){"use strict";t.r(a);var n=t(33),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"索引概念简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#索引概念简介"}},[s._v("#")]),s._v(" 索引概念简介")]),s._v(" "),t("p",[s._v("通常说的索引有两种词性，名称和动词。")]),s._v(" "),t("ul",[t("li",[s._v("动词索引"),t("code",[s._v("indexing")]),s._v("，索引一个文档，表示把一个文档存储到索引Index里，可以用来查询和检索，es采用倒排索引")]),s._v(" "),t("li",[s._v("名词索引"),t("code",[s._v("index")]),s._v("，简单的理解成关系型数据库中的数据库的概念")])]),s._v(" "),t("blockquote",[t("p",[t("em",[s._v("索引的命名必须是全部小写，不能以下划线开头")])])]),s._v(" "),t("h2",{attrs:{id:"创建索引"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建索引"}},[s._v("#")]),s._v(" 创建索引")]),s._v(" "),t("blockquote",[t("p",[s._v("创建索引可以显式创建，也可以隐式创建")])]),s._v(" "),t("ul",[t("li",[t("code",[s._v("显式创建")]),s._v("：在关系型数据库中，需要先建数据库，在创建数据库时可以指定一些配置，如字符编码，数据库引擎等，创建表时需要指定表都包含哪些列，每个列的数据类型等，\n在Elasticsearch中创建数据库(索引)和创建表(映射)是一步完成的，显式创建需要在创建时指定对索引的一些配置，\n需要列举出索引包含的字段，也就是所谓的映射Mapping")]),s._v(" "),t("li",[t("code",[s._v("隐式操作")]),s._v("：隐式操作的方式是直接向索引中插入一条文档即可，es在插入的时候会判断索引是否存在，如果不存在，系统会根据文档包含的字段作为索引的映射，对索引的一些配置采用默认的配置来创建出来索引，创建索引的过程是es在后台默默的实现的。")])]),s._v(" "),t("blockquote",[t("p",[s._v("显式创建可以根据具体情况对索引进行配置，而且对于中文分词es是默认采用的分词是适合英文并适合中文的，可以在创建索引的时候自己指定分词器。")])]),s._v(" "),t("h2",{attrs:{id:"es支持的数据类型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#es支持的数据类型"}},[s._v("#")]),s._v(" ES支持的数据类型")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("text")]),s._v(" 文本类型，text类型如果不显示指定映射的字段属性，默认是使用标准分词器进行分词，一般数据类型是text要么显示指定分词器，要么不分词，一般不使用默认的分词器（除非文本是纯英文）")]),s._v(" "),t("li",[t("code",[s._v("keyword")]),s._v(" : 如果数组中的值是字符串，最好使用keyword, 它不会对字符串进行分词")]),s._v(" "),t("li",[t("code",[s._v("date")]),s._v(" 支持的日期格式：可以通过format定义日期的数据格式，也支持毫秒数")]),s._v(" "),t("li",[t("code",[s._v("boolean")])]),s._v(" "),t("li",[t("code",[s._v("float")])]),s._v(" "),t("li",[t("code",[s._v("double")])]),s._v(" "),t("li",[t("code",[s._v("byte")])]),s._v(" "),t("li",[t("code",[s._v("short")])]),s._v(" "),t("li",[t("code",[s._v("integer")])]),s._v(" "),t("li",[t("code",[s._v("long")])]),s._v(" "),t("li",[t("code",[s._v("object")])]),s._v(" "),t("li",[t("code",[s._v("nested")]),s._v(" : 嵌套对象, 用于数组中的元素是对象的[{}, {}]")]),s._v(" "),t("li",[t("code",[s._v("ip")]),s._v(" 即支持ipv4也支持ipv6")]),s._v(" "),t("li",[t("code",[s._v("completion")])]),s._v(" "),t("li",[t("code",[s._v("binary")])]),s._v(" "),t("li",[t("code",[s._v("geo-point")]),s._v("： 支持经纬度存储和距离范围检索")]),s._v(" "),t("li",[t("code",[s._v("geo-shape")]),s._v("：支持任意图形范围的检索，例如矩形和平面多边形")])]),s._v(" "),t("blockquote",[t("p",[s._v("注意：不同的数据类型索引的方式有稍许不同，如date何text类型不一样，date采用精确匹配，text采用全文检索方式。对于数组，es并没有专门的数组类型。任何域都可以包含0、1或者多个值，就像全文域分析得到多个词条。这暗示 数组中所有的值必须是相同数据类型的。")])]),s._v(" "),t("h3",{attrs:{id:"映射mappings"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#映射mappings"}},[s._v("#")]),s._v(" 映射mappings")]),s._v(" "),t("blockquote",[t("p",[s._v("映射就是创建索引时指定都包含哪些字段以及字段的数据类型、分词器等一些设置。")])]),s._v(" "),t("p",[s._v("字段设置参数")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("参数")]),s._v(" "),t("th",[s._v("说明")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v('"type": "text"')]),s._v(" "),t("td",[s._v("指定字段的数据类型")])]),s._v(" "),t("tr",[t("td",[s._v('"analyzer":"ik _max_word"')]),s._v(" "),t("td",[s._v("指定分词器的名称,即可用使用内置的分词器也可以使用第三方分词器;默认"),t("code",[s._v("standard")]),s._v(";内置的分析器有"),t("code",[s._v("whitespace")]),s._v(" 、 "),t("code",[s._v("simple")]),s._v("和"),t("code",[s._v("english")]),s._v(";第三方分词器："),t("code",[s._v("ik分词器")]),s._v(" 包括"),t("code",[s._v("ik_max_word")]),s._v("和"),t("code",[s._v("ik_smart")]),s._v("，"),t("code",[s._v("ik_max_word")]),s._v("：会将文本做"),t("code",[s._v("最细")]),s._v("粒度的拆分；尽可能多的拆分出词语 ，"),t("code",[s._v("ik_smart")]),s._v("：会做"),t("code",[s._v("最粗")]),s._v("粒度的拆分；已被分出的词语将不会再次被其它词语占有")])]),s._v(" "),t("tr",[t("td",[s._v('"search_analyzer":"ik _max_word"')]),s._v(" "),t("td",[s._v("指定查询的分词器,默认和analyzer保持一致，一般分词器和查询分词器要保持一致")])]),s._v(" "),t("tr",[t("td",[s._v('"properties": {}')]),s._v(" "),t("td",[s._v("当数据类型是object时，需要具体指定内部对象对应的字段")])]),s._v(" "),t("tr",[t("td",[s._v('"format": "yyy-MM-dd HH:mm:ss')]),s._v(" "),t("td")]),s._v(" "),t("tr",[t("td",[s._v('"dynamic": "strict"')]),s._v(" "),t("td",[s._v("动态映射配置，当文档中发现新字段时应该如何处理, 可以用在 object 或任何 object 类型的字段上，你可以将 "),t("code",[s._v("dynamic")]),s._v(" 的默认值设置为 "),t("code",[s._v("strict")]),s._v(" , 而只在指定的内部对象中开启它;"),t("code",[s._v("true")]),s._v(": 默认值，动态添加新的字段;"),t("code",[s._v("false")]),s._v(": 忽略新的字段;"),t("code",[s._v("strict")]),s._v(": 如果遇到新字段抛出异常,如果Elasticsearch是作为重要的数据存储，可能就会期望遇到新字段就会抛出异常，这样能及时发现问题")])]),s._v(" "),t("tr",[t("td",[s._v("dynamic_templates 动态模板")]),s._v(" "),t("td",[s._v("为满足条件的字段做统一映射，可以通过字段名称或者字段类型来匹配指定的映射规则，每个模板都有一个名称，你可以用来描述这个模板的用途， 一个mapping来指定映射应该怎样使用，以及至少一个参数 (如 match) 来定义这个模板适用于哪个字段。 模板按照顺序来检测；第一个匹配的模板会被启用;"),t("code",[s._v("match")]),s._v(" 参数只匹配字段名称;"),t("code",[s._v("match_mapping_type")]),s._v(" 允许你应用模板到特定类型的字段上，就像有标准动态映射规则检测的一样")])]),s._v(" "),t("tr",[t("td",[s._v('"fielddata":boolean')]),s._v(" "),t("td",[s._v("针对分词字段，参与排序或聚合时能提高性能，默认是false，false是不允许聚合操作的")])]),s._v(" "),t("tr",[t("td",[s._v('"boost":1.23')]),s._v(" "),t("td",[s._v("权重：字段级别的分数加权，指定字段在搜索时所占的权重，所占的百分比")])]),s._v(" "),t("tr",[t("td",[s._v('"fields":{"raw":{"type":"keyword"}}')]),s._v(" "),t("td",[s._v("可以对一个字段提供多种索引模式，同一个字段的值，一个分词，一个不分词，应用场景：即可以用于对字符串进行字符排序，也可以全文索引,排序时使用字段.raw来引用排序字段")])]),s._v(" "),t("tr",[t("td",[s._v('"index": "analyzed"')]),s._v(" "),t("td",[s._v("指定文本类型的字段是否分词、是否存储该字段的值（在新版本中index值为boolean类型，语意也发生了变化，TODO待更新），有三个值："),t("code",[s._v("analyzed")]),s._v(":首先分析字符串，然后索引(存储)它。换句话说，以全文索引这个域（也就是说即分词，又存储字段的值，即可以通过全文检索的方式对该字段进行搜索）；"),t("code",[s._v("not_analyzed")]),s._v(":索引(存储)这个域，所以它能够被搜索，但索引的是精确值。不会对它进行分析(不对字段的值进行分词，而是完整的存储该值，所以只能通过精确值才能搜索出来，即完全匹配，相当于sql中的等号=的作用)；"),t("code",[s._v("no")]),s._v(":不索引这个域。这个域不会被搜索到(对该字段不分词，也不存储，相当于没有这个字段一样？？？)")])]),s._v(" "),t("tr",[t("td",[s._v('"store":false')]),s._v(" "),t("td",[s._v("是否单独设置此字段的是否存储而从"),t("code",[s._v("_source")]),s._v("字段中分离，默认是"),t("code",[s._v("false")]),s._v("，只能搜索，不能获取值")])]),s._v(" "),t("tr",[t("td",[s._v('"doc_values":false')]),s._v(" "),t("td",[s._v("对not_analyzed字段，默认都是开启，分词字段不能使用，对排序和聚合能提升较大性能，节约内存")])]),s._v(" "),t("tr",[t("td",[s._v('"ignore_above":100')]),s._v(" "),t("td",[s._v("超过100个字符的文本，将会被忽略，不被索引")])]),s._v(" "),t("tr",[t("td",[s._v('"include_in_all":ture')]),s._v(" "),t("td",[s._v("设置是否此字段包含在_all字段中，默认是true，除非index设置成no选项")])]),s._v(" "),t("tr",[t("td",[s._v('"index_options":"docs"')]),s._v(" "),t("td",[s._v("4个可选参数docs（索引文档号） ,"),t("code",[s._v("freqs")]),s._v("（文档号+词频），"),t("code",[s._v("positions")]),s._v("（文档号+词频+位置，通常用来距离查询），"),t("code",[s._v("offsets")]),s._v("（文档号+词频+位置+偏移量，通常被使用在高亮字段）分词字段默认是"),t("code",[s._v("position")]),s._v("，其他的默认是"),t("code",[s._v("docs")])])]),s._v(" "),t("tr",[t("td",[s._v('"norms":{"enable":true,"loading":"lazy"}')]),s._v(" "),t("td",[s._v("分词字段默认配置，不分词字段：默认"),t("code",[s._v('{"enable":false}')]),s._v("，存储长度因子和索引时boost，建议对需要参与评分字段使用 ，会额外增加内存消耗量")])]),s._v(" "),t("tr",[t("td",[s._v('"null_value":"NULL"')]),s._v(" "),t("td",[s._v("设置一些缺失字段的初始化值，只有string可以使用，分词字段的null值也会被分词")])]),s._v(" "),t("tr",[t("td",[s._v('"position_increament_gap":0')]),s._v(" "),t("td",[s._v("影响距离查询或近似查询，可以设置在多值字段的数据上火分词字段上，查询时可指定"),t("code",[s._v("slop")]),s._v("间隔，默认值是100")])]),s._v(" "),t("tr",[t("td",[s._v('"similarity":"BM25"')]),s._v(" "),t("td",[s._v("默认是"),t("code",[s._v("TF/IDF")]),s._v("算法，指定一个字段评分策略，仅仅对字符串型和分词类型有效")])]),s._v(" "),t("tr",[t("td",[s._v('"term_vector":"no"')]),s._v(" "),t("td",[s._v("默认不存储向量信息，支持参数yes（term存储），"),t("code",[s._v("with_positions")]),s._v("（term+位置）,"),t("code",[s._v("with_offsets")]),s._v("（term+偏移量），"),t("code",[s._v("with_positions_offsets")]),s._v("(term+位置+偏移量) 对快速高亮fast vector highlighter能提升性能，但开启又会加大索引体积，不适合大数据量用")])])])]),s._v(" "),t("hr"),s._v(" "),t("p",[s._v("ik分词器 "),t("a",{attrs:{href:"https://github.com/medcl/elasticsearch-analysis-ik",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/medcl/elasticsearch-analysis-ik"),t("OutboundLink")],1),s._v(" 支持自定义热词配置(如 香菇 蓝瘦 帅的一逼 等)")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认standard，内置的分析器有whitespace 、 simple 和 english")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ik支持两种分词器：ik_max_word，ik_smart")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 分析器：用于测试分词的数据")]),s._v("\nGET /_analyze\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"analyzer"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ik_max_word"')]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"text"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"美国留给伊拉克的是个烂摊子吗"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h3",{attrs:{id:"settings设置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#settings设置"}},[s._v("#")]),s._v(" settings设置")]),s._v(" "),t("blockquote",[t("p",[s._v("settings用于设置索引的分片数量、副本数量、默认的分词器等，Elasticsearch 提供了优化好的默认配置。 除非你理解这些配置的作用并且知道为什么要去修改，否则不要随意修改。")])]),s._v(" "),t("ul",[t("li",[s._v('"number_of_shards" : 5, #每个索引的主分片数，默认值是 5 。这个配置在索引创建后不能修改。')]),s._v(" "),t("li",[s._v('"number_of_replicas" : 1, # 每个主分片的副本数，默认值是 1 。对于活动的索引库，这个配置可以随时修改。')]),s._v(" "),t("li",[s._v('"analysis" : { "analyzer" : { "ik" : { "tokenizer" : "ik_ max_word" } } }')])]),s._v(" "),t("p",[s._v("创建只有 一个主分片，没有副本的小索引：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("PUT /my_temp_index\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"settings"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"number_of_shards"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(",\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"number_of_replicas"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("用update-index-settings API 动态修改副本数：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("PUT /my_temp_index/_settings\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"number_of_replicas"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"aliases别名"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#aliases别名"}},[s._v("#")]),s._v(" aliases别名")]),s._v(" "),t("p",[s._v("索引别名就像一个快捷方式或软连接,或者是一个指向，都是最终指的同一个东西，别名 带给我们极大的灵活性，允许我们做下面这些：")]),s._v(" "),t("ul",[t("li",[s._v("在运行的集群中可以无缝的从一个索引切换到另一个索引")]),s._v(" "),t("li",[s._v("给多个索引分组 (例如， last_three_months)")]),s._v(" "),t("li",[s._v("给索引的一个子集创建 视图")])]),s._v(" "),t("p",[s._v("有两种方式管理别名： _alias用于单个操作， _aliases用于执行多个原子级操作。")]),s._v(" "),t("p",[s._v("Mapping一旦创建是不允许修改字段的数据类型的，为了防止以后有可能修改索引的情况，刚开始创建索引时最好就为该索引创建一个别名，然后在程序中直接使用别名，而不使用真实的索引名称。\n如果后面需要要修改映射，可以再创建一个新的索引，然后把之前索引里的数据导入到新创建的索引里, 为新索引增加一个别名，将别名从老索引中移除，这样应用程序仍然使用的是别名，而这个别名已经指向了新的索引，这样就达到了不修改索引名而修改索引的目的。")]),s._v(" "),t("ul",[t("li",[t("ol",{attrs:{start:"0"}},[t("li",[s._v("创建索引(age的类型为long)")])])])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("PUT /class_v1\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mappings"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"properties"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"type"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"text"')]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"age"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"type"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"long"')]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("POST /class_v1/_bulk\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"index"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_id"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"张三"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"age"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"index"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_id"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"小明"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"age"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("ul",[t("li",[t("ol",[t("li",[s._v("为索引创建一个别名")])])])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("PUT /class_v1/_alias/class\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("查看别名指向的索引")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("GET /*/_alias/class\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("查询索引对应的别名")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("GET /class_v1/_alias/*\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("2.创建一个新的索引，名字不能和之前的不一样，这次将age的数据类型改为short")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("PUT /class_v2\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mappings"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"properties"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"type"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"text"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"age"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"type"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"short"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("ul",[t("li",[s._v("3.迁移数据：将之前的索引里的文档迁移到新的索引上")])]),s._v(" "),t("p",[s._v("先将数据批量查询出来，然后批量插入")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("GET /class/_search?scroll"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1m\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("POST /class_v2/_bulk\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"index"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_id"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"张三"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"age"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"index"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_id"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"小明"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"age"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("GET /class_v2/_search\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("4.为新索引增加别名，别名名称为老索引名称，这样系统可以直接使用老索引的名称来操作新索引")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("POST /_aliases\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"actions"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"remove"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"index"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"class_v1"')]),s._v(",\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"alias"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"class"')]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("POST /_aliases\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"actions"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"add"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"index"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"class_v2"')]),s._v(",\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"alias"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"class"')]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("GET /class/_search\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("别名就是索引的另一个名字，就像人的姓名和笔名一样，都是指向的同一个人，可以通过POST /_aliases 路径对别名进行add、remove操作")]),s._v(" "),t("blockquote",[t("p",[s._v("TIP: 在你的应用中使用别名而不是索引名。然后你就可以在任何时候重建索引。别名的开销很小，应该广泛使用。")])]),s._v(" "),t("h2",{attrs:{id:"注意"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#注意"}},[s._v("#")]),s._v(" 注意")]),s._v(" "),t("blockquote",[t("p",[s._v("禁用_all或者通配符，防止误操作\n对一些人来说，能够用单个命令来删除所有数据可能会导致可怕的后果。如果你想要避免意外的大量删除, 你可以在你的 "),t("code",[s._v("elasticsearch.yml")]),s._v(" 做如下配置："),t("code",[s._v("action.destructive_requires_name: true")]),s._v("\n这个设置使删除只限于特定名称指向的数据, 而不允许通过指定 _all 或通配符来删除指定索引库。你同样可以通过 Cluster State API 动态的更新这个设置")])])])}),[],!1,null,null,null);a.default=e.exports}}]);
<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>查询入门 | wu是小任</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="技术博客">
    <meta name="keywords" content="php,go,mysql,git,linux,Ubuntu,supervisor,redis,elasticsearch,mac,homebrew,node,phpstorm,vscode,nginx,http,laravel,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.5c0233a9.css" as="style"><link rel="preload" href="/assets/js/app.1e589c65.js" as="script"><link rel="preload" href="/assets/js/2.88f1b11e.js" as="script"><link rel="preload" href="/assets/js/179.8fb8795a.js" as="script"><link rel="prefetch" href="/assets/js/10.841cad22.js"><link rel="prefetch" href="/assets/js/100.51998793.js"><link rel="prefetch" href="/assets/js/101.6c468945.js"><link rel="prefetch" href="/assets/js/102.b0d49473.js"><link rel="prefetch" href="/assets/js/103.05368587.js"><link rel="prefetch" href="/assets/js/104.db06069a.js"><link rel="prefetch" href="/assets/js/105.d71aebe6.js"><link rel="prefetch" href="/assets/js/106.3dd77c43.js"><link rel="prefetch" href="/assets/js/107.c9352dba.js"><link rel="prefetch" href="/assets/js/108.60fc1978.js"><link rel="prefetch" href="/assets/js/109.b50945eb.js"><link rel="prefetch" href="/assets/js/11.26be53ce.js"><link rel="prefetch" href="/assets/js/110.da8531d4.js"><link rel="prefetch" href="/assets/js/111.6553bf3b.js"><link rel="prefetch" href="/assets/js/112.31c4b613.js"><link rel="prefetch" href="/assets/js/113.372a4397.js"><link rel="prefetch" href="/assets/js/114.429de267.js"><link rel="prefetch" href="/assets/js/115.f06e0838.js"><link rel="prefetch" href="/assets/js/116.d7f045c3.js"><link rel="prefetch" href="/assets/js/117.eec0c9b1.js"><link rel="prefetch" href="/assets/js/118.9dfe8cde.js"><link rel="prefetch" href="/assets/js/119.0c702c0e.js"><link rel="prefetch" href="/assets/js/12.dd4998f7.js"><link rel="prefetch" href="/assets/js/120.9eb0dcae.js"><link rel="prefetch" href="/assets/js/121.7c6a9bf6.js"><link rel="prefetch" href="/assets/js/122.94f961a3.js"><link rel="prefetch" href="/assets/js/123.a1f3dd6f.js"><link rel="prefetch" href="/assets/js/124.22b8f492.js"><link rel="prefetch" href="/assets/js/125.740f30c6.js"><link rel="prefetch" href="/assets/js/126.955d1117.js"><link rel="prefetch" href="/assets/js/127.42127d56.js"><link rel="prefetch" href="/assets/js/128.9bc0e471.js"><link rel="prefetch" href="/assets/js/129.846d556c.js"><link rel="prefetch" href="/assets/js/13.468b5a9e.js"><link rel="prefetch" href="/assets/js/130.c8141363.js"><link rel="prefetch" href="/assets/js/131.05d9d829.js"><link rel="prefetch" href="/assets/js/132.bd94d255.js"><link rel="prefetch" href="/assets/js/133.94d50492.js"><link rel="prefetch" href="/assets/js/134.f982ce4d.js"><link rel="prefetch" href="/assets/js/135.e0c5e23f.js"><link rel="prefetch" href="/assets/js/136.4218c448.js"><link rel="prefetch" href="/assets/js/137.034f160d.js"><link rel="prefetch" href="/assets/js/138.5d22193b.js"><link rel="prefetch" href="/assets/js/139.e9766435.js"><link rel="prefetch" href="/assets/js/14.b843bca5.js"><link rel="prefetch" href="/assets/js/140.5e8af980.js"><link rel="prefetch" href="/assets/js/141.8289f718.js"><link rel="prefetch" href="/assets/js/142.61b0d99b.js"><link rel="prefetch" href="/assets/js/143.394fddeb.js"><link rel="prefetch" href="/assets/js/144.6199ee12.js"><link rel="prefetch" href="/assets/js/145.db0769aa.js"><link rel="prefetch" href="/assets/js/146.a11e3954.js"><link rel="prefetch" href="/assets/js/147.50342bd3.js"><link rel="prefetch" href="/assets/js/148.c1930835.js"><link rel="prefetch" href="/assets/js/149.ad1dc3fc.js"><link rel="prefetch" href="/assets/js/15.82642fdc.js"><link rel="prefetch" href="/assets/js/150.13980057.js"><link rel="prefetch" href="/assets/js/151.dff707b3.js"><link rel="prefetch" href="/assets/js/152.755f33bb.js"><link rel="prefetch" href="/assets/js/153.f6b4e4a0.js"><link rel="prefetch" href="/assets/js/154.3d7d5f06.js"><link rel="prefetch" href="/assets/js/155.28895750.js"><link rel="prefetch" href="/assets/js/156.0e3eac12.js"><link rel="prefetch" href="/assets/js/157.eb3f6943.js"><link rel="prefetch" href="/assets/js/158.b2b76246.js"><link rel="prefetch" href="/assets/js/159.54505091.js"><link rel="prefetch" href="/assets/js/16.f6ad1ace.js"><link rel="prefetch" href="/assets/js/160.75ced8cd.js"><link rel="prefetch" href="/assets/js/161.a8c1181b.js"><link rel="prefetch" href="/assets/js/162.f4fbcb4e.js"><link rel="prefetch" href="/assets/js/163.e8f4bc4b.js"><link rel="prefetch" href="/assets/js/164.72ae826e.js"><link rel="prefetch" href="/assets/js/165.8439fde1.js"><link rel="prefetch" href="/assets/js/166.523232cb.js"><link rel="prefetch" href="/assets/js/167.182219f1.js"><link rel="prefetch" href="/assets/js/168.bfe88da4.js"><link rel="prefetch" href="/assets/js/169.a9487546.js"><link rel="prefetch" href="/assets/js/17.6b47855d.js"><link rel="prefetch" href="/assets/js/170.c2dbc708.js"><link rel="prefetch" href="/assets/js/171.f6c66625.js"><link rel="prefetch" href="/assets/js/172.3cb1c6b6.js"><link rel="prefetch" href="/assets/js/173.a57d52bb.js"><link rel="prefetch" href="/assets/js/174.64636356.js"><link rel="prefetch" href="/assets/js/175.3e7b17c7.js"><link rel="prefetch" href="/assets/js/176.f110f9dd.js"><link rel="prefetch" href="/assets/js/177.a5d9767f.js"><link rel="prefetch" href="/assets/js/178.b828eabf.js"><link rel="prefetch" href="/assets/js/18.c793116a.js"><link rel="prefetch" href="/assets/js/180.96eecf5a.js"><link rel="prefetch" href="/assets/js/181.c5ef8573.js"><link rel="prefetch" href="/assets/js/182.3f0a3288.js"><link rel="prefetch" href="/assets/js/183.abde4e85.js"><link rel="prefetch" href="/assets/js/184.9db78423.js"><link rel="prefetch" href="/assets/js/185.aeb0dd26.js"><link rel="prefetch" href="/assets/js/186.35b33622.js"><link rel="prefetch" href="/assets/js/187.c61feca1.js"><link rel="prefetch" href="/assets/js/188.100593bc.js"><link rel="prefetch" href="/assets/js/189.39102e19.js"><link rel="prefetch" href="/assets/js/19.ff3ee999.js"><link rel="prefetch" href="/assets/js/190.0de8ae5e.js"><link rel="prefetch" href="/assets/js/191.75a6b8be.js"><link rel="prefetch" href="/assets/js/192.fb8d4293.js"><link rel="prefetch" href="/assets/js/193.f9d0383e.js"><link rel="prefetch" href="/assets/js/194.6264be7d.js"><link rel="prefetch" href="/assets/js/195.9a5824c7.js"><link rel="prefetch" href="/assets/js/196.a47986aa.js"><link rel="prefetch" href="/assets/js/197.3b2af781.js"><link rel="prefetch" href="/assets/js/198.ea524bd0.js"><link rel="prefetch" href="/assets/js/199.1b4e2763.js"><link rel="prefetch" href="/assets/js/20.acd8958e.js"><link rel="prefetch" href="/assets/js/200.a98d2090.js"><link rel="prefetch" href="/assets/js/201.056e1893.js"><link rel="prefetch" href="/assets/js/202.983695b3.js"><link rel="prefetch" href="/assets/js/203.1754bdaf.js"><link rel="prefetch" href="/assets/js/204.d72180b6.js"><link rel="prefetch" href="/assets/js/205.aa1619ca.js"><link rel="prefetch" href="/assets/js/206.d7670d45.js"><link rel="prefetch" href="/assets/js/207.b91c6424.js"><link rel="prefetch" href="/assets/js/208.8949b155.js"><link rel="prefetch" href="/assets/js/209.995f01a0.js"><link rel="prefetch" href="/assets/js/21.45b8c721.js"><link rel="prefetch" href="/assets/js/210.8b1f7b0f.js"><link rel="prefetch" href="/assets/js/211.eeff13d8.js"><link rel="prefetch" href="/assets/js/212.15009f62.js"><link rel="prefetch" href="/assets/js/213.7a1c1403.js"><link rel="prefetch" href="/assets/js/214.c4854ed6.js"><link rel="prefetch" href="/assets/js/215.821d1a35.js"><link rel="prefetch" href="/assets/js/216.79a8cecb.js"><link rel="prefetch" href="/assets/js/217.2fdb4822.js"><link rel="prefetch" href="/assets/js/218.5fbb557d.js"><link rel="prefetch" href="/assets/js/219.f0ea7c75.js"><link rel="prefetch" href="/assets/js/22.bd91939f.js"><link rel="prefetch" href="/assets/js/220.42b47c5f.js"><link rel="prefetch" href="/assets/js/221.cf7b95fc.js"><link rel="prefetch" href="/assets/js/222.55faee81.js"><link rel="prefetch" href="/assets/js/223.92129ca8.js"><link rel="prefetch" href="/assets/js/224.f93b31b5.js"><link rel="prefetch" href="/assets/js/225.40289022.js"><link rel="prefetch" href="/assets/js/226.91eabc11.js"><link rel="prefetch" href="/assets/js/227.2637ffec.js"><link rel="prefetch" href="/assets/js/228.b4030713.js"><link rel="prefetch" href="/assets/js/229.b217f170.js"><link rel="prefetch" href="/assets/js/23.d23edfdb.js"><link rel="prefetch" href="/assets/js/230.774b2cf7.js"><link rel="prefetch" href="/assets/js/231.9cfabadb.js"><link rel="prefetch" href="/assets/js/232.0dfd9098.js"><link rel="prefetch" href="/assets/js/233.89ec9430.js"><link rel="prefetch" href="/assets/js/234.6d3aa860.js"><link rel="prefetch" href="/assets/js/235.0125efb9.js"><link rel="prefetch" href="/assets/js/236.dc3eedd0.js"><link rel="prefetch" href="/assets/js/237.1f585a8f.js"><link rel="prefetch" href="/assets/js/238.0c2ccc12.js"><link rel="prefetch" href="/assets/js/239.fe90d092.js"><link rel="prefetch" href="/assets/js/24.49b37ec7.js"><link rel="prefetch" href="/assets/js/240.1a140685.js"><link rel="prefetch" href="/assets/js/241.7bda5546.js"><link rel="prefetch" href="/assets/js/242.1e1eb5a0.js"><link rel="prefetch" href="/assets/js/243.a087d701.js"><link rel="prefetch" href="/assets/js/25.b777b097.js"><link rel="prefetch" href="/assets/js/26.b6917a39.js"><link rel="prefetch" href="/assets/js/27.3f5d3fbe.js"><link rel="prefetch" href="/assets/js/28.b57d2950.js"><link rel="prefetch" href="/assets/js/29.b9ce0913.js"><link rel="prefetch" href="/assets/js/3.11af9f74.js"><link rel="prefetch" href="/assets/js/30.b8f127af.js"><link rel="prefetch" href="/assets/js/31.fb86cd7c.js"><link rel="prefetch" href="/assets/js/32.cfcbef90.js"><link rel="prefetch" href="/assets/js/33.02538437.js"><link rel="prefetch" href="/assets/js/34.84b90d39.js"><link rel="prefetch" href="/assets/js/35.7d787ffc.js"><link rel="prefetch" href="/assets/js/36.479a70ae.js"><link rel="prefetch" href="/assets/js/37.100d6271.js"><link rel="prefetch" href="/assets/js/38.8dc3e394.js"><link rel="prefetch" href="/assets/js/39.22a52480.js"><link rel="prefetch" href="/assets/js/4.7ceac8be.js"><link rel="prefetch" href="/assets/js/40.d62d8b57.js"><link rel="prefetch" href="/assets/js/41.7886543c.js"><link rel="prefetch" href="/assets/js/42.2cbee609.js"><link rel="prefetch" href="/assets/js/43.9d932b93.js"><link rel="prefetch" href="/assets/js/44.c7b3b09d.js"><link rel="prefetch" href="/assets/js/45.c7158bb0.js"><link rel="prefetch" href="/assets/js/46.e4b553b3.js"><link rel="prefetch" href="/assets/js/47.d012cbe5.js"><link rel="prefetch" href="/assets/js/48.22181e25.js"><link rel="prefetch" href="/assets/js/49.ec206af2.js"><link rel="prefetch" href="/assets/js/5.3b91bdc7.js"><link rel="prefetch" href="/assets/js/50.3c8f6854.js"><link rel="prefetch" href="/assets/js/51.52eefae6.js"><link rel="prefetch" href="/assets/js/52.264461fa.js"><link rel="prefetch" href="/assets/js/53.252a1bf8.js"><link rel="prefetch" href="/assets/js/54.8bc6278e.js"><link rel="prefetch" href="/assets/js/55.89b8032a.js"><link rel="prefetch" href="/assets/js/56.5f32fbd2.js"><link rel="prefetch" href="/assets/js/57.f79d3ea0.js"><link rel="prefetch" href="/assets/js/58.ff002095.js"><link rel="prefetch" href="/assets/js/59.ccabf3c0.js"><link rel="prefetch" href="/assets/js/6.97d7c801.js"><link rel="prefetch" href="/assets/js/60.63af8d58.js"><link rel="prefetch" href="/assets/js/61.bd86bfe3.js"><link rel="prefetch" href="/assets/js/62.1ccff20f.js"><link rel="prefetch" href="/assets/js/63.fec347bd.js"><link rel="prefetch" href="/assets/js/64.59938043.js"><link rel="prefetch" href="/assets/js/65.80a201ed.js"><link rel="prefetch" href="/assets/js/66.060cb376.js"><link rel="prefetch" href="/assets/js/67.e7cdf133.js"><link rel="prefetch" href="/assets/js/68.b276c430.js"><link rel="prefetch" href="/assets/js/69.2a781f0d.js"><link rel="prefetch" href="/assets/js/7.69762135.js"><link rel="prefetch" href="/assets/js/70.46fadeba.js"><link rel="prefetch" href="/assets/js/71.c90f362e.js"><link rel="prefetch" href="/assets/js/72.948db37a.js"><link rel="prefetch" href="/assets/js/73.644348d1.js"><link rel="prefetch" href="/assets/js/74.8a2b234f.js"><link rel="prefetch" href="/assets/js/75.58e17415.js"><link rel="prefetch" href="/assets/js/76.8b22b279.js"><link rel="prefetch" href="/assets/js/77.e6faf941.js"><link rel="prefetch" href="/assets/js/78.ccc9f064.js"><link rel="prefetch" href="/assets/js/79.d6d322ef.js"><link rel="prefetch" href="/assets/js/8.b2c29ddc.js"><link rel="prefetch" href="/assets/js/80.40ab210a.js"><link rel="prefetch" href="/assets/js/81.a8faa74e.js"><link rel="prefetch" href="/assets/js/82.0137fd70.js"><link rel="prefetch" href="/assets/js/83.59167c32.js"><link rel="prefetch" href="/assets/js/84.27dd00eb.js"><link rel="prefetch" href="/assets/js/85.2278b5f0.js"><link rel="prefetch" href="/assets/js/86.b64a0ffe.js"><link rel="prefetch" href="/assets/js/87.0b55b1ed.js"><link rel="prefetch" href="/assets/js/88.b276ef0f.js"><link rel="prefetch" href="/assets/js/89.235a3fc0.js"><link rel="prefetch" href="/assets/js/9.f9068b0b.js"><link rel="prefetch" href="/assets/js/90.5cfa4b5d.js"><link rel="prefetch" href="/assets/js/91.10af5a2f.js"><link rel="prefetch" href="/assets/js/92.1c59b283.js"><link rel="prefetch" href="/assets/js/93.c56553a2.js"><link rel="prefetch" href="/assets/js/94.c8cf7705.js"><link rel="prefetch" href="/assets/js/95.daff829b.js"><link rel="prefetch" href="/assets/js/96.62580526.js"><link rel="prefetch" href="/assets/js/97.317bc21b.js"><link rel="prefetch" href="/assets/js/98.abfaa9df.js"><link rel="prefetch" href="/assets/js/99.b7fd50d8.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5c0233a9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu theme-mode-light"><header class="navbar"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/avater.jpeg" alt="wu是小任" class="logo"> <span class="site-name can-hide">wu是小任</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/notes/" class="nav-link">笔记</a></div><div class="nav-item"><a href="/technology/" class="nav-link">技术</a></div><div class="nav-item"><a href="/php/" class="nav-link">PHP</a></div><div class="nav-item"><a href="/go/" class="nav-link">GO</a></div><div class="nav-item"><a href="/mysql/" class="nav-link">MYSQL</a></div><div class="nav-item"><a href="/redis/" class="nav-link">Redis</a></div><div class="nav-item"><a href="/elasticsearch/" class="nav-link">Elasticsearch</a></div><div class="nav-item"><a href="/rabbitmq/" class="nav-link">Rabbitmq</a></div><div class="nav-item"><a href="/mac/" class="nav-link">Mac</a></div><div class="nav-item"><a href="/favorites/" class="nav-link">收藏</a></div><div class="nav-item"><a href="/timeline/" class="nav-link">时间轴</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/avater.jpeg"> <div class="blogger-info"><h3>wu是小任</h3> <div class="icons"><a href="mailto:zhifan1005@163.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/renzhifan" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/notes/" class="nav-link">笔记</a></div><div class="nav-item"><a href="/technology/" class="nav-link">技术</a></div><div class="nav-item"><a href="/php/" class="nav-link">PHP</a></div><div class="nav-item"><a href="/go/" class="nav-link">GO</a></div><div class="nav-item"><a href="/mysql/" class="nav-link">MYSQL</a></div><div class="nav-item"><a href="/redis/" class="nav-link">Redis</a></div><div class="nav-item"><a href="/elasticsearch/" class="nav-link">Elasticsearch</a></div><div class="nav-item"><a href="/rabbitmq/" class="nav-link">Rabbitmq</a></div><div class="nav-item"><a href="/mac/" class="nav-link">Mac</a></div><div class="nav-item"><a href="/favorites/" class="nav-link">收藏</a></div><div class="nav-item"><a href="/timeline/" class="nav-link">时间轴</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>elasticsearch教程</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/e655a410ff21cd07/" class="sidebar-link">安装</a></li><li><a href="/pages/2af444818f5230c8/" class="sidebar-link">核心概念</a></li><li><a href="/pages/d135507d7e5df309/" class="sidebar-link">索引&amp;映射</a></li><li><a href="/pages/ce8defeddfad513a/" class="sidebar-link">文档CURD</a></li><li><a href="/pages/70dab84cfe59fdc1/" aria-current="page" class="active sidebar-link">查询入门</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/70dab84cfe59fdc1/#查询表达式dsl" class="sidebar-link">查询表达式DSL</a></li><li class="sidebar-sub-header"><a href="/pages/70dab84cfe59fdc1/#match-匹配查询" class="sidebar-link">match 匹配查询</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/70dab84cfe59fdc1/#最简单的一个match例子" class="sidebar-link">最简单的一个match例子：</a></li><li class="sidebar-sub-header"><a href="/pages/70dab84cfe59fdc1/#查询name中包含-女装-的文档" class="sidebar-link">查询name中包含“女装”的文档</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/70dab84cfe59fdc1/#match-all-简单的匹配所有文档" class="sidebar-link">match_all 简单的匹配所有文档</a></li><li class="sidebar-sub-header"><a href="/pages/70dab84cfe59fdc1/#match-phrase" class="sidebar-link">match_phrase</a></li><li class="sidebar-sub-header"><a href="/pages/70dab84cfe59fdc1/#match-phrase-prefix" class="sidebar-link">matchphraseprefix</a></li><li class="sidebar-sub-header"><a href="/pages/70dab84cfe59fdc1/#索引时输入即搜索" class="sidebar-link">索引时输入即搜索</a></li><li class="sidebar-sub-header"><a href="/pages/70dab84cfe59fdc1/#multi-match" class="sidebar-link">multi_match</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/70dab84cfe59fdc1/#best-fields" class="sidebar-link">best_fields</a></li><li class="sidebar-sub-header"><a href="/pages/70dab84cfe59fdc1/#most-fields" class="sidebar-link">most_fields</a></li><li class="sidebar-sub-header"><a href="/pages/70dab84cfe59fdc1/#cross-fields" class="sidebar-link">cross_fields</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/70dab84cfe59fdc1/#constant-score-常量分数" class="sidebar-link">constant_score 常量分数</a></li><li class="sidebar-sub-header"><a href="/pages/70dab84cfe59fdc1/#prefix-前缀查询" class="sidebar-link">prefix 前缀查询</a></li><li class="sidebar-sub-header"><a href="/pages/70dab84cfe59fdc1/#wildcard-和-regexp" class="sidebar-link">wildcard 和 regexp</a></li><li class="sidebar-sub-header"><a href="/pages/70dab84cfe59fdc1/#range" class="sidebar-link">range</a></li><li class="sidebar-sub-header"><a href="/pages/70dab84cfe59fdc1/#term" class="sidebar-link">term</a></li><li class="sidebar-sub-header"><a href="/pages/70dab84cfe59fdc1/#terms" class="sidebar-link">terms</a></li><li class="sidebar-sub-header"><a href="/pages/70dab84cfe59fdc1/#exists" class="sidebar-link">exists</a></li><li class="sidebar-sub-header"><a href="/pages/70dab84cfe59fdc1/#highlight-高亮" class="sidebar-link">highlight：高亮</a></li><li class="sidebar-sub-header"><a href="/pages/70dab84cfe59fdc1/#sort" class="sidebar-link">sort</a></li><li class="sidebar-sub-header"><a href="/pages/70dab84cfe59fdc1/#from" class="sidebar-link">from</a></li><li class="sidebar-sub-header"><a href="/pages/70dab84cfe59fdc1/#size" class="sidebar-link">size</a></li><li class="sidebar-sub-header"><a href="/pages/70dab84cfe59fdc1/#游标查询scroll" class="sidebar-link">游标查询Scroll</a></li><li class="sidebar-sub-header"><a href="/pages/70dab84cfe59fdc1/#bool联合查询-must-should-must-not" class="sidebar-link">bool联合查询: must,should,must_not</a></li><li class="sidebar-sub-header"><a href="/pages/70dab84cfe59fdc1/#aggs" class="sidebar-link">aggs</a></li><li class="sidebar-sub-header"><a href="/pages/70dab84cfe59fdc1/#mget" class="sidebar-link">_mget</a></li><li class="sidebar-sub-header"><a href="/pages/70dab84cfe59fdc1/#bulk" class="sidebar-link">_bulk</a></li></ul></li><li><a href="/pages/54eba9074ad827ab/" class="sidebar-link">查询进阶</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>php elasticsearch 教程</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/81cfc23a32727af6/" class="sidebar-link">在 Laravel 中使用 Elasticsearch</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>golang elasticsearch入门教程</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/414e0735cd7e99fc/" class="sidebar-link">Go无法连接docker中es</a></li><li><a href="/pages/73d7a0a011293e62/" class="sidebar-link">go-elastic快速入门</a></li><li><a href="/pages/1969d6083be65573/" class="sidebar-link">go-elastic连接配置</a></li><li><a href="/pages/c14cdb968aa72141/" class="sidebar-link">go-elastic文档操作</a></li><li><a href="/pages/ee40412e4274846f/" class="sidebar-link">go-elastic查询语法</a></li></ul></section></li></ul> </aside> <div><main class="page"> <div class="theme-vdoing-wrapper"><div class="articleInfo-wrap" data-v-17b32fa0><div class="articleInfo" data-v-17b32fa0><ul class="breadcrumbs" data-v-17b32fa0><li data-v-17b32fa0><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-17b32fa0></a></li> <li data-v-17b32fa0><a href="/elasticsearch" title="Elasticsearch-目录页" data-v-17b32fa0>Elasticsearch</a></li> <li data-v-17b32fa0><span data-v-17b32fa0>elasticsearch教程</span></li></ul> <div class="info" data-v-17b32fa0><div class="author iconfont icon-touxiang" data-v-17b32fa0><a href="javascript:;" title="作者" data-v-17b32fa0>wu是小任</a></div> <div class="date iconfont icon-riqi" data-v-17b32fa0><a href="javascript:;" title="创建时间" data-v-17b32fa0>2021-02-20</a></div></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-padding"><div class="right-menu-content"></div></div></div> <div class="theme-vdoing-content content__default"><blockquote><p>es中的查询请求有两种方式，一种是简易版的查询，另外一种是使用JSON完整的请求体，叫做结构化查询（<code>DSL</code>）。
由于DSL查询更为直观也更为简易，所以大都使用这种方式。
DSL查询是POST过去一个json，由于post的请求是json格式的，所以存在很多灵活性，也有很多形式。
这里有一个地方注意的是官方文档里面给的例子的json结构只是一部分，并不是可以直接黏贴复制进去使用的。一般要在外面加个<code>query</code>为<code>key</code>的结构</p></blockquote> <h2 id="查询表达式dsl"><a href="#查询表达式dsl" class="header-anchor">#</a> 查询表达式DSL</h2> <blockquote><p>使用查询领域特定语言(Query Domain Specific Language) 简称为DSL, 需要使用JSON作为主体，请求体查询</p></blockquote> <ul><li>query
<ul><li><code>match</code>：模糊匹配，类似于SQL中的like，示例<code>{ &quot;match” : { &quot;field&quot; : &quot;keyword&quot; }}</code>,</li> <li><code>match_all</code>：简单的匹配所有文档 {&quot;match_all&quot;: {}}</li> <li><code>match_phrase</code>: 对于短语或者段落进行精确匹配</li> <li><code>match_phrase_prefix</code></li> <li><code>multi_match</code>: 在多个字段上反复执行相同查询</li> <li><code>bool</code> 用于表示复合语句，用于组合多个查询语句；将多查询组合成单一查询
<ul><li><code>must</code> <em>必须匹配</em>这些条件才能被包含进来，表示并且的关系</li> <li><code>must_not</code> <em>必须不</em> 匹配这些条件才能被包含进来</li> <li><code>should</code> <em>如果满足这些语句中的任意语句</em>，将增加 <code>_score</code> ，否则无任何影响。它们主要用于修正每个文档的相关性得分。</li> <li><code>minimum_should_match</code>：<em>控制需要匹配的 <code>should</code> 语句的数量</em>， 它既可以是一个绝对的数字，又可以是个百分比, 如 <code>minimum_should_match: 2</code> 或者 <code>&quot;minimum_should_match&quot;: &quot;75%&quot;</code></li> <li><code>filter</code> <em>必须匹配</em>，但它以不评分、过滤模式来进行。这些语句对评分没有贡献，只是根据过滤标准来排除或包含文档, filter只是简单的数据过滤，并不影响评分，因<code>filter不计算评分</code>，所以性能更好，请尽可能多的使用过滤式查询
<ul><li><code>exists</code> 查找包含某个字段的文档</li></ul></li></ul></li> <li><code>range</code> 范围，可以使用大于<code>gt</code>、大于等于<code>gte</code>、小于<code>lt</code>、小于等于<code>lte</code>作为查询条件，可用于数字、日期类型、字符串</li> <li><code>term</code> 精确查询，对数值，日期，布尔，<code>not_analyzed</code>确切值字符串</li> <li><code>terms</code> 指定多个匹配值，如果字段包含其中的任何一个，都会返回文档，<code>类似于SQL中的IN</code> 操作</li> <li><code>constant_score</code>: 恒定分数，它将一个不变的常量评分应用于所有匹配的文档</li> <li><code>wildcard</code>: 通配符， ? 匹配任意字符， * 匹配 0 或多个字符</li> <li><code>fuzzy</code>: 模糊查询</li> <li><code>dis_max</code>：分离 最大化查询（<code>Disjunction Max Query</code>）</li> <li><code>nested</code> : 用于操作嵌套类型</li></ul></li> <li><code>highlight</code> 高亮，匹配的结果会被 HTML字符包裹住,需要指定匹配的字段</li> <li><code>aggs</code> 聚合操作，类似SQL中的<code>Group By</code></li> <li><code>sort</code> 排序</li> <li><code>from</code> 偏移量，类似于SQL中limit中的<code>offset</code></li> <li><code>size</code> 返回数量，类似于SQL中limit中的<code>count</code>，可以通过from，size来达到分页的效果</li></ul> <blockquote><p>使用DSL查询肯能条件很多，比较复杂，可以通过使用验证API来检查一个查询是否有效</p></blockquote> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>GET /<span class="token punctuation">{</span>index<span class="token punctuation">}</span>/<span class="token punctuation">{</span>type<span class="token punctuation">}</span>/_validate/query?explain 
<span class="token punctuation">{</span>  
   <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>  
      <span class="token punctuation">..</span>. 
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="match-匹配查询"><a href="#match-匹配查询" class="header-anchor">#</a> match 匹配查询</h2> <p>全文检索方式查询，类似于关系型数据库中的<code>like</code>操作，使用match时需要指定对那个字段进行全文检索，以及对应的关键字, 关键字可以指定一个也可以指定多个，指定多个时表示或者的关系 类似于SQL中的or的功能。
语法:</p> <ul><li>{ &quot;match&quot; : { &quot;field&quot; : &quot;keyword&quot; }} 类似于SQL中的<code>where filed like ‘%keyword%’</code></li> <li>{ &quot;match&quot; : { &quot;field&quot; : &quot;keyword1 keyword2&quot; }} 类似于SQL中的<code>where field like ‘%keyword1%’ or field like ‘%keyword2%’</code></li></ul> <h3 id="最简单的一个match例子"><a href="#最简单的一个match例子" class="header-anchor">#</a> 最简单的一个match例子：</h3> <p>查询和<code>我的宝马多少马力</code>这个查询语句匹配的文档。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;description&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;我的宝马多少马力&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;match_phrase&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;description&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;query&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;我的宝马多少马力&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>上面的查询匹配就会进行分词，比如&quot;宝马多少马力&quot;会被分词为&quot;宝马 多少 马力&quot;, 所有有关&quot;宝马 多少 马力&quot;, 那么所有包含这三个词中的一个或多个的文档就会被搜索出来。
并且根据lucene的评分机制(TF/IDF)来进行评分。</p> <p><img src="https://raw.githubusercontent.com/renzhifan/image/master/img/20210219165110.png" alt=""></p> <h3 id="查询name中包含-女装-的文档"><a href="#查询name中包含-女装-的文档" class="header-anchor">#</a> 查询name中包含“女装”的文档</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>GET /shop/_search 
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;女装&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment"># 多词查询 ：使用空格隔离多个单词</span>
<span class="token comment"># 查询name中包含“外套” 或者or 包含 “休闲” 的文档，多个关键字使用空格分隔，如果不指定operator默认是or</span>
GET /shop/_search 
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;外套 休闲&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment"># &quot;name&quot;: &quot;外套 休闲&quot; or 等价于bool中的should</span>
GET /shop/_search 
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;bool&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;should&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;外套&quot;</span> <span class="token punctuation">}</span>,
        <span class="token string">&quot;match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;休闲&quot;</span> <span class="token punctuation">}</span>,
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment"># 查询name中包含“外套” 并且 包含 “休闲” 的文档，多个关键字使用空格分隔</span>
GET /shop/_search 
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;外套 休闲&quot;</span>,
      <span class="token string">&quot;operator&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;and&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment"># &quot;name&quot;: &quot;外套 休闲&quot; and 等价于bool中的must</span>
GET /shop/_search 
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;bool&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;must&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;外套&quot;</span> <span class="token punctuation">}</span>,
        <span class="token string">&quot;match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;休闲&quot;</span> <span class="token punctuation">}</span>,
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment"># 多词查询中使用or只需要满足一个即可，要求太低，使用and又必须所有词项都必须满足，要求又太高，</span>
<span class="token comment"># 使用minimum_should_match折中一下，最小匹配：可以指定一个百分比，</span>
<span class="token comment"># 例如指定4个词项，一个是词项是25%，设置成50%就是至少要满足2个词项</span>
GET /shop/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;春季 长袖 圆领 学生&quot;</span>,
        <span class="token string">&quot;minimum_should_match&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;50%&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment"># 效果和上面一样，等价的</span>
GET /shop/_search
<span class="token punctuation">{</span>
   <span class="token string">&quot;query&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;bool&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;filter&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;bool&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
              <span class="token string">&quot;should&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
                 <span class="token punctuation">{</span> <span class="token string">&quot;term&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;春季&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>, 
                 <span class="token punctuation">{</span> <span class="token string">&quot;term&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;长袖&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>, 
                 <span class="token punctuation">{</span> <span class="token string">&quot;term&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;圆领&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>, 
                 <span class="token punctuation">{</span> <span class="token string">&quot;term&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;学生&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
              <span class="token punctuation">]</span>,
              <span class="token string">&quot;minimum_should_match&quot;</span><span class="token builtin class-name">:</span> <span class="token number">2</span>
           <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment"># 查询日期</span>
GET /shop/_search 
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;create_date&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;2018-01-31&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br></div></div><blockquote><p>match一般用于用引号括起来的值，如<code>文本</code>，<code>日期</code>，如果<em>将match用于布尔或者数字等数据类型就变成精确匹配了</em>，而不是全文检索或者模糊匹配了
如果在一个精确值的字段上使用match，例如数字、日期、布尔或者一个 not_analyzed 字符串字段，那么它将会精确匹配给定的值：</p></blockquote> <h2 id="match-all-简单的匹配所有文档"><a href="#match-all-简单的匹配所有文档" class="header-anchor">#</a> match_all 简单的匹配所有文档</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>GET /shop/_search 
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;match_all&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment"># 上面简写成这样，效果是一样的 </span>
GET /shop/_search 
<span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment"># 同样也可以去掉{},更加简洁</span>
GET /shop/_search 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="match-phrase"><a href="#match-phrase" class="header-anchor">#</a> match_phrase</h2> <blockquote><p>对于短语或者段落进行精确匹配</p></blockquote> <p>比如上面一个例子，一个文档&quot;我的保时捷马力不错&quot;也会被搜索出来，那么想要<code>精确匹配所有同时包含&quot;宝马 多少 马力&quot;的文档</code>怎么做？就要使用 <code>match_phrase</code> 了</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;match_phrase&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;description&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;我的宝马多少马力&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;match_phrase&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;description&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;query&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;我的宝马多少马力&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>从下图能看出来  <code>我的宝马多少马力呀</code> 也被搜索出来了 这是因为<code>match_phrase</code> 精确匹配所有同时包含&quot;宝马 多少 马力&quot;的文档
<img src="https://raw.githubusercontent.com/renzhifan/image/master/img/20210219170018.png" alt=""></p> <p>反过来匹配 <code>我的宝马多少马力呀</code> 就不一样了</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;match_phrase&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;description&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;我的宝马多少马力呀&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><img src="https://raw.githubusercontent.com/renzhifan/image/master/img/20210219170230.png" alt=""></p> <p>完全匹配可能比较严，我们会希望有个可调节因子，少匹配一个也满足，那就需要使用到slop。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;match_phrase&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;description&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;query&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;我的宝马多少马力&quot;</span>,
            <span class="token string">&quot;slop&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="match-phrase-prefix"><a href="#match-phrase-prefix" class="header-anchor">#</a> match_phrase_prefix</h2> <p>match_phrase_prefix与match_phrase是一样的，只是它允许在文本的最后一项中使用前缀匹配。</p> <p>可以用于即时搜索（instant search） 或 输入即搜索（search-as-you-type），例如，如果用户输入 johnnie walker bl ，我们希望在它们完成输入搜索条件前就能得到：Johnnie Walker Black Label 和 Johnnie Walker Blue Label 。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>GET /shop/goods/_search 
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;match_phrase_prefix&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;女装冬季外套&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment"># slop:让相对词序位置不那么严格</span>
<span class="token comment"># 注意上面使用的是“女装冬季外套”，而现在使用的是“套女装冬季”， slop:允许每个词放宽的间隔</span>
<span class="token comment">#尽管词语的顺序不正确，查询仍然能匹配，因为我们为它设置了足够高的slop值使匹配时的词序有更大的灵活性。</span>
GET /shop/goods/_search 
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;match_phrase_prefix&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;外套女装冬季&quot;</span>,
            <span class="token string">&quot;slop&quot;</span><span class="token builtin class-name">:</span>  <span class="token number">10</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><blockquote><p>prefix 查询存在严重的资源消耗问题，短语查询的这种方式也同样如此。前缀 a 可能会匹配成千上万的词，这不仅会消耗很多系统资源，而且结果的用处也不大。</p></blockquote> <h2 id="索引时输入即搜索"><a href="#索引时输入即搜索" class="header-anchor">#</a> 索引时输入即搜索</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">## edge_ngram 自定义过滤器、分词器</span>
PUT /my_index
<span class="token punctuation">{</span>
    <span class="token string">&quot;settings&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;number_of_shards&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1</span>, 
        <span class="token string">&quot;analysis&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;filter&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;autocomplete_filter&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> 
                    <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span>     <span class="token string">&quot;edge_ngram&quot;</span>,
                    <span class="token string">&quot;min_gram&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,
                    <span class="token string">&quot;max_gram&quot;</span><span class="token builtin class-name">:</span> <span class="token number">20</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>,
            <span class="token string">&quot;analyzer&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;autocomplete&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                    <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span>      <span class="token string">&quot;custom&quot;</span>,
                    <span class="token string">&quot;tokenizer&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;standard&quot;</span>,
                    <span class="token string">&quot;filter&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
                        <span class="token string">&quot;lowercase&quot;</span>,
                        <span class="token string">&quot;autocomplete_filter&quot;</span> 
                    <span class="token punctuation">]</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">## 测试分词</span>
GET /my_index/_analyze
<span class="token punctuation">{</span>
  <span class="token string">&quot;analyzer&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;autocomplete&quot;</span>,
  <span class="token string">&quot;text&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;quick brown&quot;</span>
<span class="token punctuation">}</span>

PUT /my_index/_mapping/my_type
<span class="token punctuation">{</span>
    <span class="token string">&quot;my_type&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;properties&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span>     <span class="token string">&quot;text&quot;</span>,
                <span class="token string">&quot;analyzer&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;autocomplete&quot;</span>,  <span class="token comment">## 使用自定义的分词器</span>
                <span class="token string">&quot;search_analyzer&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;standard&quot;</span> <span class="token comment">## 配置查询对应的分词器</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

POST /my_index/_bulk
<span class="token punctuation">{</span> <span class="token string">&quot;index&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1</span>            <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Brown foxes&quot;</span>    <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;index&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span> <span class="token number">2</span>            <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Yellow furballs&quot;</span> <span class="token punctuation">}</span>

<span class="token comment">## 搜索</span>
GET /my_index/_search
<span class="token punctuation">{</span>
    <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span>    <span class="token string">&quot;brown fo&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br></div></div><h2 id="multi-match"><a href="#multi-match" class="header-anchor">#</a> multi_match</h2> <blockquote><p>多个字段上使用相同的值作为查询条件</p></blockquote> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>GET /shop/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;multi_match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token number">268</span>,
      <span class="token string">&quot;fields&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;price&quot;</span>, <span class="token string">&quot;quantity&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment"># 两者效果相同</span>
GET /shop/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;bool&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;should&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> <span class="token string">&quot;term&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;price&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;value&quot;</span><span class="token builtin class-name">:</span> <span class="token number">268</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>,
        <span class="token punctuation">{</span> <span class="token string">&quot;term&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;quantity&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;value&quot;</span><span class="token builtin class-name">:</span> <span class="token number">268</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment"># 查询字段名称的模糊匹配</span>
<span class="token comment"># 字段名称可以用模糊匹配的方式给出：任何与模糊模式正则匹配的字段都会被包括在搜索条件中，</span>
<span class="token comment"># 例如可以使用以下方式同时匹配 book_title 、 chapter_title 和 section_title （书名、章名、节名）这三个字段：</span>

<span class="token punctuation">{</span>
    <span class="token string">&quot;multi_match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span>  <span class="token string">&quot;Quick brown fox&quot;</span>,
        <span class="token string">&quot;fields&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;*_title&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment"># 提升单个字段的权重</span>
<span class="token comment"># 可以使用 ^ 字符语法为单个字段提升权重，在字段名称的末尾添加 ^boost ，其中 boost 是一个浮点数：</span>
<span class="token comment"># chapter_title 这个字段的 boost 值为 2 ，而*_title 字段的默认 boost 值为 1</span>
<span class="token punctuation">{</span>
    <span class="token string">&quot;multi_match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span>  <span class="token string">&quot;Quick brown fox&quot;</span>,
        <span class="token string">&quot;fields&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;*_title&quot;</span>, <span class="token string">&quot;chapter_title^2&quot;</span> <span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><h3 id="best-fields"><a href="#best-fields" class="header-anchor">#</a> best_fields</h3> <p>我们希望完全匹配的文档占的评分比较高，则需要使用best_fields</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;multi_match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;宝马马力&quot;</span>,
      <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;best_fields&quot;</span>,
      <span class="token string">&quot;fields&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;title&quot;</span>,
        <span class="token string">&quot;description&quot;</span>
      <span class="token punctuation">]</span>,
      <span class="token string">&quot;tie_breaker&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0.3</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>意思就是完全匹配&quot;<code>宝马</code> <code>马力</code>&quot;的文档评分会比较靠前，如果只匹配宝马的文档评分乘以0.3的系数
<img src="https://raw.githubusercontent.com/renzhifan/image/master/img/20210219171044.png" alt=""></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;multi_match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;保时捷马力&quot;</span>,
      <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;best_fields&quot;</span>,
      <span class="token string">&quot;fields&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;title&quot;</span>,
        <span class="token string">&quot;description&quot;</span>
      <span class="token punctuation">]</span>,
      <span class="token string">&quot;tie_breaker&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0.3</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>意思就是完全匹配&quot;<code>保时捷</code> <code>马力</code>&quot;的文档评分会比较靠前，如果只匹配宝马的文档评分乘以0.3的系数</p> <p><img src="https://raw.githubusercontent.com/renzhifan/image/master/img/20210219171129.png" alt=""></p> <h3 id="most-fields"><a href="#most-fields" class="header-anchor">#</a> most_fields</h3> <p>我们希望完全匹配的文档占的评分比较高，则需要使用best_fields</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;multi_match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;我的宝马发动机多少呀&quot;</span>,
      <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;most_fields&quot;</span>,
      <span class="token string">&quot;fields&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;title&quot;</span>,
        <span class="token string">&quot;description&quot;</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><img src="https://raw.githubusercontent.com/renzhifan/image/master/img/20210219171511.png" alt=""></p> <h3 id="cross-fields"><a href="#cross-fields" class="header-anchor">#</a> cross_fields</h3> <p>我们会希望这个词条的分词词汇是分配到不同字段中的，那么就使用cross_fields</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;multi_match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;我的宝马发动机多少&quot;</span>,
      <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;cross_fields&quot;</span>,
      <span class="token string">&quot;fields&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;title&quot;</span>,
        <span class="token string">&quot;description&quot;</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><img src="https://raw.githubusercontent.com/renzhifan/image/master/img/20210219172103.png" alt=""></p> <h2 id="constant-score-常量分数"><a href="#constant-score-常量分数" class="header-anchor">#</a> constant_score 常量分数</h2> <p>通常当查找一个精确值的时候，我们不希望对查询进行评分计算。只希望对文档进行包括或排除的计算，所以我们会使用 <code>constant_score</code> 查询以非评分模式来执行 term 查询并以一作为统一评分。</p> <p>它将一个不变的常量评分应用于所有匹配的文档。<code>它被经常用于你只需要执行一个 filter 而没有其它查询（例如，评分查询）的情况下</code>。可以使用它来<em>取代只有 filter 语句的 bool 查询</em>。在性能上是完全相同的，但对于提高查询简洁性和清晰度有很大帮助. 这种方式可以用来取代只有 filter 语句的 bool 查询</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>
GET /shop/_search 
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;constant_score&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;filter&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;term&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;price&quot;</span><span class="token builtin class-name">:</span> <span class="token number">268.00</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><blockquote><p>查询置于 filter 语句内不进行评分或相关度的计算，所以所有的结果都会返回一个默认评分 1</p></blockquote> <h2 id="prefix-前缀查询"><a href="#prefix-前缀查询" class="header-anchor">#</a> prefix 前缀查询</h2> <p>前缀查询：<em><code>要查询的字段必须没有分词</code></em></p> <p>默认状态下， prefix 查询不做相关度评分计算，它只是将所有匹配的文档返回，并为每条结果赋予评分值 1 。它的行为更像是过滤器而不是查询。 prefix 查询和 prefix 过滤器这两者实际的区别就是过滤器是可以被缓存的，而查询不行</p> <p>prefix 查询或过滤对于一些特定的匹配是有效的，但使用方式还是应当注意。当字段中词的集合很小时，可以放心使用，但是它的伸缩性并不好，会对我们的集群带来很多压力。可以使用较长的前缀来限制这种影响，减少需要访问的量。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>PUT /my_index
<span class="token punctuation">{</span>
    <span class="token string">&quot;mappings&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;properties&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;postcode&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                    <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span>  <span class="token string">&quot;keyword&quot;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

PUT /my_index/1
<span class="token punctuation">{</span> <span class="token string">&quot;postcode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;W1V 3DG&quot;</span> <span class="token punctuation">}</span>

PUT /my_index/2
<span class="token punctuation">{</span> <span class="token string">&quot;postcode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;W2F 8HW&quot;</span> <span class="token punctuation">}</span>

PUT /my_index/3
<span class="token punctuation">{</span> <span class="token string">&quot;postcode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;W1F 7HW&quot;</span> <span class="token punctuation">}</span>

PUT /my_index/4
<span class="token punctuation">{</span> <span class="token string">&quot;postcode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;WC1N 1LZ&quot;</span> <span class="token punctuation">}</span>

PUT /my_index/5
<span class="token punctuation">{</span> <span class="token string">&quot;postcode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;SW5 0BE&quot;</span> <span class="token punctuation">}</span>

<span class="token comment"># prefix 查询</span>
GET /my_index/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;prefix&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;postcode&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;value&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;W1&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><h2 id="wildcard-和-regexp"><a href="#wildcard-和-regexp" class="header-anchor">#</a> wildcard 和 regexp</h2> <blockquote><p>不分词，然后用wildcard查询</p></blockquote> <hr> <p>与 prefix 前缀查询的特性类似， wildcard 通配符查询也<code>是一种底层基于词</code>的查询，与前缀查询不同的是它允许指定匹配的正则式。它使用标准的 <code>shell</code> 通配符查询： ? 匹配任意字符， * 匹配 0 或多个字符。</p> <p>wildcard 和 regexp 查询的工作方式与 prefix 查询完全一样，它们也需要扫描倒排索引中的词列表才能找到所有匹配的词，然后依次获取每个词相关的文档 ID ，与 prefix 查询的唯一不同是：它们能支持更为复杂的匹配模式。</p> <p>这也意味着需要同样注意前缀查询存在性能问题，对有很多唯一词的字段执行这些查询可能会消耗非常多的资源，所以要避免使用左通配这样的模式匹配（如： *foo 或 .*foo 这样的正则式）。</p> <p>数据在索引时的预处理有助于提高前缀匹配的效率，而通配符和正则表达式查询只能在查询时完成，尽管这些查询有其应用场景，但使用仍需谨慎。</p> <p>prefix 、 wildcard 和 regexp 查询是基于词操作的，如果用它们来查询 analyzed 字段，它们会检查字段里面的每个词，而不是将字段作为整体来处理</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>GET /my_index/_search
<span class="token punctuation">{</span>
    <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;wildcard&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;postcode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;W?F*HW&quot;</span> 
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment"># 词必须以 W 开头，紧跟 0 至 9 之间的任何一个数字，然后接一或多个其他字符</span>
GET /my_index/_search
<span class="token punctuation">{</span>
    <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;regexp&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;postcode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;W[0-9].+&quot;</span> 
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>GET u885928110_pro_accounts/_search?pretty
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;bool&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;should&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token string">&quot;wildcard&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;phone_number&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;*王6*&quot;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>,
        <span class="token punctuation">{</span>
          <span class="token string">&quot;match_phrase&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;nickname&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;*王小*&quot;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>,
        <span class="token punctuation">{</span>
          <span class="token string">&quot;wildcard&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;nickname&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;*王小*&quot;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>,
      <span class="token string">&quot;minimum_should_match&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>,
  <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1000</span>,
  <span class="token string">&quot;from&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h2 id="range"><a href="#range" class="header-anchor">#</a> range</h2> <p>用于查询一个区间，一般用于日期和数值，支持 gt、gte、lt、lte， 示例{“range”: { “age”: { “gte”: 20, “lt”:30 }}} 类似于SQL中的 wher age &gt;= 20 and age &lt; 30</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>GET /shop/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;range&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;price&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;gt&quot;</span><span class="token builtin class-name">:</span> <span class="token number">200</span>,
        <span class="token string">&quot;lte&quot;</span><span class="token builtin class-name">:</span> <span class="token number">500</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment"># 日期类型</span>
GET /shop/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;range&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;create_date&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;gt&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;2014-01-01 00:00:00&quot;</span>,
        <span class="token string">&quot;lt&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;2014-01-07 00:00:00&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment"># 日期计算：过去一小时</span>
GET /shop/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;range&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;create_date&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;gt&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;now-1h&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">#日期计算：早于 2014 年 1 月 1 日加 1 月（2014 年 2 月 1 日 零时）</span>
GET /shop/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;range&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;create_date&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;gt&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;2014-01-01 00:00:00&quot;</span>,
        <span class="token string">&quot;lt&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;2014-01-01 00:00:00||+1M&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment"># 作用于字符串，性能相对较慢</span>
<span class="token string">&quot;range&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;title&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;gte&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;a&quot;</span>,
        <span class="token string">&quot;lt&quot;</span> <span class="token builtin class-name">:</span>  <span class="token string">&quot;b&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><h2 id="term"><a href="#term" class="header-anchor">#</a> term</h2> <p>term是代表完全匹配，即不进行分词器分析，文档中必须包含整个搜索的词汇</p> <p>精确查询:用于精确值匹配，对数值，日期，布尔，not_analyzed确切值字符串, term 查询对于输入的文本不分析 ，所以它将给定的值进行精确查询</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;term&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;description&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;宝马&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>查出的所有文档都包含<code>宝马</code>这个词组的词汇。</p> <p><img src="https://raw.githubusercontent.com/renzhifan/image/master/img/20210219172338.png" alt=""></p> <p>使用term要确定的是这个字段是否&quot;被分析”(analyzed)，默认的字符串是被分析的
拿官网上的例子举例：
mapping是这样的：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>PUT my_index
<span class="token punctuation">{</span>
  <span class="token string">&quot;mappings&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;properties&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;full_text&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span>  <span class="token string">&quot;string&quot;</span>
        <span class="token punctuation">}</span>,
        <span class="token string">&quot;exact_value&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span>  <span class="token string">&quot;string&quot;</span>,
          <span class="token string">&quot;index&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;not_analyzed&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

PUT my_index/1
<span class="token punctuation">{</span>
  <span class="token string">&quot;full_text&quot;</span><span class="token builtin class-name">:</span>   <span class="token string">&quot;Quick Foxes!&quot;</span>,
  <span class="token string">&quot;exact_value&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Quick Foxes!&quot;</span>  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>其中的full_text是被分析过的，所以full_text的索引中存的就是[quick, foxes]，而extra_value中存的是[Quick Foxes!]。</p> <p>那下面的几个请求：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>GET my_index/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;term&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;exact_value&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Quick Foxes!&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>请求的出数据，因为完全匹配</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>GET my_index/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;term&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;full_text&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Quick Foxes!&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>请求不出数据的，因为full_text分词后的结果中没有[Quick Foxes!]这个分词。</p> <h2 id="terms"><a href="#terms" class="header-anchor">#</a> terms</h2> <p>同term查询，但是它允许指定多个匹配值，一般用于数组，如果字段包含其中的任何一个，都会返回文档， 类似于<code>where tag IN (‘value1’, ‘value2’, ‘value3’)</code> 例如：<code>{ “terms”: { “tag”: [ “search”, “full_text”, “nosql” ] }}</code></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>GET /shop/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;terms&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;colors&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;白蓝红&quot;</span>,
        <span class="token string">&quot;绿色&quot;</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="exists"><a href="#exists" class="header-anchor">#</a> exists</h2> <p>对于相同类型的文档，可能有的文档有某个字段，有的文档没有某个字段，查找包含或者不包含某个字段的文档， 例如： <code>{“exists”: { “field”: “title” }}</code> ，exists 用于查找那些指定字段中是否有值 ， 相当于SQL中的<code>IS NOT NULL</code></p> <p>null, [] （空数组）和 [null] 所有这些都是等价的，它们无法存于倒排索引中</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 存在某个字段</span>
GET /shop/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;bool&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;filter&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;exists&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;field&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;activity&quot;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment"># 不存在某个字段</span>
GET /shop/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;bool&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;must_not&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;exists&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;field&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;activity&quot;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

POST /my_index/_bulk
<span class="token punctuation">{</span> <span class="token string">&quot;index&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;1&quot;</span>              <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;tags&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;search&quot;</span><span class="token punctuation">]</span>                <span class="token punctuation">}</span>  
<span class="token punctuation">{</span> <span class="token string">&quot;index&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;2&quot;</span>              <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;tags&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;search&quot;</span>, <span class="token string">&quot;open_source&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>  
<span class="token punctuation">{</span> <span class="token string">&quot;index&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;3&quot;</span>              <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;other_field&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;some data&quot;</span>        <span class="token punctuation">}</span>  
<span class="token punctuation">{</span> <span class="token string">&quot;index&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;4&quot;</span>              <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;tags&quot;</span> <span class="token builtin class-name">:</span> null                      <span class="token punctuation">}</span>  
<span class="token punctuation">{</span> <span class="token string">&quot;index&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;5&quot;</span>              <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;tags&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;search&quot;</span>, null<span class="token punctuation">]</span>          <span class="token punctuation">}</span>

<span class="token comment">#以上文档集合中 tags 字段对应的倒排索引如下：</span>
<span class="token comment">#Token DocIDs</span>
<span class="token comment">#open_source 2</span>
<span class="token comment">#search 1,2,5</span>

<span class="token comment">#1. tags 字段有 1 个值。</span>
<span class="token comment">#2. tags 字段有 2 个值。</span>
<span class="token comment">#3. tags 字段缺失。</span>
<span class="token comment">#4. tags 字段被置为 null 。</span>
<span class="token comment">#5. tags 字段有 1 个值和 1 个 null 。</span>



<span class="token comment"># 1,2,5 满足条件</span>
GET /my_index/_search
<span class="token punctuation">{</span>
    <span class="token string">&quot;query&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;constant_score&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;filter&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;exists&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;field&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;tags&quot;</span> <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br></div></div><h2 id="highlight-高亮"><a href="#highlight-高亮" class="header-anchor">#</a> highlight：高亮</h2> <blockquote><p>匹配的结果会被 HTML字符包裹住,需要指定匹配的字段，<code>”highlight”: {“fields” : {“about” : {}}}</code></p></blockquote> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 高亮： 匹配的结果会被 &lt;em&gt;&lt;/em&gt; HTML字符包裹住：</span>
GET /class/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;match_phrase&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;张&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>,
  <span class="token string">&quot;highlight&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;pre_tags&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&lt;font color='red'&gt;&quot;</span><span class="token punctuation">]</span>,
        <span class="token string">&quot;post_tags&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&lt;/font&gt;&quot;</span><span class="token punctuation">]</span>,
        <span class="token string">&quot;fields&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;name&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>返回数据如下</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;took&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">186</span>,
  <span class="token string">&quot;timed_out&quot;</span> <span class="token builtin class-name">:</span> false,
  <span class="token string">&quot;_shards&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;total&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,
    <span class="token string">&quot;successful&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,
    <span class="token string">&quot;skipped&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,
    <span class="token string">&quot;failed&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>,
  <span class="token string">&quot;hits&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;total&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;value&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,
      <span class="token string">&quot;relation&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;eq&quot;</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;max_score&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0.6931471</span>,
    <span class="token string">&quot;hits&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">&quot;_index&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;class_v2&quot;</span>,
        <span class="token string">&quot;_type&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;_doc&quot;</span>,
        <span class="token string">&quot;_id&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;1&quot;</span>,
        <span class="token string">&quot;_score&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0.6931471</span>,
        <span class="token string">&quot;_source&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;name&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;张三2&quot;</span>,
          <span class="token string">&quot;age&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">27</span>
        <span class="token punctuation">}</span>,
        <span class="token string">&quot;highlight&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;name&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
            <span class="token string">&quot;&lt;font color='red'&gt;张&lt;/font&gt;三2&quot;</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h2 id="sort"><a href="#sort" class="header-anchor">#</a> sort</h2> <blockquote><p>排序，可以指定一个或者多个字段排序,多个字段使用数组包围，例如：<code>”sort”: { “date”: { “order”: “desc” }}</code></p></blockquote> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 排序,默认情况下是按照相关性评分排序的，最相关的文档排在最前， 默认按_score排序的</span>
<span class="token comment"># 多级排序，使用date, _score排序</span>
GET /_search  
<span class="token punctuation">{</span>  
    <span class="token string">&quot;query&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>  
        <span class="token string">&quot;bool&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>  
            <span class="token string">&quot;must&quot;</span><span class="token builtin class-name">:</span>   <span class="token punctuation">{</span> <span class="token string">&quot;match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;tweet&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;manage text search&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>,  
            <span class="token string">&quot;filter&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;term&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;user_id&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>  
        <span class="token punctuation">}</span>  
    <span class="token punctuation">}</span>,  
    <span class="token string">&quot;sort&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>  
        <span class="token punctuation">{</span> <span class="token string">&quot;date&quot;</span><span class="token builtin class-name">:</span>   <span class="token punctuation">{</span> <span class="token string">&quot;order&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;desc&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>,  
        <span class="token punctuation">{</span> <span class="token string">&quot;_score&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;order&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;desc&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>,
        <span class="token punctuation">{</span> <span class="token string">&quot;ids&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;order&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;asc&quot;</span>, <span class="token string">&quot;mode&quot;</span><span class="token builtin class-name">:</span>  <span class="token string">&quot;min&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>  
    <span class="token punctuation">]</span>  
<span class="token punctuation">}</span>  
<span class="token comment"># mode:一般用于数组，可以使用min 、 max 、 avg 或是 sum，统计计算数组的指定值排序</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>对字符串排序，<code>sort</code>对字符串排序需要使用到原始值<code>raw</code>，正常情况下文本可能会使用分词器进行分词，
而分词器会影响正常的排序，这时可以对同一个字段设置两种类型，对文本设置成text类型，并设置分词器，如果要搜索的话使用text类型字段，
然后再为该字段设置一个原始值，该原始值raw字段的fields的数据类型设置为keyword，关键字数据类型是不分词的，
不分词的字段可以作为字符串的排序</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># fields 多字段：相当于对同一个字段值起不同的名字，赋予这个字段不同的属性(如类型不同，分词器不同等)</span>
PUT /school
<span class="token punctuation">{</span>
  <span class="token string">&quot;mappings&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;properties&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;text&quot;</span>,
          <span class="token string">&quot;analyzer&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;ik_max_word&quot;</span>,
          <span class="token string">&quot;fields&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;raw&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
              <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;keyword&quot;</span>
            <span class="token punctuation">}</span>  
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment"># _score 和 max_score 字段都是 null 。计算 _score 的花销巨大，通常仅用于排序； 我们并不根据相关性排序，所以记录 _score 是没有意义的。如果无论如何你都要计算 _score ， 你可以将 track_scores 参数设置为 true</span>
GET /school/_search 
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;abc&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>, 
  <span class="token string">&quot;sort&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token punctuation">{</span> <span class="token string">&quot;name.raw&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;order&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;desc&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token comment">#  强制计算评分</span>
GET /school/_search 
<span class="token punctuation">{</span>
  <span class="token string">&quot;track_scores&quot;</span><span class="token builtin class-name">:</span> true,
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;abc&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>, 
  <span class="token string">&quot;sort&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token punctuation">{</span> <span class="token string">&quot;name.raw&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;order&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;desc&quot;</span><span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h2 id="from"><a href="#from" class="header-anchor">#</a> from</h2> <p>偏移量，类似于SQL中limit中的offset</p> <h2 id="size"><a href="#size" class="header-anchor">#</a> size</h2> <p>返回数量，类似于SQL中limit中的count，可以通过from，size来达到分页的效果</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>GET /shop/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;from&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
  <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">20</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="游标查询scroll"><a href="#游标查询scroll" class="header-anchor">#</a> 游标查询Scroll</h2> <p><em>使用from, size做分页不能分页太深，太深对性能营销较大，一般获取前1000条数据就算深了，游标查询用于解决深度分页带来的性能问题。</em></p> <p><code>scroll</code> 查询可以用来对Elasticsearch有效地执行大批量的文档查询，而又不用付出深度分页那种代价。游标查询允许我们 先做查询初始化，然后再批量地拉取结果。 这有点儿像传统数据库中的 cursor 。游标查询会取某个时间点的快照数据，查询初始化之后索引上的任何变化会被它忽略。 它通过保存旧的数据文件来实现这个特性，结果就像保留初始化时的索引 ‘视图’ 一样。</p> <p>深度分页的代价根源是结果集全局排序，如果去掉全局排序的特性的话查询结果的成本就会很低。 游标查询用字段<code>_doc</code>来排序。
这个指令让 Elasticsearch 仅仅从还有结果的分片返回下一批结果。启用游标查询可以通过在查询的时候设置参数 scroll 的值为我们期望的游标查询的过期时间，游标查询的过期时间会在每次做查询的时候刷新，所以这个时间只需要足够处理当前批的结果就可以了，而不是处理查询结果的所有文档的所需时间。
这个过期时间的参数很重要，因为保持这个游标查询窗口需要消耗资源，所以我们期望如果不再需要维护这种资源就该早点儿释放掉。
设置这个超时能够让 Elasticsearch 在稍后空闲的时候自动释放这部分资源。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 保持游标查询窗口一分钟</span>
<span class="token comment"># 关键字 _doc 是最有效的排序顺序。</span>
GET /shop/_search?scroll<span class="token operator">=</span>1m
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&quot;match_all&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span>,
  <span class="token string">&quot;sort&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;_doc&quot;</span><span class="token punctuation">]</span>,
  <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1000</span>
<span class="token punctuation">}</span>

<span class="token comment"># 这个查询的返回结果包括一个字段 _scroll_id， 它是一个base64编码的长字符串 。 现在我们能传递字段 _scroll_id 到 _search/scroll </span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;_scroll_id&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;DnF1ZXJ5VGhlbkZldGNoBQAAAAAAAAMoFmQ0clZDNEg4UWYtYTBzVTg0QWRFdmcAAAAAAAADKRZkNHJWQzRIOFFmLWEwc1U4NEFkRXZnAAAAAAAAAyoWZDRyVkM0SDhRZi1hMHNVODRBZEV2ZwAAAAAAAAMrFmQ0clZDNEg4UWYtYTBzVTg0QWRFdmcAAAAAAAADLBZkNHJWQzRIOFFmLWEwc1U4NEFkRXZn&quot;</span>,
  <span class="token string">&quot;took&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,
  <span class="token string">&quot;timed_out&quot;</span><span class="token builtin class-name">:</span> false,
  <span class="token punctuation">..</span>.
<span class="token punctuation">}</span>

<span class="token comment"># 查询接口获取下一批结果：</span>
GET /_search/scroll
<span class="token punctuation">{</span>
  <span class="token string">&quot;scroll&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;1m&quot;</span>,
  <span class="token string">&quot;scroll_id&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;DnF1ZXJ5VGhlbkZldGNoBQAAAAAAAAKbFmQ0clZDNEg4UWYtYTBzVTg0QWRFdmcAAAAAAAACnBZkNHJWQzRIOFFmLWEwc1U4NEFkRXZnAAAAAAAAAp0WZDRyVkM0SDhRZi1hMHNVODRBZEV2ZwAAAAAAAAKeFmQ0clZDNEg4UWYtYTBzVTg0QWRFdmcAAAAAAAACnxZkNHJWQzRIOFFmLWEwc1U4NEFkRXZn&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h2 id="bool联合查询-must-should-must-not"><a href="#bool联合查询-must-should-must-not" class="header-anchor">#</a> bool联合查询: must,should,must_not</h2> <p>布尔查询，这是一个很重要的查询，它可以将其它多种查询封装成一个大的查询，
可以使用逻辑操作符(<code>类似于sql中的and、not、or</code>)来组装各个条件， 这是个复合过滤器（compound filter） ，
它可以接受多个其他过滤器作为参数，并将这些过滤器结合成各式各样的布尔（逻辑）组合</p> <p>用于表示复合语句，用于组合多个查询语句；将多查询组合成单一查询，bool可以放到query下面，也可以嵌套在某个子条件(must、should、must_not)里, 通过嵌套可以构造出更加复杂的过滤条件。</p> <ul><li><code>must</code>: <code>必须匹配</code>这些条件才能被包含进来。 表示并且的关系，与 SQL中的<code>AND 等价</code>，例如<code>{&quot;must&quot;: [{&quot;match&quot;: {&quot;desc&quot;: &quot;xxx&quot;}}, {&quot;term&quot;: { &quot;quantity&quot;: 999}}]}</code>，类似于SQL中的<code>where desc like '%xxx%' and quantity = 999</code></li> <li><code>must_not</code>: <code>必须不匹配</code>这些条件才能被包含进来, 是对must的取反操作，与SQL中的 <code>!= 或者&lt;&gt; 等价</code>， <code>where status != 0</code></li> <li><code>should</code> <code>至少有一个语句要匹配</code>, 与 SQL中的 <code>OR 等价</code>，是一个数组，可以有多个值，如果满足这些语句中的任意语句，将增加_score的值, should的作用：or逻辑，如果满足条件<code>评分_score更高</code></li> <li><code>filter</code>：<code>必须匹配</code>，以过滤模式来进行。这些语句对评分没有贡献，只是根据过滤标准来排除或包含文档, filter只是简单的数据过滤，<code>并不影响评分</code></li> <li><code>minimum_should_match</code></li></ul> <blockquote><p>bool 查询会为每个文档计算相关度评分 _score ，再将所有匹配的 must 和 should 语句的分数 _score 求和，最后除以 must 和 should 语句的总数。</p></blockquote> <blockquote><p>must_not 语句不会影响评分；它的作用只是将不相关的文档排除。</p></blockquote> <blockquote><p>所有must语句必须匹配，所有must_not语句都必须不匹配，经测试至少有一个should需要匹配的(在should中写两个条件，每天条件都不满足条件，结果没有任何文档满足)，当没有 must 语句的时候，至少有一个 should 语句必须匹配</p></blockquote> <p>如果我们想要请求&quot;description中带宝马，但是title中不带宝马&quot;这样类似的需求，就需要用到bool联合查询。
联合查询就会使用到must,should,must_not三种关键词。</p> <p>这三个可以这么理解</p> <ul><li><code>must</code>: 文档必须完全匹配条件</li> <li><code>should</code>: should下面会带一个以上的条件，至少满足一个条件，这个文档就符合should</li> <li><code>must_not</code>: 文档必须不匹配条件</li></ul> <p>比如上面那个需求：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;bool&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;must&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;term&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;title&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;宝马&quot;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>,
      <span class="token string">&quot;must_not&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;term&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;description&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;宝马&quot;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><img src="https://raw.githubusercontent.com/renzhifan/image/master/img/20210219172814.png" alt=""></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>GET /shop/_search 
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;bool&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;must&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span><span class="token string">&quot;term&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;quantity&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;value&quot;</span><span class="token builtin class-name">:</span> <span class="token number">999</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token punctuation">]</span>, 
      <span class="token string">&quot;must_not&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token string">&quot;term&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;quantity&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
              <span class="token string">&quot;value&quot;</span><span class="token builtin class-name">:</span> <span class="token number">9267</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>,
      <span class="token string">&quot;should&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token string">&quot;term&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;is_discount&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
              <span class="token string">&quot;value&quot;</span><span class="token builtin class-name">:</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>,
      <span class="token string">&quot;filter&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;range&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;price&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;gte&quot;</span><span class="token builtin class-name">:</span> <span class="token number">7777</span>,
            <span class="token string">&quot;lte&quot;</span><span class="token builtin class-name">:</span> <span class="token number">9999</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># filter中也可以嵌套bool查询，这样内部的bool查询就不参与评分了</span>
<span class="token comment"># bool中的must must_not should 等会计算评分的，如果不希望计算评分，可将bool放入到filter中,这样既不计算评分又可以使用bool中的逻辑</span>
<span class="token comment"># 直接使用bool中的filter和将bool再次嵌入到filter中都不计算评分</span>
GET /shop/_search 
<span class="token punctuation">{</span>
    <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;bool&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
              <span class="token string">&quot;must&quot;</span><span class="token builtin class-name">:</span>     <span class="token punctuation">{</span> <span class="token string">&quot;match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;title&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;how to make millions&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>,
              <span class="token string">&quot;must_not&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;tag&quot;</span><span class="token builtin class-name">:</span>   <span class="token string">&quot;spam&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>,
              <span class="token string">&quot;should&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
                  <span class="token punctuation">{</span> <span class="token string">&quot;match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;tag&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;starred&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
              <span class="token punctuation">]</span>,
              <span class="token string">&quot;filter&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;bool&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> 
                    <span class="token string">&quot;must&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
                        <span class="token punctuation">{</span> <span class="token string">&quot;range&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;date&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;gte&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;2014-01-01&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span>,
                        <span class="token punctuation">{</span> <span class="token string">&quot;range&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;price&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;lte&quot;</span><span class="token builtin class-name">:</span> <span class="token number">29.99</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
                    <span class="token punctuation">]</span>,
                    <span class="token string">&quot;must_not&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
                        <span class="token punctuation">{</span> <span class="token string">&quot;term&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;category&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;ebooks&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
                    <span class="token punctuation">]</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment"># 就像我们能控制 match 查询的精度 一样，我们可以通过 minimum_should_match 参数控制需要匹配的</span>
<span class="token comment"># should 语句的数量， 它既可以是一个绝对的数字，又可以是个百分比：</span>
<span class="token comment"># 这个查询结果会将所有满足以下条件的文档返回： </span>
<span class="token comment"># title 字段包含 &quot;brown&quot; AND &quot;fox&quot; 、 &quot;brown&quot; AND &quot;dog&quot; 或 &quot;fox&quot; AND &quot;dog&quot; 。</span>
<span class="token comment"># 如果有文档包含所有三个条件，它会比只包含两个的文档更相关。</span>
GET /my_index/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;bool&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;should&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> <span class="token string">&quot;match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;title&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;brown&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>,
        <span class="token punctuation">{</span> <span class="token string">&quot;match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;title&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;fox&quot;</span>   <span class="token punctuation">}</span><span class="token punctuation">}</span>,
        <span class="token punctuation">{</span> <span class="token string">&quot;match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;title&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;dog&quot;</span>   <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token punctuation">]</span>,
      <span class="token string">&quot;minimum_should_match&quot;</span><span class="token builtin class-name">:</span> <span class="token number">2</span> 
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment"># boost 参数被用来提升一个语句的相对权重（ boost 值大于 1 ）或降低相对权重（ boost 值处于 0 到 1 之间），</span>
<span class="token comment"># 但是这种提升或降低并不是线性的，换句话说，如果一个 boost 值为 2 ，并不能获得两倍的评分 _score 。</span>
<span class="token comment"># 通过指定 boost 来控制任何查询语句的相对的权重， boost 的默认值为 1 ，大于 1 会提升一个语句的相对权重。</span>
<span class="token comment"># 更高的 boost 值为我们带来更高的评分 _score</span>
GET /_search
<span class="token punctuation">{</span>
    <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;bool&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;must&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>  
                    <span class="token string">&quot;content&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                        <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span>    <span class="token string">&quot;full text search&quot;</span>,
                        <span class="token string">&quot;operator&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;and&quot;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>,
            <span class="token string">&quot;should&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span> <span class="token string">&quot;match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                    <span class="token string">&quot;content&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                        <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Elasticsearch&quot;</span>,
                        <span class="token string">&quot;boost&quot;</span><span class="token builtin class-name">:</span> <span class="token number">3</span> 
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">}</span>,
                <span class="token punctuation">{</span> <span class="token string">&quot;match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                    <span class="token string">&quot;content&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                        <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Lucene&quot;</span>,
                        <span class="token string">&quot;boost&quot;</span><span class="token builtin class-name">:</span> <span class="token number">2</span> 
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br></div></div><blockquote><p>过滤查询：不需要评分，性能更好，对结果进行缓存</p></blockquote> <blockquote><p>评分查询：需要评分，评分比较费力，不对结果进行缓存</p></blockquote> <blockquote><p>如何选择查询与过滤? 通常的规则是，使用查询（query）语句来进行 全文搜索或者其它任何需要影响相关性得分的搜索。除此以外的情况都使用过滤（filters)。</p></blockquote> <h2 id="aggs"><a href="#aggs" class="header-anchor">#</a> aggs</h2> <p>聚合操作，类似SQL中的Group By, 支持的聚合类型有<code>avg, min, max, sum, rang</code> 等，也可以对地理位置进行聚合</p> <ul><li>如果要对一个字段进行聚合，要保证这个字段的<code>fielddata</code>设置为true</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>PUT /<span class="token punctuation">{</span>index<span class="token punctuation">}</span>/_mapping/<span class="token punctuation">{</span>type<span class="token punctuation">}</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;properties&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;FILED&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;text&quot;</span>,
      <span class="token string">&quot;fielddata&quot;</span><span class="token builtin class-name">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>统计数组中每个元素出现的次数，中文有问题，现在中文分词是按单个字分词的，估计需要指定对该字段不分词</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>GET /shop/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;aggs&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;xxx&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;terms&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;field&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;colors&quot;</span>,
        <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">10</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li>aggs可以嵌套在aggs中使用</li> <li>嵌套聚合，分级汇总，在聚合中可以进行再聚合，意思是对分组的文档进行其他聚合，而不是对聚合结果进行处理</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>GET /shop/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;aggs&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;xxx&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;terms&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;field&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;colors&quot;</span>,
        <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">10</span>
      <span class="token punctuation">}</span>,
      <span class="token string">&quot;aggs&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;yyy&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;avg&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;field&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;price&quot;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h2 id="mget"><a href="#mget" class="header-anchor">#</a> _mget</h2> <p>multi-get，通过docs数组作为参数指定多个doc来获取多个文档,每个doc可以分别指定索引、类型、id,文档或者api中必须包含index/type/id</p> <ul><li>路径中不包含index、type、id</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>
GET /_mget 
<span class="token punctuation">{</span>
   <span class="token string">&quot;docs&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
         <span class="token string">&quot;_index&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;shop&quot;</span>,
         <span class="token string">&quot;_type&quot;</span> <span class="token builtin class-name">:</span>  <span class="token string">&quot;goods&quot;</span>,
         <span class="token string">&quot;_id&quot;</span> <span class="token builtin class-name">:</span>    <span class="token number">2</span>
      <span class="token punctuation">}</span>,
      <span class="token punctuation">{</span>
         <span class="token string">&quot;_index&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;account&quot;</span>,
         <span class="token string">&quot;_type&quot;</span> <span class="token builtin class-name">:</span>  <span class="token string">&quot;users&quot;</span>,
         <span class="token string">&quot;_id&quot;</span> <span class="token builtin class-name">:</span>    <span class="token number">1</span>,
         <span class="token string">&quot;_source&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;nickname&quot;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><ul><li>路径中包含index、type, 如果参数中没有指定index、type就使用路径中的，如果参数中明确指定了，就使用参数中的索引和类型</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>GET /<span class="token punctuation">{</span>index<span class="token punctuation">}</span>/<span class="token punctuation">{</span>type<span class="token punctuation">}</span>/_mget
<span class="token punctuation">{</span>
   <span class="token string">&quot;docs&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">2</span> <span class="token punctuation">}</span>,
      <span class="token punctuation">{</span> <span class="token string">&quot;_type&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;account&quot;</span>, <span class="token string">&quot;_id&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>
   <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>路径中指定了索引和类型，通过ids数组指定多个id值</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>GET /<span class="token punctuation">{</span>index<span class="token punctuation">}</span>/<span class="token punctuation">{</span>type<span class="token punctuation">}</span>/_mget'
<span class="token punctuation">{</span>
   <span class="token string">&quot;ids&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;2&quot;</span>, <span class="token string">&quot;1&quot;</span> <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="bulk"><a href="#bulk" class="header-anchor">#</a> _bulk</h2> <p>批量操作：将多个操作封装成一个操作，一次执行多个动作(create，index, update以及delete)，并返回每个执行结果.
可以通过_bulk来执行批量插入、批量更新等操作</p> <p>POST _bulk的请求主体的格式稍微有些不同：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">{</span> action: <span class="token punctuation">{</span> metadata <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">\</span>n
<span class="token punctuation">{</span> request body        <span class="token punctuation">}</span><span class="token punctuation">\</span>n
<span class="token punctuation">{</span> action: <span class="token punctuation">{</span> metadata <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">\</span>n
<span class="token punctuation">{</span> request body        <span class="token punctuation">}</span><span class="token punctuation">\</span>n
<span class="token punctuation">..</span>.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>它通过换行符(\n)连接到一起，最后一行也要有\n，每行一定要以换行符(\n)结尾， 包括最后一行 。这些换行符被用作一个标记，可以有效分隔行，这些行不能包含未转义的换行符，因为他们将会对解析造成干扰</p> <ul><li>action 必须是以下选项之一:
<ul><li>create:如果文档不存在，那么就创建它, 相当于 PUT /{index}/{type}/{id}/_create</li> <li>index:创建一个新文档或者替换一个现有的文档, 相当于 PUT /{index}/{type}/{id}</li> <li>update:部分更新一个文档, 即局部更新文档中的个别字段，相当于 /{index}/{type}/{id}/_update</li> <li>delete:删除一个文档,删除操作不需要指定请求体,delete操作没有请求体，它紧接着另一个行为；记得最后一个换行符</li></ul></li> <li>metadata 每个动作需要的参数，json格式的，应该指定被索引、创建、更新或者删除的文档的_index,_type和 _id</li></ul> <p>每个子请求都是独立执行，因此某个子请求的失败不会对其他子请求的成功与否造成影响。 如果其中任何子请求失败，最顶层的 error 标志被设置为 true ，并且在相应的请求报告出错误明细
这也意味着 bulk 请求不是原子的： 不能用它来实现事务控制。每个请求是单独处理的，因此一个请求的成功或失败不会影响其他的请求</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>POST /_bulk
<span class="token punctuation">{</span> <span class="token string">&quot;create&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;_index&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;shop&quot;</span>, <span class="token string">&quot;_type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;goods&quot;</span>, <span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span> <span class="token number">123</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span>    <span class="token string">&quot;My first blog post&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;index&quot;</span><span class="token builtin class-name">:</span>  <span class="token punctuation">{</span> <span class="token string">&quot;_index&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;shop&quot;</span>, <span class="token string">&quot;_type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;goods&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span>    <span class="token string">&quot;My second blog post&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;update&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;_index&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;shop&quot;</span>, <span class="token string">&quot;_type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;goods&quot;</span>, <span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span> <span class="token number">123</span>, <span class="token string">&quot;retry_on_conflict&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">3</span><span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;doc&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&quot;title&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;My updated blog post&quot;</span><span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;delete&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;_index&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;shop&quot;</span>, <span class="token string">&quot;_type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;goods&quot;</span>, <span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1234</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/05/31, 16:05:00</span></div></footer> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/ce8defeddfad513a/" data-tooltip="文档CURD" class="page-nav-centre page-nav-centre-prev"></a> <a href="/pages/54eba9074ad827ab/" data-tooltip="查询进阶" class="page-nav-centre page-nav-centre-next"></a> <div class="tooltip" style="display:none;">提高学习效率的策略</div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/ce8defeddfad513a/" class="prev">文档CURD</a></span> <span class="next"><a href="/pages/54eba9074ad827ab/">查询进阶</a>
        →
      </span></p></div></div> <div class="article"><div class="article-title"><span>最近更新</span></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/8c46832001208a31/"><div>Go 介绍与环境安装</div></a> <span>07-20</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/e51202e312201ba1/"><div>跳转语句</div></a> <span>02-08</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/97928077baa8871a/"><div>循环语句</div></a> <span>02-08</span></dt></dl> <dl><dd></dd> <dt><a href="/timeline/" class="more">更多文章&gt;</a></dt></dl></div></div></div> </main> <div class="footer" data-v-cc413c0c><div class="icons" data-v-cc413c0c><a href="mailto:zhifan1005@163.com" title="发邮件" target="_blank" class="iconfont icon-youjian" data-v-cc413c0c></a><a href="https://github.com/renzhifan" title="GitHub" target="_blank" class="iconfont icon-github" data-v-cc413c0c></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji" data-v-cc413c0c></a></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题" data-v-cc413c0c>♔♕Vdoing | </a>
    Copyright © 2019-2022
    <span data-v-cc413c0c>wu是小任</span></div></div> <div class="buttons"><div title="返回顶部" class="button go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.1e589c65.js" defer></script><script src="/assets/js/2.88f1b11e.js" defer></script><script src="/assets/js/179.8fb8795a.js" defer></script>
  </body>
</html>

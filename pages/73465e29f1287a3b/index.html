<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Nginx 配置常用参数 | wu是小任</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="技术博客">
    <meta name="keywords" content="php,go,mysql,git,linux,Ubuntu,supervisor,redis,elasticsearch,mac,homebrew,node,phpstorm,vscode,nginx,http,laravel,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.5c0233a9.css" as="style"><link rel="preload" href="/assets/js/app.1e589c65.js" as="script"><link rel="preload" href="/assets/js/2.88f1b11e.js" as="script"><link rel="preload" href="/assets/js/34.84b90d39.js" as="script"><link rel="prefetch" href="/assets/js/10.841cad22.js"><link rel="prefetch" href="/assets/js/100.51998793.js"><link rel="prefetch" href="/assets/js/101.6c468945.js"><link rel="prefetch" href="/assets/js/102.b0d49473.js"><link rel="prefetch" href="/assets/js/103.05368587.js"><link rel="prefetch" href="/assets/js/104.db06069a.js"><link rel="prefetch" href="/assets/js/105.d71aebe6.js"><link rel="prefetch" href="/assets/js/106.3dd77c43.js"><link rel="prefetch" href="/assets/js/107.c9352dba.js"><link rel="prefetch" href="/assets/js/108.60fc1978.js"><link rel="prefetch" href="/assets/js/109.b50945eb.js"><link rel="prefetch" href="/assets/js/11.26be53ce.js"><link rel="prefetch" href="/assets/js/110.da8531d4.js"><link rel="prefetch" href="/assets/js/111.6553bf3b.js"><link rel="prefetch" href="/assets/js/112.31c4b613.js"><link rel="prefetch" href="/assets/js/113.372a4397.js"><link rel="prefetch" href="/assets/js/114.429de267.js"><link rel="prefetch" href="/assets/js/115.f06e0838.js"><link rel="prefetch" href="/assets/js/116.d7f045c3.js"><link rel="prefetch" href="/assets/js/117.eec0c9b1.js"><link rel="prefetch" href="/assets/js/118.9dfe8cde.js"><link rel="prefetch" href="/assets/js/119.0c702c0e.js"><link rel="prefetch" href="/assets/js/12.dd4998f7.js"><link rel="prefetch" href="/assets/js/120.9eb0dcae.js"><link rel="prefetch" href="/assets/js/121.7c6a9bf6.js"><link rel="prefetch" href="/assets/js/122.94f961a3.js"><link rel="prefetch" href="/assets/js/123.a1f3dd6f.js"><link rel="prefetch" href="/assets/js/124.22b8f492.js"><link rel="prefetch" href="/assets/js/125.740f30c6.js"><link rel="prefetch" href="/assets/js/126.955d1117.js"><link rel="prefetch" href="/assets/js/127.42127d56.js"><link rel="prefetch" href="/assets/js/128.9bc0e471.js"><link rel="prefetch" href="/assets/js/129.846d556c.js"><link rel="prefetch" href="/assets/js/13.468b5a9e.js"><link rel="prefetch" href="/assets/js/130.c8141363.js"><link rel="prefetch" href="/assets/js/131.05d9d829.js"><link rel="prefetch" href="/assets/js/132.bd94d255.js"><link rel="prefetch" href="/assets/js/133.94d50492.js"><link rel="prefetch" href="/assets/js/134.f982ce4d.js"><link rel="prefetch" href="/assets/js/135.e0c5e23f.js"><link rel="prefetch" href="/assets/js/136.4218c448.js"><link rel="prefetch" href="/assets/js/137.034f160d.js"><link rel="prefetch" href="/assets/js/138.5d22193b.js"><link rel="prefetch" href="/assets/js/139.e9766435.js"><link rel="prefetch" href="/assets/js/14.b843bca5.js"><link rel="prefetch" href="/assets/js/140.5e8af980.js"><link rel="prefetch" href="/assets/js/141.8289f718.js"><link rel="prefetch" href="/assets/js/142.61b0d99b.js"><link rel="prefetch" href="/assets/js/143.394fddeb.js"><link rel="prefetch" href="/assets/js/144.6199ee12.js"><link rel="prefetch" href="/assets/js/145.db0769aa.js"><link rel="prefetch" href="/assets/js/146.a11e3954.js"><link rel="prefetch" href="/assets/js/147.50342bd3.js"><link rel="prefetch" href="/assets/js/148.c1930835.js"><link rel="prefetch" href="/assets/js/149.ad1dc3fc.js"><link rel="prefetch" href="/assets/js/15.82642fdc.js"><link rel="prefetch" href="/assets/js/150.13980057.js"><link rel="prefetch" href="/assets/js/151.dff707b3.js"><link rel="prefetch" href="/assets/js/152.755f33bb.js"><link rel="prefetch" href="/assets/js/153.f6b4e4a0.js"><link rel="prefetch" href="/assets/js/154.3d7d5f06.js"><link rel="prefetch" href="/assets/js/155.28895750.js"><link rel="prefetch" href="/assets/js/156.0e3eac12.js"><link rel="prefetch" href="/assets/js/157.eb3f6943.js"><link rel="prefetch" href="/assets/js/158.b2b76246.js"><link rel="prefetch" href="/assets/js/159.54505091.js"><link rel="prefetch" href="/assets/js/16.f6ad1ace.js"><link rel="prefetch" href="/assets/js/160.75ced8cd.js"><link rel="prefetch" href="/assets/js/161.a8c1181b.js"><link rel="prefetch" href="/assets/js/162.f4fbcb4e.js"><link rel="prefetch" href="/assets/js/163.e8f4bc4b.js"><link rel="prefetch" href="/assets/js/164.72ae826e.js"><link rel="prefetch" href="/assets/js/165.8439fde1.js"><link rel="prefetch" href="/assets/js/166.523232cb.js"><link rel="prefetch" href="/assets/js/167.182219f1.js"><link rel="prefetch" href="/assets/js/168.bfe88da4.js"><link rel="prefetch" href="/assets/js/169.a9487546.js"><link rel="prefetch" href="/assets/js/17.6b47855d.js"><link rel="prefetch" href="/assets/js/170.c2dbc708.js"><link rel="prefetch" href="/assets/js/171.f6c66625.js"><link rel="prefetch" href="/assets/js/172.3cb1c6b6.js"><link rel="prefetch" href="/assets/js/173.a57d52bb.js"><link rel="prefetch" href="/assets/js/174.64636356.js"><link rel="prefetch" href="/assets/js/175.3e7b17c7.js"><link rel="prefetch" href="/assets/js/176.f110f9dd.js"><link rel="prefetch" href="/assets/js/177.a5d9767f.js"><link rel="prefetch" href="/assets/js/178.b828eabf.js"><link rel="prefetch" href="/assets/js/179.8fb8795a.js"><link rel="prefetch" href="/assets/js/18.c793116a.js"><link rel="prefetch" href="/assets/js/180.96eecf5a.js"><link rel="prefetch" href="/assets/js/181.c5ef8573.js"><link rel="prefetch" href="/assets/js/182.3f0a3288.js"><link rel="prefetch" href="/assets/js/183.abde4e85.js"><link rel="prefetch" href="/assets/js/184.9db78423.js"><link rel="prefetch" href="/assets/js/185.aeb0dd26.js"><link rel="prefetch" href="/assets/js/186.35b33622.js"><link rel="prefetch" href="/assets/js/187.c61feca1.js"><link rel="prefetch" href="/assets/js/188.100593bc.js"><link rel="prefetch" href="/assets/js/189.39102e19.js"><link rel="prefetch" href="/assets/js/19.ff3ee999.js"><link rel="prefetch" href="/assets/js/190.0de8ae5e.js"><link rel="prefetch" href="/assets/js/191.75a6b8be.js"><link rel="prefetch" href="/assets/js/192.fb8d4293.js"><link rel="prefetch" href="/assets/js/193.f9d0383e.js"><link rel="prefetch" href="/assets/js/194.6264be7d.js"><link rel="prefetch" href="/assets/js/195.9a5824c7.js"><link rel="prefetch" href="/assets/js/196.a47986aa.js"><link rel="prefetch" href="/assets/js/197.3b2af781.js"><link rel="prefetch" href="/assets/js/198.ea524bd0.js"><link rel="prefetch" href="/assets/js/199.1b4e2763.js"><link rel="prefetch" href="/assets/js/20.acd8958e.js"><link rel="prefetch" href="/assets/js/200.a98d2090.js"><link rel="prefetch" href="/assets/js/201.056e1893.js"><link rel="prefetch" href="/assets/js/202.983695b3.js"><link rel="prefetch" href="/assets/js/203.1754bdaf.js"><link rel="prefetch" href="/assets/js/204.d72180b6.js"><link rel="prefetch" href="/assets/js/205.aa1619ca.js"><link rel="prefetch" href="/assets/js/206.d7670d45.js"><link rel="prefetch" href="/assets/js/207.b91c6424.js"><link rel="prefetch" href="/assets/js/208.8949b155.js"><link rel="prefetch" href="/assets/js/209.995f01a0.js"><link rel="prefetch" href="/assets/js/21.45b8c721.js"><link rel="prefetch" href="/assets/js/210.8b1f7b0f.js"><link rel="prefetch" href="/assets/js/211.eeff13d8.js"><link rel="prefetch" href="/assets/js/212.15009f62.js"><link rel="prefetch" href="/assets/js/213.7a1c1403.js"><link rel="prefetch" href="/assets/js/214.c4854ed6.js"><link rel="prefetch" href="/assets/js/215.821d1a35.js"><link rel="prefetch" href="/assets/js/216.79a8cecb.js"><link rel="prefetch" href="/assets/js/217.2fdb4822.js"><link rel="prefetch" href="/assets/js/218.5fbb557d.js"><link rel="prefetch" href="/assets/js/219.f0ea7c75.js"><link rel="prefetch" href="/assets/js/22.bd91939f.js"><link rel="prefetch" href="/assets/js/220.42b47c5f.js"><link rel="prefetch" href="/assets/js/221.cf7b95fc.js"><link rel="prefetch" href="/assets/js/222.55faee81.js"><link rel="prefetch" href="/assets/js/223.92129ca8.js"><link rel="prefetch" href="/assets/js/224.f93b31b5.js"><link rel="prefetch" href="/assets/js/225.40289022.js"><link rel="prefetch" href="/assets/js/226.91eabc11.js"><link rel="prefetch" href="/assets/js/227.2637ffec.js"><link rel="prefetch" href="/assets/js/228.b4030713.js"><link rel="prefetch" href="/assets/js/229.b217f170.js"><link rel="prefetch" href="/assets/js/23.d23edfdb.js"><link rel="prefetch" href="/assets/js/230.774b2cf7.js"><link rel="prefetch" href="/assets/js/231.9cfabadb.js"><link rel="prefetch" href="/assets/js/232.0dfd9098.js"><link rel="prefetch" href="/assets/js/233.89ec9430.js"><link rel="prefetch" href="/assets/js/234.6d3aa860.js"><link rel="prefetch" href="/assets/js/235.0125efb9.js"><link rel="prefetch" href="/assets/js/236.dc3eedd0.js"><link rel="prefetch" href="/assets/js/237.1f585a8f.js"><link rel="prefetch" href="/assets/js/238.0c2ccc12.js"><link rel="prefetch" href="/assets/js/239.fe90d092.js"><link rel="prefetch" href="/assets/js/24.49b37ec7.js"><link rel="prefetch" href="/assets/js/240.1a140685.js"><link rel="prefetch" href="/assets/js/241.7bda5546.js"><link rel="prefetch" href="/assets/js/242.1e1eb5a0.js"><link rel="prefetch" href="/assets/js/243.a087d701.js"><link rel="prefetch" href="/assets/js/25.b777b097.js"><link rel="prefetch" href="/assets/js/26.b6917a39.js"><link rel="prefetch" href="/assets/js/27.3f5d3fbe.js"><link rel="prefetch" href="/assets/js/28.b57d2950.js"><link rel="prefetch" href="/assets/js/29.b9ce0913.js"><link rel="prefetch" href="/assets/js/3.11af9f74.js"><link rel="prefetch" href="/assets/js/30.b8f127af.js"><link rel="prefetch" href="/assets/js/31.fb86cd7c.js"><link rel="prefetch" href="/assets/js/32.cfcbef90.js"><link rel="prefetch" href="/assets/js/33.02538437.js"><link rel="prefetch" href="/assets/js/35.7d787ffc.js"><link rel="prefetch" href="/assets/js/36.479a70ae.js"><link rel="prefetch" href="/assets/js/37.100d6271.js"><link rel="prefetch" href="/assets/js/38.8dc3e394.js"><link rel="prefetch" href="/assets/js/39.22a52480.js"><link rel="prefetch" href="/assets/js/4.7ceac8be.js"><link rel="prefetch" href="/assets/js/40.d62d8b57.js"><link rel="prefetch" href="/assets/js/41.7886543c.js"><link rel="prefetch" href="/assets/js/42.2cbee609.js"><link rel="prefetch" href="/assets/js/43.9d932b93.js"><link rel="prefetch" href="/assets/js/44.c7b3b09d.js"><link rel="prefetch" href="/assets/js/45.c7158bb0.js"><link rel="prefetch" href="/assets/js/46.e4b553b3.js"><link rel="prefetch" href="/assets/js/47.d012cbe5.js"><link rel="prefetch" href="/assets/js/48.22181e25.js"><link rel="prefetch" href="/assets/js/49.ec206af2.js"><link rel="prefetch" href="/assets/js/5.3b91bdc7.js"><link rel="prefetch" href="/assets/js/50.3c8f6854.js"><link rel="prefetch" href="/assets/js/51.52eefae6.js"><link rel="prefetch" href="/assets/js/52.264461fa.js"><link rel="prefetch" href="/assets/js/53.252a1bf8.js"><link rel="prefetch" href="/assets/js/54.8bc6278e.js"><link rel="prefetch" href="/assets/js/55.89b8032a.js"><link rel="prefetch" href="/assets/js/56.5f32fbd2.js"><link rel="prefetch" href="/assets/js/57.f79d3ea0.js"><link rel="prefetch" href="/assets/js/58.ff002095.js"><link rel="prefetch" href="/assets/js/59.ccabf3c0.js"><link rel="prefetch" href="/assets/js/6.97d7c801.js"><link rel="prefetch" href="/assets/js/60.63af8d58.js"><link rel="prefetch" href="/assets/js/61.bd86bfe3.js"><link rel="prefetch" href="/assets/js/62.1ccff20f.js"><link rel="prefetch" href="/assets/js/63.fec347bd.js"><link rel="prefetch" href="/assets/js/64.59938043.js"><link rel="prefetch" href="/assets/js/65.80a201ed.js"><link rel="prefetch" href="/assets/js/66.060cb376.js"><link rel="prefetch" href="/assets/js/67.e7cdf133.js"><link rel="prefetch" href="/assets/js/68.b276c430.js"><link rel="prefetch" href="/assets/js/69.2a781f0d.js"><link rel="prefetch" href="/assets/js/7.69762135.js"><link rel="prefetch" href="/assets/js/70.46fadeba.js"><link rel="prefetch" href="/assets/js/71.c90f362e.js"><link rel="prefetch" href="/assets/js/72.948db37a.js"><link rel="prefetch" href="/assets/js/73.644348d1.js"><link rel="prefetch" href="/assets/js/74.8a2b234f.js"><link rel="prefetch" href="/assets/js/75.58e17415.js"><link rel="prefetch" href="/assets/js/76.8b22b279.js"><link rel="prefetch" href="/assets/js/77.e6faf941.js"><link rel="prefetch" href="/assets/js/78.ccc9f064.js"><link rel="prefetch" href="/assets/js/79.d6d322ef.js"><link rel="prefetch" href="/assets/js/8.b2c29ddc.js"><link rel="prefetch" href="/assets/js/80.40ab210a.js"><link rel="prefetch" href="/assets/js/81.a8faa74e.js"><link rel="prefetch" href="/assets/js/82.0137fd70.js"><link rel="prefetch" href="/assets/js/83.59167c32.js"><link rel="prefetch" href="/assets/js/84.27dd00eb.js"><link rel="prefetch" href="/assets/js/85.2278b5f0.js"><link rel="prefetch" href="/assets/js/86.b64a0ffe.js"><link rel="prefetch" href="/assets/js/87.0b55b1ed.js"><link rel="prefetch" href="/assets/js/88.b276ef0f.js"><link rel="prefetch" href="/assets/js/89.235a3fc0.js"><link rel="prefetch" href="/assets/js/9.f9068b0b.js"><link rel="prefetch" href="/assets/js/90.5cfa4b5d.js"><link rel="prefetch" href="/assets/js/91.10af5a2f.js"><link rel="prefetch" href="/assets/js/92.1c59b283.js"><link rel="prefetch" href="/assets/js/93.c56553a2.js"><link rel="prefetch" href="/assets/js/94.c8cf7705.js"><link rel="prefetch" href="/assets/js/95.daff829b.js"><link rel="prefetch" href="/assets/js/96.62580526.js"><link rel="prefetch" href="/assets/js/97.317bc21b.js"><link rel="prefetch" href="/assets/js/98.abfaa9df.js"><link rel="prefetch" href="/assets/js/99.b7fd50d8.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5c0233a9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu theme-mode-light"><header class="navbar"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/avater.jpeg" alt="wu是小任" class="logo"> <span class="site-name can-hide">wu是小任</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/notes/" class="nav-link">笔记</a></div><div class="nav-item"><a href="/technology/" class="nav-link">技术</a></div><div class="nav-item"><a href="/php/" class="nav-link">PHP</a></div><div class="nav-item"><a href="/go/" class="nav-link">GO</a></div><div class="nav-item"><a href="/mysql/" class="nav-link">MYSQL</a></div><div class="nav-item"><a href="/redis/" class="nav-link">Redis</a></div><div class="nav-item"><a href="/elasticsearch/" class="nav-link">Elasticsearch</a></div><div class="nav-item"><a href="/rabbitmq/" class="nav-link">Rabbitmq</a></div><div class="nav-item"><a href="/mac/" class="nav-link">Mac</a></div><div class="nav-item"><a href="/favorites/" class="nav-link">收藏</a></div><div class="nav-item"><a href="/timeline/" class="nav-link">时间轴</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/avater.jpeg"> <div class="blogger-info"><h3>wu是小任</h3> <div class="icons"><a href="mailto:zhifan1005@163.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/renzhifan" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/notes/" class="nav-link">笔记</a></div><div class="nav-item"><a href="/technology/" class="nav-link">技术</a></div><div class="nav-item"><a href="/php/" class="nav-link">PHP</a></div><div class="nav-item"><a href="/go/" class="nav-link">GO</a></div><div class="nav-item"><a href="/mysql/" class="nav-link">MYSQL</a></div><div class="nav-item"><a href="/redis/" class="nav-link">Redis</a></div><div class="nav-item"><a href="/elasticsearch/" class="nav-link">Elasticsearch</a></div><div class="nav-item"><a href="/rabbitmq/" class="nav-link">Rabbitmq</a></div><div class="nav-item"><a href="/mac/" class="nav-link">Mac</a></div><div class="nav-item"><a href="/favorites/" class="nav-link">收藏</a></div><div class="nav-item"><a href="/timeline/" class="nav-link">时间轴</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>linux</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/589908a13404cb96/" class="sidebar-link">linux修改文件夹权限</a></li><li><a href="/pages/950601e845ae9a24/" class="sidebar-link">Vim快捷键</a></li><li><a href="/pages/1994160e1481d45d/" class="sidebar-link">位、字节、字符的区别</a></li><li><a href="/pages/85c79a16f94a372d/" class="sidebar-link">Centos-7-配置-supervisor-遇到的坑</a></li><li><a href="/pages/057a0c1c20abe69e/" class="sidebar-link">Let's Encrypt 实现nginx站点 SSL</a></li><li><a href="/pages/5bebe71757c57e85/" class="sidebar-link">ubuntu18搭建PHP环境</a></li><li><a href="/pages/d28aeb953725432a/" class="sidebar-link">以动画的方式，快速直观地查看 Git 文件变动历史</a></li><li><a href="/pages/12f512fb1a420e39/" class="sidebar-link">什么是BS结构和CS结构</a></li><li><a href="/pages/23f8205734c53eaf/" class="sidebar-link">基于SMProxy通过协程调度实现MySQL连接池</a></li><li><a href="/pages/4bbeb7d0e84b1b35/" class="sidebar-link">Linux下的解压命令</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>npm</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/05b2c00d3b4d7830/" class="sidebar-link">Linux下快速安装Node</a></li><li><a href="/pages/7504c30684081e67/" class="sidebar-link">npm 如何切换到淘宝镜像</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>工具</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/e2fc805085e25c97/" class="sidebar-link">vscode</a></li><li><a href="/pages/d88cbb7da7eac9ab/" class="sidebar-link">Dbeaver</a></li><li><a href="/pages/03d476861afd3845/" class="sidebar-link">postman</a></li><li><a href="/pages/f013c52217e3a651/" class="sidebar-link">FinalShell(非常强大的ssh工具)</a></li><li><a href="/pages/f9faf9e72b532d64/" class="sidebar-link">开发环境使用 ngrok工具映射公网地址</a></li><li><a href="/pages/b2fdd52b6981f4ba/" class="sidebar-link">uPic 图床配置教程 - Imgur</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>nginx</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/73465e29f1287a3b/" aria-current="page" class="active sidebar-link">Nginx 配置常用参数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/73465e29f1287a3b/#应用" class="sidebar-link">应用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/73465e29f1287a3b/#估算并发" class="sidebar-link">估算并发</a></li><li class="sidebar-sub-header"><a href="/pages/73465e29f1287a3b/#限制每个-ip-的并发连接数" class="sidebar-link">限制每个 IP 的并发连接数</a></li><li class="sidebar-sub-header"><a href="/pages/73465e29f1287a3b/#限流" class="sidebar-link">限流</a></li><li class="sidebar-sub-header"><a href="/pages/73465e29f1287a3b/#白名单" class="sidebar-link">白名单</a></li><li class="sidebar-sub-header"><a href="/pages/73465e29f1287a3b/#防盗链" class="sidebar-link">防盗链</a></li></ul></li></ul></li><li><a href="/pages/f27b33d948809487/" class="sidebar-link">Nginx 负载均衡</a></li><li><a href="/pages/ac8e71ebd368b4c1/" class="sidebar-link">Nginx开启和配置Gzip压缩</a></li><li><a href="/pages/7c5d3441f6ec2d46/" class="sidebar-link">代理与反向代理、负载均衡和缓存</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>HTTP</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/49c3a6b788e95786/" class="sidebar-link">URL详解</a></li><li><a href="/pages/83e85d46beeb57c2/" class="sidebar-link">HTTP协议详解</a></li><li><a href="/pages/15eea5354ab2776b/" class="sidebar-link">BS结构和CS结构</a></li><li><a href="/pages/26d4b7fea683eea5/" class="sidebar-link">HTTPS协议</a></li><li><a href="/pages/40dcfcc19afad38a/" class="sidebar-link">HTTP 认证实现方案介绍</a></li><li><a href="/pages/d19b747c55a47a85/" class="sidebar-link">WebSocket基本原理</a></li><li><a href="/pages/85adec193c69dab6/" class="sidebar-link">WebSocket 客户端和服务端的简单实现</a></li><li><a href="/pages/ac7f0f8baaca8c92/" class="sidebar-link">HTTP 状态码</a></li></ul></section></li></ul> </aside> <div><main class="page"> <div class="theme-vdoing-wrapper"><div class="articleInfo-wrap" data-v-17b32fa0><div class="articleInfo" data-v-17b32fa0><ul class="breadcrumbs" data-v-17b32fa0><li data-v-17b32fa0><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-17b32fa0></a></li> <li data-v-17b32fa0><a href="/notes" title="笔记-目录页" data-v-17b32fa0>笔记</a></li> <li data-v-17b32fa0><span data-v-17b32fa0>nginx</span></li></ul> <div class="info" data-v-17b32fa0><div class="author iconfont icon-touxiang" data-v-17b32fa0><a href="javascript:;" title="作者" data-v-17b32fa0>wu是小任</a></div> <div class="date iconfont icon-riqi" data-v-17b32fa0><a href="javascript:;" title="创建时间" data-v-17b32fa0>2021-01-19</a></div></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-padding"><div class="right-menu-content"></div></div></div> <div class="theme-vdoing-content content__default"><h3 id="主模块"><a href="#主模块" class="header-anchor">#</a> 主模块</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 配置用户或者组，默认为nobody nobody。</span>
<span class="token comment">#user www www;  </span>

 <span class="token comment">#Nginx开启的worker进程数，建议为CPU的核数</span>
<span class="token comment">#worker_processes 2; </span>

<span class="token comment">#指定nginx进程运行文件存放地址</span>
<span class="token comment">#pid /nginx/pid/nginx.pid;</span>

<span class="token comment">#指定日志路径，级别。这个设置可以放入全局块、http块、server块，级别以此为：debug|info|notice|warn|error|crit|alert|emerg</span>
error_log log/error.log debug<span class="token punctuation">;</span> 

<span class="token comment">#可以在任意地方使用include指令实现配置文件的包含，类似于apache中的include方法，可减少主配置文件长度。</span>
include vhosts/*.conf<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="事件模块"><a href="#事件模块" class="header-anchor">#</a> 事件模块</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>events <span class="token punctuation">{</span>
    <span class="token comment">#设置网路连接序列化，防止惊群现象发生，默认为on</span>
    accept_mutex on<span class="token punctuation">;</span> 

    <span class="token comment">#默认: 500ms 如果一个进程没有互斥锁，它将延迟至少多长时间。默认情况下，延迟是500ms 。</span>
    accept_mutex_delay 100ms<span class="token punctuation">;</span> 

    <span class="token comment">#设置一个进程是否同时接受多个网络连接，默认为off</span>
    multi_accept on<span class="token punctuation">;</span>

    <span class="token comment">#事件驱动模型，select|poll|kqueue|epoll|resig|/dev/poll|eventport，不建议设置，nginx会自行选择</span>
    <span class="token comment">#use epoll;</span>

    <span class="token comment">#最大连接数，默认为512</span>
    worker_connections  <span class="token number">1024</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="http-部分"><a href="#http-部分" class="header-anchor">#</a> http 部分</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>http <span class="token punctuation">{</span>
    <span class="token comment">#文件扩展名与文件类型映射表</span>
    include       mime.types<span class="token punctuation">;</span>

    <span class="token comment"># 默认文件类型，默认为text/plain</span>
    default_type  application/octet-stream<span class="token punctuation">;</span> 

    <span class="token comment">#取消服务日志 </span>
    <span class="token comment">#access_log off; </span>

    <span class="token comment">#允许sendfile方式传输文件，默认为off，可以在http块，server块，location块。</span>
    sendfile on<span class="token punctuation">;</span>   

    <span class="token comment">#每个进程每次调用传输数量不能大于设定的值，默认为0，即不设上限。</span>
    sendfile_max_chunk 100k<span class="token punctuation">;</span>  

    <span class="token comment">#连接超时时间，默认为75s，可以在http，server，location块。</span>
    keepalive_timeout <span class="token number">65</span><span class="token punctuation">;</span>  

    <span class="token comment">#开启gzip资源压缩</span>
    <span class="token function">gzip</span>  on<span class="token punctuation">;</span> 

    <span class="token comment"># 负载均衡，详细可看了一篇文章：https://learnku.com/articles/36737</span>
    upstream blog <span class="token punctuation">{</span>   
        server <span class="token number">192.167</span>.20.19:8081<span class="token punctuation">;</span>
        server <span class="token number">192.168</span>.10.121:8080 <span class="token assign-left variable">weight</span><span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">#设定请求缓冲</span>
    client_header_buffer_size    128k<span class="token punctuation">;</span>
    large_client_header_buffers  <span class="token number">4</span> 128k<span class="token punctuation">;</span>

    <span class="token comment">#上传文件的大小限制  默认1m</span>
    client_max_body_size 8m<span class="token punctuation">;</span>

    server <span class="token punctuation">{</span>
        <span class="token comment">#单连接请求上限次数。</span>
        keepalive_requests <span class="token number">120</span><span class="token punctuation">;</span>

        <span class="token comment">#监听端口</span>
        listen       <span class="token number">80</span><span class="token punctuation">;</span>   

        <span class="token comment">#监听地址</span>
        server_name  blog.13sai.com<span class="token punctuation">;</span>  

        <span class="token comment">#设定日志格式</span>
        log_format  main  <span class="token string">'$remote_addr - $remote_user [$time_local] &quot;$request&quot; '</span>
                      <span class="token string">'$status $body_bytes_sent &quot;$http_referer&quot; '</span>
                      <span class="token string">'&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;'</span><span class="token punctuation">;</span>

        access_log  /data/logs/access.log  main<span class="token punctuation">;</span>

        <span class="token comment"># 根目录</span>
        root /www/web/public<span class="token punctuation">;</span> 

        <span class="token comment"># 定义错误提示页面</span>
        error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span> /50x.html<span class="token punctuation">;</span>

        location /static/ <span class="token punctuation">{</span>
            <span class="token comment">#root与alias主要区别在于nginx如何解释location后面的uri，这会使两者分别以不同的方式将请求映射到服务器文件上。</span>
            <span class="token comment">#root的处理结果是：root路径＋location路径</span>
            <span class="token comment">#alias的处理结果是：使用alias路径替换location路径</span>
            <span class="token builtin class-name">alias</span> /www/static/<span class="token punctuation">;</span>

            <span class="token comment">#过期30天，静态文件不怎么更新，过期可以设大一点,如果频繁更新，则可以设置得小一点。</span>
            expires 30d<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment"># 处理php请求到fpm端口</span>
        location ~ <span class="token punctuation">\</span>.php$ <span class="token punctuation">{</span>
            fastcgi_pass   <span class="token number">127.0</span>.0.1:9000<span class="token punctuation">;</span>
            fastcgi_index  index.php<span class="token punctuation">;</span>
            fastcgi_param  SCRIPT_FILENAME  <span class="token variable">$document_root</span><span class="token variable">$fastcgi_script_name</span><span class="token punctuation">;</span>
            include        fastcgi_params<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        location / <span class="token punctuation">{</span>
            proxy_set_header Host <span class="token variable">$host</span><span class="token punctuation">;</span>
            proxy_set_header  X-Real-IP  <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
            proxy_pass  http://blog<span class="token punctuation">;</span>  <span class="token comment">#请求转向blog 定义的服务器列表 </span>
        <span class="token punctuation">}</span>

        <span class="token comment">#禁止访问文件</span>
        location ~ /.git <span class="token punctuation">{</span>
            deny all<span class="token punctuation">;</span>
            allow <span class="token number">127.0</span>.0.1<span class="token punctuation">;</span> <span class="token comment">#允许的ip </span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br></div></div><h3 id="部分参数详细说明"><a href="#部分参数详细说明" class="header-anchor">#</a> 部分参数详细说明</h3> <ul><li>server_name</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>1.首先选择所有字符串完全匹配的server_name，如 blog.13sai.com 。
2.其次选择通配符在前面的server_name，如 *.13sai.com。
3.再次选择通配符在后面的server_name，如www.13sai.* 。 
4.最后选择使用正则表达式才匹配的server_name，如 ~^\.sai\.com$

如果都不匹配
1、优先选择listen配置项后有default或default_server的 
2、找到匹配listen端口的第一个server块
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li>location</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>location
语法: location[=|~|~*|^~|@]/uri/{...}
配置块: server location会尝试根据用户请求中的URI来匹配上面的/uri表达式，如果可以匹配，就选择 location{}块中的配置来处理用户请求。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>location 表达式类型</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>~ 表示执行一个正则匹配，区分大小写;
~* 表示执行一个正则匹配，不区分大小写;
^~ 表示普通字符匹配。使用前缀匹配。如果匹配成功，则不再匹配其他location; 
= 进行普通字符精确匹配。也就是完全匹配;
@ 它定义一个命名的 location，使用在内部定向时，例如 error_page, try_files
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>优先级:</p> <ul><li><p>等号类型 (=) 的优先级最高。一旦匹配成功，则不再查找其他匹配项</p></li> <li><p>前缀普通匹配 (^~) 优先级次之。不支持正则表达式。使用前缀匹配，如果有多个 location 匹配的话，则使用表达式最长的那个</p></li> <li><p>正则表达式类型 (~ ~*) 的优先级次之。一旦匹配成功，则不再查找其他匹配项</p></li> <li><p>常规字符串匹配，如果有多个 location 匹配的话，则使用表达式最长的那个</p></li> <li><p>return</p></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>语法:return code [text] return code URL;
return URL;
配置块:server，location，if
该指令用于结束规则的执行并返回状态吗给客户端。
状态码包括:
204(No Content)、
400(Bad Request)、
402(Payment Required)、
403(Forbidden) 
404(Not Found)、
405(Method Not Allowed)、
406(Not Acceptable)、 
408(Request Timeout)、
410(Gone)、
411(Length Required)、
413(Request Entity Too Large)、
416(Requested Range Not Satisfiable)、 500(Internal Server Error)、
501(Not Implemented)、
502(Bad Gateway)、 
503(Service Unavailable)
504(Gateway Timeout)。

例如，示例，如果访问的URL以.sh .bash 结尾，返回状态码403 
location ~ .*\.(sh|bash)?$ {
    return 403;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><ul><li>rewrite</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>语法:rewrite regex replacement [flag]; 
默认值:—
配置块:server, location, if
rewrite是实现URL重写的关键指令，根据regex(正则表达式)部分内容，重定向到replacement，结尾是flag标记。 正则:perl兼容正则表达式语句进行规则匹配
替代内容:将正则匹配的内容替换成replacement
flag标记:rewrite支持的flag标记

执行顺序：
1. 执行server块的rewrite指令(这里的块指的是server关键字后{}包围的区域，其它xx块类似)
2. 执行location匹配
3. 执行选定的location中的rewrite指令
如果其中某步URI被重写，则重新循环执行1-3，直到找到真实存在的文件

如果循环超过10次，则返回500 Internal Server Error错误
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ul><li>if 指令</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>语法：if(condition){...}
默认值：无
配置块：server,location
对给定的条件condition进行判断。如果为真，大括号内的rewrite指令将被执行。
if条件(conditon)可以是如下任何内容:

一个变量名；false如果这个变量是空字符串或者以0开始的字符串；
使用= ,!= 比较的一个变量和字符串
是用~， ~*与正则表达式匹配的变量，如果这个正则表达式中包含}，;则整个表达式需要用&quot; 或' 包围
使用-f ，!-f 检查一个文件是否存在
使用-d, !-d 检查一个目录是否存在
使用-e ，!-e 检查一个文件、目录、符号链接是否存在
使用-x ， !-x 检查一个文件是否可执行
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ul><li>if 实例</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>if ($http_user_agent~*(mobile|nokia|iphone|ipad|android|samsung|htc|blackberry)) {
    rewrite ^.+ /mobile last; ＃跳转到手机站
}

if ($request_method = POST) {
    return 405;
}

if ($slow) {
    limit_rate 10k;
}

if ($invalid_referer) {
    return 403;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ul><li>last &amp; break</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>（1）last 和 break 当出现在location 之外时，两者的作用是一致的没有任何差异。
注意一点就是，他们会跳过所有的在他们之后的rewrite 模块中的指令，去选择自己匹配的location
（2）last 和 break 当出现在location 内部时，两者就存在了差异
-- last: 使用了last 指令，rewrite 后会跳出location 作用域，重新开始再走一次刚刚的行为
-- break: 使用了break 指令，rewrite后不会跳出location 作用域。它的生命也在这个location中终结。

解释通俗易懂：

last：
        重新将rewrite后的地址在server标签中执行
break：
        将rewrite后的地址在当前location标签中执行
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ul><li>permanent &amp; redirect:</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>permanent: 永久性重定向。请求日志中的状态码为301
redirect:临时重定向。请求日志中的状态码为302
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>从实现功能的角度上去看，permanent 和 redirect 是一样的。不存在好坏。也不存在什么性能上的问题。但是对 seo 会有影响，这里要根据需要做出选择
在 permanent 和 redirect 中提到了 状态码 301 和 302。</p> <p>记住：last 和 break 想对于的访问日志的请求状态码为 200</p> <p>当你打开一个网页，同时打开 debug 模式时，会发现 301 和 302 时的行为是这样的。</p> <p>第一个请求 301 或者 302 后，浏览器重新获取了一个新的 URL ，然后会对这个新的 URL 重新进行访问。所以当你配置的是 permanent 和 redirect , 你对一个 URL 的访问请求，落到服务器上至少为 2 次；而当你配置了 last 或者是 break 时，你最终的 URL 确定下来后，不会将这个 URL 返回给浏览器，而是将其扔给了 fastcgi_pass 或者是 proxy_pass 指令去处理。请求一个 URL ，落到服务器上的次数就为 1 次。</p> <p>注意：配置 last 在跨域的时候效果和 redirect 一致，都是返回 302 状态码，请求地址也发生改变</p> <h2 id="应用"><a href="#应用" class="header-anchor">#</a> 应用</h2> <h3 id="估算并发"><a href="#估算并发" class="header-anchor">#</a> 估算并发</h3> <ul><li>nginx 作为 http 服务器的时候</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>max_clients = worker_processes * worker_connections/2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>nginx 作为反向代理服务器的时候：</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>max_clients = worker_processes * worker_connections/4  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="限制每个-ip-的并发连接数"><a href="#限制每个-ip-的并发连接数" class="header-anchor">#</a> 限制每个 IP 的并发连接数</h3> <blockquote><p>demo: 定义一个叫 “two” 的记录区，总容量为 10M（超过大小将请求失败，以变量 $binary_remote_addr 作为会话的判断基准（即一个地址一个会话）。 限制 /download/ 目录下，一个会话只能进行一个连接。 简单点，就是限制 /download/ 目录下，一个 IP 只能发起一个连接，多过一个，一律 503</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>http {
    ...
    limit_conn_zone $binary_remote_addr zone=two:10m;

    server {
        ...

        location /download {
            limit_conn   two  1;
        }
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="限流"><a href="#限流" class="header-anchor">#</a> 限流</h3> <blockquote><p>demo: 定义一个叫 “one” 的记录区，占用空间大小为 10m（超过大小将请求失败），平均处理的请求频率不能超过每秒一次，也可以设置分钟速率</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>http {
    ...

    limit_req_zone  $binary_remote_addr  zone=one:10m  rate=1r/s;

    server {
        ...

        location / {
            #缓存区队列burst=5个,nodelay表示不延期(超过的请求失败)，即每秒最多可处理rate+burst个,同时处理rate个。
            limit_req zone=one burst=5 nodelay; 
        }
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="白名单"><a href="#白名单" class="header-anchor">#</a> 白名单</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>http{
    ...

    #判断客户端的ip地址是否在白名单列表当中,如果返回为0,则在白名单列表当中,否则返回为1
    geo $whiteIpList {
        default  1;
        118.24.109.254 0;
        47.98.147.0/24 1;
        #可以引入一些白名单配置
        include 'whiteIP.conf'
    }

    #如果不在白名单之内,返回客户端的二进制的ip地址
    map $whiteIpList  $limit {
        default  &quot;&quot;;
        1   $binary_remote_addr;
        0   &quot;&quot;;
    }

    #如果返回的是空字符串那么速率限制会失效
    limit_req_zone $limit zone=test:2m rate=1r/m;

    ...
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="防盗链"><a href="#防盗链" class="header-anchor">#</a> 防盗链</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>http {
    ...

    server {
        ...
        #valid_referers后面的referer列表进行匹配，如果匹配到了就invalid_referer字段值为0 否则设置该值为1
        location ~* \.(gif|jpg|png|swf|flv)$ {
            valid_referers none blocked *.13sai.com;
            if ($invalid_referer) {
                rewrite ^/ blog.13sai.com
            }
        }
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/05/16, 10:05:00</span></div></footer> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/b2fdd52b6981f4ba/" data-tooltip="uPic 图床配置教程 - Imgur" class="page-nav-centre page-nav-centre-prev"></a> <a href="/pages/f27b33d948809487/" data-tooltip="Nginx 负载均衡" class="page-nav-centre page-nav-centre-next"></a> <div class="tooltip" style="display:none;">提高学习效率的策略</div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/b2fdd52b6981f4ba/" class="prev">uPic 图床配置教程 - Imgur</a></span> <span class="next"><a href="/pages/f27b33d948809487/">Nginx 负载均衡</a>
        →
      </span></p></div></div> <div class="article"><div class="article-title"><span>最近更新</span></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/8c46832001208a31/"><div>Go 介绍与环境安装</div></a> <span>07-20</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/e51202e312201ba1/"><div>跳转语句</div></a> <span>02-08</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/97928077baa8871a/"><div>循环语句</div></a> <span>02-08</span></dt></dl> <dl><dd></dd> <dt><a href="/timeline/" class="more">更多文章&gt;</a></dt></dl></div></div></div> </main> <div class="footer" data-v-cc413c0c><div class="icons" data-v-cc413c0c><a href="mailto:zhifan1005@163.com" title="发邮件" target="_blank" class="iconfont icon-youjian" data-v-cc413c0c></a><a href="https://github.com/renzhifan" title="GitHub" target="_blank" class="iconfont icon-github" data-v-cc413c0c></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji" data-v-cc413c0c></a></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题" data-v-cc413c0c>♔♕Vdoing | </a>
    Copyright © 2019-2022
    <span data-v-cc413c0c>wu是小任</span></div></div> <div class="buttons"><div title="返回顶部" class="button go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.1e589c65.js" defer></script><script src="/assets/js/2.88f1b11e.js" defer></script><script src="/assets/js/34.84b90d39.js" defer></script>
  </body>
</html>
